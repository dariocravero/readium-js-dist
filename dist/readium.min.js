!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=Q.type(e);return"function"===n||Q.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,n){if(Q.isFunction(t))return Q.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return Q.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(st.test(t))return Q.filter(t,e,n);t=Q.filter(t,e)}return Q.grep(e,function(e){return q.call(t,e)>=0!==n})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=pt[e]={};return Q.each(e.match(ht)||[],function(e,n){t[n]=!0}),t}function a(){Y.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1),Q.ready()}function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Q.expando+s.uid++}function l(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(wt,"-$1").toLowerCase(),n=e.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:St.test(n)?Q.parseJSON(n):n}catch(r){}yt.set(e,t,n)}else n=void 0;return n}function u(){return!0}function c(){return!1}function d(){try{return Y.activeElement}catch(e){}}function f(e,t){return Q.nodeName(e,"table")&&Q.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function h(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function p(e){var t=Lt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var n=0,i=e.length;i>n;n++)vt.set(e[n],"globalEval",!t||vt.get(t[n],"globalEval"))}function m(e,t){var n,i,r,o,a,s,l,u;if(1===t.nodeType){if(vt.hasData(e)&&(o=vt.access(e),a=vt.set(t,o),u=o.events)){delete a.handle,a.events={};for(r in u)for(n=0,i=u[r].length;i>n;n++)Q.event.add(t,r,u[r][n])}yt.hasData(e)&&(s=yt.access(e),l=Q.extend({},s),yt.set(t,l))}}function v(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&Q.nodeName(e,t)?Q.merge([e],n):n}function y(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Et.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function S(t,n){var i,r=Q(n.createElement(t)).appendTo(n.body),o=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(r[0]))?i.display:Q.css(r[0],"display");return r.detach(),o}function w(e){var t=Y,n=Vt[e];return n||(n=S(e,t),"none"!==n&&n||(Ht=(Ht||Q("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Ht[0].contentDocument,t.write(),t.close(),n=S(e,t),Ht.detach()),Vt[e]=n),n}function b(e,t,n){var i,r,o,a,s=e.style;return n=n||jt(e),n&&(a=n.getPropertyValue(t)||n[t]),n&&(""!==a||Q.contains(e.ownerDocument,e)||(a=Q.style(e,t)),Ut.test(a)&&Kt.test(t)&&(i=s.width,r=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=i,s.minWidth=r,s.maxWidth=o)),void 0!==a?a+"":a}function C(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function R(e,t){if(t in e)return t;for(var n=t[0].toUpperCase()+t.slice(1),i=t,r=Xt.length;r--;)if(t=Xt[r]+n,t in e)return t;return i}function E(e,t,n){var i=Wt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function x(e,t,n,i,r){for(var o=n===(i?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=Q.css(e,n+Ct[o],!0,r)),i?("content"===n&&(a-=Q.css(e,"padding"+Ct[o],!0,r)),"margin"!==n&&(a-=Q.css(e,"border"+Ct[o]+"Width",!0,r))):(a+=Q.css(e,"padding"+Ct[o],!0,r),"padding"!==n&&(a+=Q.css(e,"border"+Ct[o]+"Width",!0,r)));return a}function I(e,t,n){var i=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=jt(e),a="border-box"===Q.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=b(e,t,o),(0>r||null==r)&&(r=e.style[t]),Ut.test(r))return r;i=a&&(J.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+x(e,t,n||(a?"border":"content"),i,o)+"px"}function T(e,t){for(var n,i,r,o=[],a=0,s=e.length;s>a;a++)i=e[a],i.style&&(o[a]=vt.get(i,"olddisplay"),n=i.style.display,t?(o[a]||"none"!==n||(i.style.display=""),""===i.style.display&&Rt(i)&&(o[a]=vt.access(i,"olddisplay",w(i.nodeName)))):(r=Rt(i),"none"===n&&r||vt.set(i,"olddisplay",r?n:Q.css(i,"display"))));for(a=0;s>a;a++)i=e[a],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[a]||"":"none"));return e}function N(e,t,n,i,r){return new N.prototype.init(e,t,n,i,r)}function D(){return setTimeout(function(){Jt=void 0}),Jt=Q.now()}function P(e,t){var n,i=0,r={height:e};for(t=t?1:0;4>i;i+=2-t)n=Ct[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function _(e,t,n){for(var i,r=(nn[t]||[]).concat(nn["*"]),o=0,a=r.length;a>o;o++)if(i=r[o].call(n,t,e))return i}function O(e,t,n){var i,r,o,a,s,l,u,c,d=this,f={},h=e.style,p=e.nodeType&&Rt(e),g=vt.get(e,"fxshow");n.queue||(s=Q._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,d.always(function(){d.always(function(){s.unqueued--,Q.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],u=Q.css(e,"display"),c="none"===u?vt.get(e,"olddisplay")||w(e.nodeName):u,"inline"===c&&"none"===Q.css(e,"float")&&(h.display="inline-block")),n.overflow&&(h.overflow="hidden",d.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(i in t)if(r=t[i],Zt.exec(r)){if(delete t[i],o=o||"toggle"===r,r===(p?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;p=!0}f[i]=g&&g[i]||Q.style(e,i)}else u=void 0;if(Q.isEmptyObject(f))"inline"===("none"===u?w(e.nodeName):u)&&(h.display=u);else{g?"hidden"in g&&(p=g.hidden):g=vt.access(e,"fxshow",{}),o&&(g.hidden=!p),p?Q(e).show():d.done(function(){Q(e).hide()}),d.done(function(){var t;vt.remove(e,"fxshow");for(t in f)Q.style(e,t,f[t])});for(i in f)a=_(p?g[i]:0,i,d),i in g||(g[i]=a.start,p&&(a.end=a.start,a.start="width"===i||"height"===i?1:0))}}function A(e,t){var n,i,r,o,a;for(n in e)if(i=Q.camelCase(n),r=t[i],o=e[n],Q.isArray(o)&&(r=o[1],o=e[n]=o[0]),n!==i&&(e[i]=o,delete e[n]),a=Q.cssHooks[i],a&&"expand"in a){o=a.expand(o),delete e[i];for(n in o)n in e||(e[n]=o[n],t[n]=r)}else t[i]=r}function k(e,t,n){var i,r,o=0,a=tn.length,s=Q.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Jt||D(),n=Math.max(0,u.startTime+u.duration-t),i=n/u.duration||0,o=1-i,a=0,l=u.tweens.length;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,n]),1>o&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:Q.extend({},t),opts:Q.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Jt||D(),duration:n.duration,tweens:[],createTween:function(t,n){var i=Q.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(r)return this;for(r=!0;i>n;n++)u.tweens[n].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(A(c,u.opts.specialEasing);a>o;o++)if(i=tn[o].call(u,e,c,u.opts))return i;return Q.map(c,_,u),Q.isFunction(u.opts.start)&&u.opts.start.call(e,u),Q.fx.timer(Q.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function M(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,o=t.toLowerCase().match(ht)||[];if(Q.isFunction(n))for(;i=o[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function L(e,t,n,i){function r(s){var l;return o[s]=!0,Q.each(e[s]||[],function(e,s){var u=s(t,n,i);return"string"!=typeof u||a||o[u]?a?!(l=u):void 0:(t.dataTypes.unshift(u),r(u),!1)}),l}var o={},a=e===wn;return r(t.dataTypes[0])||!o["*"]&&r("*")}function F(e,t){var n,i,r=Q.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&Q.extend(!0,e,i),e}function B(e,t,n){for(var i,r,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in s)if(s[r]&&s[r].test(i)){l.unshift(r);break}if(l[0]in n)o=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}a||(a=r)}o=o||a}return o?(o!==l[0]&&l.unshift(o),n[o]):void 0}function H(e,t,n,i){var r,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a)for(r in u)if(s=r.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[r]:u[r]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(d){return{state:"parsererror",error:a?d:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function V(e,t,n,i){var r;if(Q.isArray(t))Q.each(t,function(t,r){n||xn.test(e)?i(e,r):V(e+"["+("object"==typeof r?t:"")+"]",r,n,i)});else if(n||"object"!==Q.type(t))i(e,t);else for(r in t)V(e+"["+r+"]",t[r],n,i)}function K(e){return Q.isWindow(e)?e:9===e.nodeType&&e.defaultView}var U=[],j=U.slice,$=U.concat,W=U.push,q=U.indexOf,G={},z=G.toString,X=G.hasOwnProperty,J={},Y=e.document,Z="2.1.3",Q=function(e,t){return new Q.fn.init(e,t)},et=/^[\s\uFEFF ]+|[\s\uFEFF ]+$/g,tt=/^-ms-/,nt=/-([\da-z])/gi,it=function(e,t){return t.toUpperCase()};Q.fn=Q.prototype={jquery:Z,constructor:Q,selector:"",length:0,toArray:function(){return j.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:j.call(this)},pushStack:function(e){var t=Q.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return Q.each(this,e,t)},map:function(e){return this.pushStack(Q.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(j.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:W,sort:U.sort,splice:U.splice},Q.extend=Q.fn.extend=function(){var e,t,n,i,r,o,a=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[s]||{},s++),"object"==typeof a||Q.isFunction(a)||(a={}),s===l&&(a=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],i=e[t],a!==i&&(u&&i&&(Q.isPlainObject(i)||(r=Q.isArray(i)))?(r?(r=!1,o=n&&Q.isArray(n)?n:[]):o=n&&Q.isPlainObject(n)?n:{},a[t]=Q.extend(u,o,i)):void 0!==i&&(a[t]=i));return a},Q.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===Q.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!Q.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==Q.type(e)||e.nodeType||Q.isWindow(e)?!1:e.constructor&&!X.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?G[z.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=Q.trim(e),e&&(1===e.indexOf("use strict")?(t=Y.createElement("script"),t.text=e,Y.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(tt,"ms-").replace(nt,it)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r,o=0,a=e.length,s=n(e);if(i){if(s)for(;a>o&&(r=t.apply(e[o],i),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],i),r===!1)break}else if(s)for(;a>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(et,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?Q.merge(i,"string"==typeof e?[e]:e):W.call(i,e)),i},inArray:function(e,t,n){return null==t?-1:q.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;n>i;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i,r=[],o=0,a=e.length,s=!n;a>o;o++)i=!t(e[o],o),i!==s&&r.push(e[o]);return r},map:function(e,t,i){var r,o=0,a=e.length,s=n(e),l=[];if(s)for(;a>o;o++)r=t(e[o],o,i),null!=r&&l.push(r);else for(o in e)r=t(e[o],o,i),null!=r&&l.push(r);return $.apply([],l)},guid:1,proxy:function(e,t){var n,i,r;return"string"==typeof t&&(n=e[t],t=e,e=n),Q.isFunction(e)?(i=j.call(arguments,2),r=function(){return e.apply(t||this,i.concat(j.call(arguments)))},r.guid=e.guid=e.guid||Q.guid++,r):void 0},now:Date.now,support:J}),Q.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){G["[object "+t+"]"]=t.toLowerCase()});var rt=function(e){function t(e,t,n,i){var r,o,a,s,l,u,d,h,p,g;if((t?t.ownerDocument||t:V)!==O&&_(t),t=t||O,n=n||[],s=t.nodeType,"string"!=typeof e||!e||1!==s&&9!==s&&11!==s)return n;if(!i&&k){if(11!==s&&(r=yt.exec(e)))if(a=r[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&B(t,o)&&o.id===a)return n.push(o),n}else{if(r[2])return Z.apply(n,t.getElementsByTagName(e)),n;if((a=r[3])&&b.getElementsByClassName)return Z.apply(n,t.getElementsByClassName(a)),n}if(b.qsa&&(!M||!M.test(e))){if(h=d=H,p=t,g=1!==s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(u=x(e),(d=t.getAttribute("id"))?h=d.replace(wt,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",l=u.length;l--;)u[l]=h+f(u[l]);p=St.test(e)&&c(t.parentNode)||t,g=u.join(",")}if(g)try{return Z.apply(n,p.querySelectorAll(g)),n}catch(m){}finally{d||t.removeAttribute("id")}}}return T(e.replace(lt,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>C.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[H]=!0,e}function r(e){var t=O.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),i=e.length;i--;)C.attrHandle[n[i]]=t}function a(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||G)-(~e.sourceIndex||G);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function s(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return i(function(t){return t=+t,i(function(n,i){for(var r,o=e([],n.length,t),a=o.length;a--;)n[r=o[a]]&&(n[r]=!(i[r]=n[r]))})})}function c(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function d(){}function f(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function h(e,t,n){var i=t.dir,r=n&&"parentNode"===i,o=U++;return t.first?function(t,n,o){for(;t=t[i];)if(1===t.nodeType||r)return e(t,n,o)}:function(t,n,a){var s,l,u=[K,o];if(a){for(;t=t[i];)if((1===t.nodeType||r)&&e(t,n,a))return!0}else for(;t=t[i];)if(1===t.nodeType||r){if(l=t[H]||(t[H]={}),(s=l[i])&&s[0]===K&&s[1]===o)return u[2]=s[2];if(l[i]=u,u[2]=e(t,n,a))return!0}}}function p(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function g(e,n,i){for(var r=0,o=n.length;o>r;r++)t(e,n[r],i);return i}function m(e,t,n,i,r){for(var o,a=[],s=0,l=e.length,u=null!=t;l>s;s++)(o=e[s])&&(!n||n(o,i,r))&&(a.push(o),u&&t.push(s));return a}function v(e,t,n,r,o,a){return r&&!r[H]&&(r=v(r)),o&&!o[H]&&(o=v(o,a)),i(function(i,a,s,l){var u,c,d,f=[],h=[],p=a.length,v=i||g(t||"*",s.nodeType?[s]:s,[]),y=!e||!i&&t?v:m(v,f,e,s,l),S=n?o||(i?e:p||r)?[]:a:y;if(n&&n(y,S,s,l),r)for(u=m(S,h),r(u,[],s,l),c=u.length;c--;)(d=u[c])&&(S[h[c]]=!(y[h[c]]=d));if(i){if(o||e){if(o){for(u=[],c=S.length;c--;)(d=S[c])&&u.push(y[c]=d);o(null,S=[],u,l)}for(c=S.length;c--;)(d=S[c])&&(u=o?et(i,d):f[c])>-1&&(i[u]=!(a[u]=d))}}else S=m(S===a?S.splice(p,S.length):S),o?o(null,a,S,l):Z.apply(a,S)})}function y(e){for(var t,n,i,r=e.length,o=C.relative[e[0].type],a=o||C.relative[" "],s=o?1:0,l=h(function(e){return e===t},a,!0),u=h(function(e){return et(t,e)>-1},a,!0),c=[function(e,n,i){var r=!o&&(i||n!==N)||((t=n).nodeType?l(e,n,i):u(e,n,i));return t=null,r}];r>s;s++)if(n=C.relative[e[s].type])c=[h(p(c),n)];else{if(n=C.filter[e[s].type].apply(null,e[s].matches),n[H]){for(i=++s;r>i&&!C.relative[e[i].type];i++);return v(s>1&&p(c),s>1&&f(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(lt,"$1"),n,i>s&&y(e.slice(s,i)),r>i&&y(e=e.slice(i)),r>i&&f(e))}c.push(n)}return p(c)}function S(e,n){var r=n.length>0,o=e.length>0,a=function(i,a,s,l,u){var c,d,f,h=0,p="0",g=i&&[],v=[],y=N,S=i||o&&C.find.TAG("*",u),w=K+=null==y?1:Math.random()||.1,b=S.length;for(u&&(N=a!==O&&a);p!==b&&null!=(c=S[p]);p++){if(o&&c){for(d=0;f=e[d++];)if(f(c,a,s)){l.push(c);break}u&&(K=w)}r&&((c=!f&&c)&&h--,i&&g.push(c))}if(h+=p,r&&p!==h){for(d=0;f=n[d++];)f(g,v,a,s);if(i){if(h>0)for(;p--;)g[p]||v[p]||(v[p]=J.call(l));v=m(v)}Z.apply(l,v),u&&!i&&v.length>0&&h+n.length>1&&t.uniqueSort(l)}return u&&(K=w,N=y),g};return r?i(a):a}var w,b,C,R,E,x,I,T,N,D,P,_,O,A,k,M,L,F,B,H="sizzle"+1*new Date,V=e.document,K=0,U=0,j=n(),$=n(),W=n(),q=function(e,t){return e===t&&(P=!0),0},G=1<<31,z={}.hasOwnProperty,X=[],J=X.pop,Y=X.push,Z=X.push,Q=X.slice,et=function(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},tt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",nt="[\\x20\\t\\r\\n\\f]",it="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",rt=it.replace("w","w#"),ot="\\["+nt+"*("+it+")(?:"+nt+"*([*^$|!~]?=)"+nt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+rt+"))|)"+nt+"*\\]",at=":("+it+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ot+")*)|.*)\\)|)",st=new RegExp(nt+"+","g"),lt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g"),ut=new RegExp("^"+nt+"*,"+nt+"*"),ct=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),dt=new RegExp("="+nt+"*([^\\]'\"]*?)"+nt+"*\\]","g"),ft=new RegExp(at),ht=new RegExp("^"+rt+"$"),pt={ID:new RegExp("^#("+it+")"),CLASS:new RegExp("^\\.("+it+")"),TAG:new RegExp("^("+it.replace("w","w*")+")"),ATTR:new RegExp("^"+ot),PSEUDO:new RegExp("^"+at),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+tt+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},gt=/^(?:input|select|textarea|button)$/i,mt=/^h\d$/i,vt=/^[^{]+\{\s*\[native \w/,yt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,St=/[+~]/,wt=/'|\\/g,bt=new RegExp("\\\\([\\da-f]{1,6}"+nt+"?|("+nt+")|.)","ig"),Ct=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},Rt=function(){_()};try{Z.apply(X=Q.call(V.childNodes),V.childNodes),X[V.childNodes.length].nodeType}catch(Et){Z={apply:X.length?function(e,t){Y.apply(e,Q.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}b=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},_=t.setDocument=function(e){var t,n,i=e?e.ownerDocument||e:V;return i!==O&&9===i.nodeType&&i.documentElement?(O=i,A=i.documentElement,n=i.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",Rt,!1):n.attachEvent&&n.attachEvent("onunload",Rt)),k=!E(i),b.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=r(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=vt.test(i.getElementsByClassName),b.getById=r(function(e){return A.appendChild(e).id=H,!i.getElementsByName||!i.getElementsByName(H).length}),b.getById?(C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&k){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},C.filter.ID=function(e){var t=e.replace(bt,Ct);return function(e){return e.getAttribute("id")===t}}):(delete C.find.ID,C.filter.ID=function(e){var t=e.replace(bt,Ct);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),C.find.TAG=b.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[r++];)1===n.nodeType&&i.push(n);return i}return o},C.find.CLASS=b.getElementsByClassName&&function(e,t){return k?t.getElementsByClassName(e):void 0},L=[],M=[],(b.qsa=vt.test(i.querySelectorAll))&&(r(function(e){A.appendChild(e).innerHTML="<a id='"+H+"'></a><select id='"+H+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&M.push("[*^$]="+nt+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||M.push("\\["+nt+"*(?:value|"+tt+")"),e.querySelectorAll("[id~="+H+"-]").length||M.push("~="),e.querySelectorAll(":checked").length||M.push(":checked"),e.querySelectorAll("a#"+H+"+*").length||M.push(".#.+[+~]")}),r(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&M.push("name"+nt+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||M.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),M.push(",.*:")})),(b.matchesSelector=vt.test(F=A.matches||A.webkitMatchesSelector||A.mozMatchesSelector||A.oMatchesSelector||A.msMatchesSelector))&&r(function(e){b.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),L.push("!=",at)}),M=M.length&&new RegExp(M.join("|")),L=L.length&&new RegExp(L.join("|")),t=vt.test(A.compareDocumentPosition),B=t||vt.test(A.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=t?function(e,t){if(e===t)return P=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!b.sortDetached&&t.compareDocumentPosition(e)===n?e===i||e.ownerDocument===V&&B(V,e)?-1:t===i||t.ownerDocument===V&&B(V,t)?1:D?et(D,e)-et(D,t):0:4&n?-1:1)}:function(e,t){if(e===t)return P=!0,0;var n,r=0,o=e.parentNode,s=t.parentNode,l=[e],u=[t];if(!o||!s)return e===i?-1:t===i?1:o?-1:s?1:D?et(D,e)-et(D,t):0;if(o===s)return a(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;l[r]===u[r];)r++;return r?a(l[r],u[r]):l[r]===V?-1:u[r]===V?1:0},i):O},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==O&&_(e),n=n.replace(dt,"='$1']"),!(!b.matchesSelector||!k||L&&L.test(n)||M&&M.test(n)))try{var i=F.call(e,n);if(i||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(r){}return t(n,O,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==O&&_(e),B(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==O&&_(e);var n=C.attrHandle[t.toLowerCase()],i=n&&z.call(C.attrHandle,t.toLowerCase())?n(e,t,!k):void 0;return void 0!==i?i:b.attributes||!k?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,r=0;if(P=!b.detectDuplicates,D=!b.sortStable&&e.slice(0),e.sort(q),P){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return D=null,e},R=t.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=R(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=R(t);return n},C=t.selectors={cacheLength:50,createPseudo:i,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(bt,Ct),e[3]=(e[3]||e[4]||e[5]||"").replace(bt,Ct),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return pt.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&ft.test(n)&&(t=x(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(bt,Ct).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=j[e+" "];return t||(t=new RegExp("(^|"+nt+")"+e+"("+nt+"|$)"))&&j(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(r){var o=t.attr(r,e);return null==o?"!="===n:n?(o+="","="===n?o===i:"!="===n?o!==i:"^="===n?i&&0===o.indexOf(i):"*="===n?i&&o.indexOf(i)>-1:"$="===n?i&&o.slice(-i.length)===i:"~="===n?(" "+o.replace(st," ")+" ").indexOf(i)>-1:"|="===n?o===i||o.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,n,i,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,l){var u,c,d,f,h,p,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(m){if(o){for(;g;){for(d=t;d=d[g];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[a?m.firstChild:m.lastChild],a&&y){for(c=m[H]||(m[H]={}),u=c[e]||[],h=u[0]===K&&u[1],f=u[0]===K&&u[2],d=h&&m.childNodes[h];d=++h&&d&&d[g]||(f=h=0)||p.pop();)if(1===d.nodeType&&++f&&d===t){c[e]=[K,h,f];break}}else if(y&&(u=(t[H]||(t[H]={}))[e])&&u[0]===K)f=u[1];else for(;(d=++h&&d&&d[g]||(f=h=0)||p.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++f||(y&&((d[H]||(d[H]={}))[e]=[K,f]),d!==t)););return f-=r,f===i||f%i===0&&f/i>=0}}},PSEUDO:function(e,n){var r,o=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[H]?o(n):o.length>1?(r=[e,e,"",n],C.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,r=o(e,n),a=r.length;a--;)i=et(e,r[a]),e[i]=!(t[i]=r[a])}):function(e){return o(e,0,r)}):o}},pseudos:{not:i(function(e){var t=[],n=[],r=I(e.replace(lt,"$1"));return r[H]?i(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return e=e.replace(bt,Ct),function(t){return(t.textContent||t.innerText||R(t)).indexOf(e)>-1}}),lang:i(function(e){return ht.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(bt,Ct).toLowerCase(),function(t){var n;do if(n=k?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===A},focus:function(e){return e===O.activeElement&&(!O.hasFocus||O.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return mt.test(e.nodeName)},input:function(e){return gt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:u(function(e,t,n){for(var i=0>n?n+t:n;++i<t;)e.push(i);return e})}},C.pseudos.nth=C.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[w]=s(w);for(w in{submit:!0,reset:!0})C.pseudos[w]=l(w);return d.prototype=C.filters=C.pseudos,C.setFilters=new d,x=t.tokenize=function(e,n){var i,r,o,a,s,l,u,c=$[e+" "];if(c)return n?0:c.slice(0);for(s=e,l=[],u=C.preFilter;s;){(!i||(r=ut.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),i=!1,(r=ct.exec(s))&&(i=r.shift(),o.push({value:i,type:r[0].replace(lt," ")}),s=s.slice(i.length));for(a in C.filter)!(r=pt[a].exec(s))||u[a]&&!(r=u[a](r))||(i=r.shift(),o.push({value:i,type:a,matches:r}),s=s.slice(i.length));if(!i)break}return n?s.length:s?t.error(e):$(e,l).slice(0)},I=t.compile=function(e,t){var n,i=[],r=[],o=W[e+" "];if(!o){for(t||(t=x(e)),n=t.length;n--;)o=y(t[n]),o[H]?i.push(o):r.push(o);o=W(e,S(r,i)),o.selector=e}return o},T=t.select=function(e,t,n,i){var r,o,a,s,l,u="function"==typeof e&&e,d=!i&&x(e=u.selector||e);if(n=n||[],1===d.length){if(o=d[0]=d[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&b.getById&&9===t.nodeType&&k&&C.relative[o[1].type]){if(t=(C.find.ID(a.matches[0].replace(bt,Ct),t)||[])[0],!t)return n;u&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=pt.needsContext.test(e)?0:o.length;r--&&(a=o[r],!C.relative[s=a.type]);)if((l=C.find[s])&&(i=l(a.matches[0].replace(bt,Ct),St.test(o[0].type)&&c(t.parentNode)||t))){if(o.splice(r,1),e=i.length&&f(o),!e)return Z.apply(n,i),n;break}}return(u||I(e,d))(i,t,!k,n,St.test(e)&&c(t.parentNode)||t),n},b.sortStable=H.split("").sort(q).join("")===H,b.detectDuplicates=!!P,_(),b.sortDetached=r(function(e){return 1&e.compareDocumentPosition(O.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(tt,function(e,t,n){var i;return n?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);Q.find=rt,Q.expr=rt.selectors,Q.expr[":"]=Q.expr.pseudos,Q.unique=rt.uniqueSort,Q.text=rt.getText,Q.isXMLDoc=rt.isXML,Q.contains=rt.contains;var ot=Q.expr.match.needsContext,at=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,st=/^.[^:#\[\.,]*$/;Q.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?Q.find.matchesSelector(i,e)?[i]:[]:Q.find.matches(e,Q.grep(t,function(e){return 1===e.nodeType}))},Q.fn.extend({find:function(e){var t,n=this.length,i=[],r=this;if("string"!=typeof e)return this.pushStack(Q(e).filter(function(){for(t=0;n>t;t++)if(Q.contains(r[t],this))return!0
}));for(t=0;n>t;t++)Q.find(e,r[t],i);return i=this.pushStack(n>1?Q.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&ot.test(e)?Q(e):e||[],!1).length}});var lt,ut=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=Q.fn.init=function(e,t){var n,i;if(!e)return this;if("string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ut.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||lt).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof Q?t[0]:t,Q.merge(this,Q.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:Y,!0)),at.test(n[1])&&Q.isPlainObject(t))for(n in t)Q.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return i=Y.getElementById(n[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=Y,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):Q.isFunction(e)?"undefined"!=typeof lt.ready?lt.ready(e):e(Q):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),Q.makeArray(e,this))};ct.prototype=Q.fn,lt=Q(Y);var dt=/^(?:parents|prev(?:Until|All))/,ft={children:!0,contents:!0,next:!0,prev:!0};Q.extend({dir:function(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&Q(e).is(n))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),Q.fn.extend({has:function(e){var t=Q(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(Q.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,i=0,r=this.length,o=[],a=ot.test(e)||"string"!=typeof e?Q(e,t||this.context):0;r>i;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&Q.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?Q.unique(o):o)},index:function(e){return e?"string"==typeof e?q.call(Q(e),this[0]):q.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Q.unique(Q.merge(this.get(),Q(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Q.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Q.dir(e,"parentNode")},parentsUntil:function(e,t,n){return Q.dir(e,"parentNode",n)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return Q.dir(e,"nextSibling")},prevAll:function(e){return Q.dir(e,"previousSibling")},nextUntil:function(e,t,n){return Q.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return Q.dir(e,"previousSibling",n)},siblings:function(e){return Q.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return Q.sibling(e.firstChild)},contents:function(e){return e.contentDocument||Q.merge([],e.childNodes)}},function(e,t){Q.fn[e]=function(n,i){var r=Q.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=Q.filter(i,r)),this.length>1&&(ft[e]||Q.unique(r),dt.test(e)&&r.reverse()),this.pushStack(r)}});var ht=/\S+/g,pt={};Q.Callbacks=function(e){e="string"==typeof e?pt[e]||o(e):Q.extend({},e);var t,n,i,r,a,s,l=[],u=!e.once&&[],c=function(o){for(t=e.memory&&o,n=!0,s=r||0,r=0,a=l.length,i=!0;l&&a>s;s++)if(l[s].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,l&&(u?u.length&&c(u.shift()):t?l=[]:d.disable())},d={add:function(){if(l){var n=l.length;!function o(t){Q.each(t,function(t,n){var i=Q.type(n);"function"===i?e.unique&&d.has(n)||l.push(n):n&&n.length&&"string"!==i&&o(n)})}(arguments),i?a=l.length:t&&(r=n,c(t))}return this},remove:function(){return l&&Q.each(arguments,function(e,t){for(var n;(n=Q.inArray(t,l,n))>-1;)l.splice(n,1),i&&(a>=n&&a--,s>=n&&s--)}),this},has:function(e){return e?Q.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],a=0,this},disable:function(){return l=u=t=void 0,this},disabled:function(){return!l},lock:function(){return u=void 0,t||d.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!l||n&&!u||(t=t||[],t=[e,t.slice?t.slice():t],i?u.push(t):c(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!n}};return d},Q.extend({Deferred:function(e){var t=[["resolve","done",Q.Callbacks("once memory"),"resolved"],["reject","fail",Q.Callbacks("once memory"),"rejected"],["notify","progress",Q.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return Q.Deferred(function(n){Q.each(t,function(t,o){var a=Q.isFunction(e[t])&&e[t];r[o[1]](function(){var e=a&&a.apply(this,arguments);e&&Q.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o[0]+"With"](this===i?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?Q.extend(e,i):i}},r={};return i.pipe=i.then,Q.each(t,function(e,o){var a=o[2],s=o[3];i[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?i:this,arguments),this},r[o[0]+"With"]=a.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,o=j.call(arguments),a=o.length,s=1!==a||e&&Q.isFunction(e.promise)?a:0,l=1===s?e:Q.Deferred(),u=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?j.call(arguments):r,i===t?l.notifyWith(n,i):--s||l.resolveWith(n,i)}};if(a>1)for(t=new Array(a),n=new Array(a),i=new Array(a);a>r;r++)o[r]&&Q.isFunction(o[r].promise)?o[r].promise().done(u(r,i,o)).fail(l.reject).progress(u(r,n,t)):--s;return s||l.resolveWith(i,o),l.promise()}});var gt;Q.fn.ready=function(e){return Q.ready.promise().done(e),this},Q.extend({isReady:!1,readyWait:1,holdReady:function(e){e?Q.readyWait++:Q.ready(!0)},ready:function(e){(e===!0?--Q.readyWait:Q.isReady)||(Q.isReady=!0,e!==!0&&--Q.readyWait>0||(gt.resolveWith(Y,[Q]),Q.fn.triggerHandler&&(Q(Y).triggerHandler("ready"),Q(Y).off("ready"))))}}),Q.ready.promise=function(t){return gt||(gt=Q.Deferred(),"complete"===Y.readyState?setTimeout(Q.ready):(Y.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1))),gt.promise(t)},Q.ready.promise();var mt=Q.access=function(e,t,n,i,r,o,a){var s=0,l=e.length,u=null==n;if("object"===Q.type(n)){r=!0;for(s in n)Q.access(e,t,s,n[s],!0,o,a)}else if(void 0!==i&&(r=!0,Q.isFunction(i)||(a=!0),u&&(a?(t.call(e,i),t=null):(u=t,t=function(e,t,n){return u.call(Q(e),n)})),t))for(;l>s;s++)t(e[s],n,a?i:i.call(e[s],s,t(e[s],n)));return r?e:u?t.call(e):l?t(e[0],n):o};Q.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},s.uid=1,s.accepts=Q.acceptData,s.prototype={key:function(e){if(!s.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=s.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(i){t[this.expando]=n,Q.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var i,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=n;else if(Q.isEmptyObject(o))Q.extend(this.cache[r],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,n){var i;return void 0===t||t&&"string"==typeof t&&void 0===n?(i=this.get(e,t),void 0!==i?i:this.get(e,Q.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i,r,o=this.key(e),a=this.cache[o];if(void 0===t)this.cache[o]={};else{Q.isArray(t)?i=t.concat(t.map(Q.camelCase)):(r=Q.camelCase(t),t in a?i=[t,r]:(i=r,i=i in a?[i]:i.match(ht)||[])),n=i.length;for(;n--;)delete a[i[n]]}},hasData:function(e){return!Q.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var vt=new s,yt=new s,St=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,wt=/([A-Z])/g;Q.extend({hasData:function(e){return yt.hasData(e)||vt.hasData(e)},data:function(e,t,n){return yt.access(e,t,n)},removeData:function(e,t){yt.remove(e,t)},_data:function(e,t,n){return vt.access(e,t,n)},_removeData:function(e,t){vt.remove(e,t)}}),Q.fn.extend({data:function(e,t){var n,i,r,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(r=yt.get(o),1===o.nodeType&&!vt.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&(i=a[n].name,0===i.indexOf("data-")&&(i=Q.camelCase(i.slice(5)),l(o,i,r[i])));vt.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){yt.set(this,e)}):mt(this,function(t){var n,i=Q.camelCase(e);if(o&&void 0===t){if(n=yt.get(o,e),void 0!==n)return n;if(n=yt.get(o,i),void 0!==n)return n;if(n=l(o,i,void 0),void 0!==n)return n}else this.each(function(){var n=yt.get(this,i);yt.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&yt.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){yt.remove(this,e)})}}),Q.extend({queue:function(e,t,n){var i;return e?(t=(t||"fx")+"queue",i=vt.get(e,t),n&&(!i||Q.isArray(n)?i=vt.access(e,t,Q.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=Q.queue(e,t),i=n.length,r=n.shift(),o=Q._queueHooks(e,t),a=function(){Q.dequeue(e,t)};"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return vt.get(e,n)||vt.access(e,n,{empty:Q.Callbacks("once memory").add(function(){vt.remove(e,[t+"queue",n])})})}}),Q.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?Q.queue(this[0],e):void 0===t?this:this.each(function(){var n=Q.queue(this,e,t);Q._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&Q.dequeue(this,e)})},dequeue:function(e){return this.each(function(){Q.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=Q.Deferred(),o=this,a=this.length,s=function(){--i||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)n=vt.get(o[a],e+"queueHooks"),n&&n.empty&&(i++,n.empty.add(s));return s(),r.promise(t)}});var bt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ct=["Top","Right","Bottom","Left"],Rt=function(e,t){return e=t||e,"none"===Q.css(e,"display")||!Q.contains(e.ownerDocument,e)},Et=/^(?:checkbox|radio)$/i;!function(){var e=Y.createDocumentFragment(),t=e.appendChild(Y.createElement("div")),n=Y.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),J.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",J.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var xt="undefined";J.focusinBubbles="onfocusin"in e;var It=/^key/,Tt=/^(?:mouse|pointer|contextmenu)|click/,Nt=/^(?:focusinfocus|focusoutblur)$/,Dt=/^([^.]*)(?:\.(.+)|)$/;Q.event={global:{},add:function(e,t,n,i,r){var o,a,s,l,u,c,d,f,h,p,g,m=vt.get(e);if(m)for(n.handler&&(o=n,n=o.handler,r=o.selector),n.guid||(n.guid=Q.guid++),(l=m.events)||(l=m.events={}),(a=m.handle)||(a=m.handle=function(t){return typeof Q!==xt&&Q.event.triggered!==t.type?Q.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(ht)||[""],u=t.length;u--;)s=Dt.exec(t[u])||[],h=g=s[1],p=(s[2]||"").split(".").sort(),h&&(d=Q.event.special[h]||{},h=(r?d.delegateType:d.bindType)||h,d=Q.event.special[h]||{},c=Q.extend({type:h,origType:g,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&Q.expr.match.needsContext.test(r),namespace:p.join(".")},o),(f=l[h])||(f=l[h]=[],f.delegateCount=0,d.setup&&d.setup.call(e,i,p,a)!==!1||e.addEventListener&&e.addEventListener(h,a,!1)),d.add&&(d.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),r?f.splice(f.delegateCount++,0,c):f.push(c),Q.event.global[h]=!0)},remove:function(e,t,n,i,r){var o,a,s,l,u,c,d,f,h,p,g,m=vt.hasData(e)&&vt.get(e);if(m&&(l=m.events)){for(t=(t||"").match(ht)||[""],u=t.length;u--;)if(s=Dt.exec(t[u])||[],h=g=s[1],p=(s[2]||"").split(".").sort(),h){for(d=Q.event.special[h]||{},h=(i?d.delegateType:d.bindType)||h,f=l[h]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)c=f[o],!r&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,d.remove&&d.remove.call(e,c));a&&!f.length&&(d.teardown&&d.teardown.call(e,p,m.handle)!==!1||Q.removeEvent(e,h,m.handle),delete l[h])}else for(h in l)Q.event.remove(e,h+t[u],n,i,!0);Q.isEmptyObject(l)&&(delete m.handle,vt.remove(e,"events"))}},trigger:function(t,n,i,r){var o,a,s,l,u,c,d,f=[i||Y],h=X.call(t,"type")?t.type:t,p=X.call(t,"namespace")?t.namespace.split("."):[];if(a=s=i=i||Y,3!==i.nodeType&&8!==i.nodeType&&!Nt.test(h+Q.event.triggered)&&(h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),u=h.indexOf(":")<0&&"on"+h,t=t[Q.expando]?t:new Q.Event(h,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=p.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:Q.makeArray(n,[t]),d=Q.event.special[h]||{},r||!d.trigger||d.trigger.apply(i,n)!==!1)){if(!r&&!d.noBubble&&!Q.isWindow(i)){for(l=d.delegateType||h,Nt.test(l+h)||(a=a.parentNode);a;a=a.parentNode)f.push(a),s=a;s===(i.ownerDocument||Y)&&f.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=f[o++])&&!t.isPropagationStopped();)t.type=o>1?l:d.bindType||h,c=(vt.get(a,"events")||{})[t.type]&&vt.get(a,"handle"),c&&c.apply(a,n),c=u&&a[u],c&&c.apply&&Q.acceptData(a)&&(t.result=c.apply(a,n),t.result===!1&&t.preventDefault());return t.type=h,r||t.isDefaultPrevented()||d._default&&d._default.apply(f.pop(),n)!==!1||!Q.acceptData(i)||u&&Q.isFunction(i[h])&&!Q.isWindow(i)&&(s=i[u],s&&(i[u]=null),Q.event.triggered=h,i[h](),Q.event.triggered=void 0,s&&(i[u]=s)),t.result}},dispatch:function(e){e=Q.event.fix(e);var t,n,i,r,o,a=[],s=j.call(arguments),l=(vt.get(this,"events")||{})[e.type]||[],u=Q.event.special[e.type]||{};if(s[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(a=Q.event.handlers.call(this,e,l),t=0;(r=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,n=0;(o=r.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((Q.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,s),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,i,r,o,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(i=[],n=0;s>n;n++)o=t[n],r=o.selector+" ",void 0===i[r]&&(i[r]=o.needsContext?Q(r,this).index(l)>=0:Q.find(r,this,null,[l]).length),i[r]&&i.push(o);i.length&&a.push({elem:l,handlers:i})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,r,o=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||Y,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[Q.expando])return e;var t,n,i,r=e.type,o=e,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=Tt.test(r)?this.mouseHooks:It.test(r)?this.keyHooks:{}),i=a.props?this.props.concat(a.props):this.props,e=new Q.Event(o),t=i.length;t--;)n=i[t],e[n]=o[n];return e.target||(e.target=Y),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==d()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===d()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Q.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return Q.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var r=Q.extend(new Q.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?Q.event.trigger(r,null,t):Q.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},Q.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},Q.Event=function(e,t){return this instanceof Q.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?u:c):this.type=e,t&&Q.extend(this,t),this.timeStamp=e&&e.timeStamp||Q.now(),void(this[Q.expando]=!0)):new Q.Event(e,t)},Q.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=u,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=u,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=u,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},Q.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Q.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==i&&!Q.contains(i,r))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),J.focusinBubbles||Q.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){Q.event.simulate(t,e.target,Q.event.fix(e),!0)};Q.event.special[t]={setup:function(){var i=this.ownerDocument||this,r=vt.access(i,t);r||i.addEventListener(e,n,!0),vt.access(i,t,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this,r=vt.access(i,t)-1;r?vt.access(i,t,r):(i.removeEventListener(e,n,!0),vt.remove(i,t))}}}),Q.fn.extend({on:function(e,t,n,i,r){var o,a;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(a in e)this.on(a,t,n,e[a],r);return this}if(null==n&&null==i?(i=t,n=t=void 0):null==i&&("string"==typeof t?(i=n,n=void 0):(i=n,n=t,t=void 0)),i===!1)i=c;else if(!i)return this;return 1===r&&(o=i,i=function(e){return Q().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=Q.guid++)),this.each(function(){Q.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,Q(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=c),this.each(function(){Q.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){Q.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?Q.event.trigger(e,t,n,!0):void 0}});var Pt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_t=/<([\w:]+)/,Ot=/<|&#?\w+;/,At=/<(?:script|style|link)/i,kt=/checked\s*(?:[^=]|=\s*.checked.)/i,Mt=/^$|\/(?:java|ecma)script/i,Lt=/^true\/(.*)/,Ft=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Bt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Bt.optgroup=Bt.option,Bt.tbody=Bt.tfoot=Bt.colgroup=Bt.caption=Bt.thead,Bt.th=Bt.td,Q.extend({clone:function(e,t,n){var i,r,o,a,s=e.cloneNode(!0),l=Q.contains(e.ownerDocument,e);if(!(J.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Q.isXMLDoc(e)))for(a=v(s),o=v(e),i=0,r=o.length;r>i;i++)y(o[i],a[i]);if(t)if(n)for(o=o||v(e),a=a||v(s),i=0,r=o.length;r>i;i++)m(o[i],a[i]);else m(e,s);return a=v(s,"script"),a.length>0&&g(a,!l&&v(e,"script")),s},buildFragment:function(e,t,n,i){for(var r,o,a,s,l,u,c=t.createDocumentFragment(),d=[],f=0,h=e.length;h>f;f++)if(r=e[f],r||0===r)if("object"===Q.type(r))Q.merge(d,r.nodeType?[r]:r);else if(Ot.test(r)){for(o=o||c.appendChild(t.createElement("div")),a=(_t.exec(r)||["",""])[1].toLowerCase(),s=Bt[a]||Bt._default,o.innerHTML=s[1]+r.replace(Pt,"<$1></$2>")+s[2],u=s[0];u--;)o=o.lastChild;Q.merge(d,o.childNodes),o=c.firstChild,o.textContent=""}else d.push(t.createTextNode(r));for(c.textContent="",f=0;r=d[f++];)if((!i||-1===Q.inArray(r,i))&&(l=Q.contains(r.ownerDocument,r),o=v(c.appendChild(r),"script"),l&&g(o),n))for(u=0;r=o[u++];)Mt.test(r.type||"")&&n.push(r);return c},cleanData:function(e){for(var t,n,i,r,o=Q.event.special,a=0;void 0!==(n=e[a]);a++){if(Q.acceptData(n)&&(r=n[vt.expando],r&&(t=vt.cache[r]))){if(t.events)for(i in t.events)o[i]?Q.event.remove(n,i):Q.removeEvent(n,i,t.handle);vt.cache[r]&&delete vt.cache[r]}delete yt.cache[n[yt.expando]]}}}),Q.fn.extend({text:function(e){return mt(this,function(e){return void 0===e?Q.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?Q.filter(e,this):this,r=0;null!=(n=i[r]);r++)t||1!==n.nodeType||Q.cleanData(v(n)),n.parentNode&&(t&&Q.contains(n.ownerDocument,n)&&g(v(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(Q.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return Q.clone(this,e,t)})},html:function(e){return mt(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!At.test(e)&&!Bt[(_t.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Pt,"<$1></$2>");try{for(;i>n;n++)t=this[n]||{},1===t.nodeType&&(Q.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,Q.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=$.apply([],e);var n,i,r,o,a,s,l=0,u=this.length,c=this,d=u-1,f=e[0],g=Q.isFunction(f);if(g||u>1&&"string"==typeof f&&!J.checkClone&&kt.test(f))return this.each(function(n){var i=c.eq(n);g&&(e[0]=f.call(this,n,i.html())),i.domManip(e,t)});if(u&&(n=Q.buildFragment(e,this[0].ownerDocument,!1,this),i=n.firstChild,1===n.childNodes.length&&(n=i),i)){for(r=Q.map(v(n,"script"),h),o=r.length;u>l;l++)a=n,l!==d&&(a=Q.clone(a,!0,!0),o&&Q.merge(r,v(a,"script"))),t.call(this[l],a,l);if(o)for(s=r[r.length-1].ownerDocument,Q.map(r,p),l=0;o>l;l++)a=r[l],Mt.test(a.type||"")&&!vt.access(a,"globalEval")&&Q.contains(s,a)&&(a.src?Q._evalUrl&&Q._evalUrl(a.src):Q.globalEval(a.textContent.replace(Ft,"")))}return this}}),Q.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Q.fn[e]=function(e){for(var n,i=[],r=Q(e),o=r.length-1,a=0;o>=a;a++)n=a===o?this:this.clone(!0),Q(r[a])[t](n),W.apply(i,n.get());return this.pushStack(i)}});var Ht,Vt={},Kt=/^margin/,Ut=new RegExp("^("+bt+")(?!px)[a-z%]+$","i"),jt=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a.innerHTML="",r.appendChild(o);var t=e.getComputedStyle(a,null);n="1%"!==t.top,i="4px"===t.width,r.removeChild(o)}var n,i,r=Y.documentElement,o=Y.createElement("div"),a=Y.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",J.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(a),e.getComputedStyle&&Q.extend(J,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==i&&t(),i},reliableMarginRight:function(){var t,n=a.appendChild(Y.createElement("div"));return n.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",a.style.width="1px",r.appendChild(o),t=!parseFloat(e.getComputedStyle(n,null).marginRight),r.removeChild(o),a.removeChild(n),t}}))}(),Q.swap=function(e,t,n,i){var r,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];r=n.apply(e,i||[]);for(o in t)e.style[o]=a[o];return r};var $t=/^(none|table(?!-c[ea]).+)/,Wt=new RegExp("^("+bt+")(.*)$","i"),qt=new RegExp("^([+-])=("+bt+")","i"),Gt={position:"absolute",visibility:"hidden",display:"block"},zt={letterSpacing:"0",fontWeight:"400"},Xt=["Webkit","O","Moz","ms"];Q.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=b(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,a,s=Q.camelCase(t),l=e.style;return t=Q.cssProps[s]||(Q.cssProps[s]=R(l,s)),a=Q.cssHooks[t]||Q.cssHooks[s],void 0===n?a&&"get"in a&&void 0!==(r=a.get(e,!1,i))?r:l[t]:(o=typeof n,"string"===o&&(r=qt.exec(n))&&(n=(r[1]+1)*r[2]+parseFloat(Q.css(e,t)),o="number"),void(null!=n&&n===n&&("number"!==o||Q.cssNumber[s]||(n+="px"),J.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,i))||(l[t]=n))))}},css:function(e,t,n,i){var r,o,a,s=Q.camelCase(t);return t=Q.cssProps[s]||(Q.cssProps[s]=R(e.style,s)),a=Q.cssHooks[t]||Q.cssHooks[s],a&&"get"in a&&(r=a.get(e,!0,n)),void 0===r&&(r=b(e,t,i)),"normal"===r&&t in zt&&(r=zt[t]),""===n||n?(o=parseFloat(r),n===!0||Q.isNumeric(o)?o||0:r):r}}),Q.each(["height","width"],function(e,t){Q.cssHooks[t]={get:function(e,n,i){return n?$t.test(Q.css(e,"display"))&&0===e.offsetWidth?Q.swap(e,Gt,function(){return I(e,t,i)}):I(e,t,i):void 0},set:function(e,n,i){var r=i&&jt(e);return E(e,n,i?x(e,t,i,"border-box"===Q.css(e,"boxSizing",!1,r),r):0)}}}),Q.cssHooks.marginRight=C(J.reliableMarginRight,function(e,t){return t?Q.swap(e,{display:"inline-block"},b,[e,"marginRight"]):void 0}),Q.each({margin:"",padding:"",border:"Width"},function(e,t){Q.cssHooks[e+t]={expand:function(n){for(var i=0,r={},o="string"==typeof n?n.split(" "):[n];4>i;i++)r[e+Ct[i]+t]=o[i]||o[i-2]||o[0];return r}},Kt.test(e)||(Q.cssHooks[e+t].set=E)}),Q.fn.extend({css:function(e,t){return mt(this,function(e,t,n){var i,r,o={},a=0;if(Q.isArray(t)){for(i=jt(e),r=t.length;r>a;a++)o[t[a]]=Q.css(e,t[a],!1,i);return o}return void 0!==n?Q.style(e,t,n):Q.css(e,t)},e,t,arguments.length>1)},show:function(){return T(this,!0)},hide:function(){return T(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Rt(this)?Q(this).show():Q(this).hide()})}}),Q.Tween=N,N.prototype={constructor:N,init:function(e,t,n,i,r,o){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(Q.cssNumber[n]?"":"px")},cur:function(){var e=N.propHooks[this.prop];return e&&e.get?e.get(this):N.propHooks._default.get(this)},run:function(e){var t,n=N.propHooks[this.prop];return this.pos=t=this.options.duration?Q.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):N.propHooks._default.set(this),this}},N.prototype.init.prototype=N.prototype,N.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=Q.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){Q.fx.step[e.prop]?Q.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[Q.cssProps[e.prop]]||Q.cssHooks[e.prop])?Q.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Q.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},Q.fx=N.prototype.init,Q.fx.step={};var Jt,Yt,Zt=/^(?:toggle|show|hide)$/,Qt=new RegExp("^(?:([+-])=|)("+bt+")([a-z%]*)$","i"),en=/queueHooks$/,tn=[O],nn={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),r=Qt.exec(t),o=r&&r[3]||(Q.cssNumber[e]?"":"px"),a=(Q.cssNumber[e]||"px"!==o&&+i)&&Qt.exec(Q.css(n.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],r=r||[],a=+i||1;do s=s||".5",a/=s,Q.style(n.elem,e,a+o);while(s!==(s=n.cur()/i)&&1!==s&&--l)}return r&&(a=n.start=+a||+i||0,n.unit=o,n.end=r[1]?a+(r[1]+1)*r[2]:+r[2]),n}]};Q.Animation=Q.extend(k,{tweener:function(e,t){Q.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;r>i;i++)n=e[i],nn[n]=nn[n]||[],nn[n].unshift(t)},prefilter:function(e,t){t?tn.unshift(e):tn.push(e)}}),Q.speed=function(e,t,n){var i=e&&"object"==typeof e?Q.extend({},e):{complete:n||!n&&t||Q.isFunction(e)&&e,duration:e,easing:n&&t||t&&!Q.isFunction(t)&&t};return i.duration=Q.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in Q.fx.speeds?Q.fx.speeds[i.duration]:Q.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){Q.isFunction(i.old)&&i.old.call(this),i.queue&&Q.dequeue(this,i.queue)},i},Q.fn.extend({fadeTo:function(e,t,n,i){return this.filter(Rt).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=Q.isEmptyObject(e),o=Q.speed(t,n,i),a=function(){var t=k(this,Q.extend({},e),o);(r||vt.get(this,"finish"))&&t.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=Q.timers,a=vt.get(this);if(r)a[r]&&a[r].stop&&i(a[r]);else for(r in a)a[r]&&a[r].stop&&en.test(r)&&i(a[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(n),t=!1,o.splice(r,1));(t||!n)&&Q.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=vt.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],o=Q.timers,a=i?i.length:0;for(n.finish=!0,Q.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);
delete n.finish})}}),Q.each(["toggle","show","hide"],function(e,t){var n=Q.fn[t];Q.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(P(t,!0),e,i,r)}}),Q.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){Q.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),Q.timers=[],Q.fx.tick=function(){var e,t=0,n=Q.timers;for(Jt=Q.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||Q.fx.stop(),Jt=void 0},Q.fx.timer=function(e){Q.timers.push(e),e()?Q.fx.start():Q.timers.pop()},Q.fx.interval=13,Q.fx.start=function(){Yt||(Yt=setInterval(Q.fx.tick,Q.fx.interval))},Q.fx.stop=function(){clearInterval(Yt),Yt=null},Q.fx.speeds={slow:600,fast:200,_default:400},Q.fn.delay=function(e,t){return e=Q.fx?Q.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},function(){var e=Y.createElement("input"),t=Y.createElement("select"),n=t.appendChild(Y.createElement("option"));e.type="checkbox",J.checkOn=""!==e.value,J.optSelected=n.selected,t.disabled=!0,J.optDisabled=!n.disabled,e=Y.createElement("input"),e.value="t",e.type="radio",J.radioValue="t"===e.value}();var rn,on,an=Q.expr.attrHandle;Q.fn.extend({attr:function(e,t){return mt(this,Q.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){Q.removeAttr(this,e)})}}),Q.extend({attr:function(e,t,n){var i,r,o=e.nodeType;return e&&3!==o&&8!==o&&2!==o?typeof e.getAttribute===xt?Q.prop(e,t,n):(1===o&&Q.isXMLDoc(e)||(t=t.toLowerCase(),i=Q.attrHooks[t]||(Q.expr.match.bool.test(t)?on:rn)),void 0===n?i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=Q.find.attr(e,t),null==r?void 0:r):null!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):void Q.removeAttr(e,t)):void 0},removeAttr:function(e,t){var n,i,r=0,o=t&&t.match(ht);if(o&&1===e.nodeType)for(;n=o[r++];)i=Q.propFix[n]||n,Q.expr.match.bool.test(n)&&(e[i]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!J.radioValue&&"radio"===t&&Q.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),on={set:function(e,t,n){return t===!1?Q.removeAttr(e,n):e.setAttribute(n,n),n}},Q.each(Q.expr.match.bool.source.match(/\w+/g),function(e,t){var n=an[t]||Q.find.attr;an[t]=function(e,t,i){var r,o;return i||(o=an[t],an[t]=r,r=null!=n(e,t,i)?t.toLowerCase():null,an[t]=o),r}});var sn=/^(?:input|select|textarea|button)$/i;Q.fn.extend({prop:function(e,t){return mt(this,Q.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[Q.propFix[e]||e]})}}),Q.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,r,o,a=e.nodeType;return e&&3!==a&&8!==a&&2!==a?(o=1!==a||!Q.isXMLDoc(e),o&&(t=Q.propFix[t]||t,r=Q.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]):void 0},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||sn.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),J.optSelected||(Q.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),Q.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Q.propFix[this.toLowerCase()]=this});var ln=/[\t\r\n\f]/g;Q.fn.extend({addClass:function(e){var t,n,i,r,o,a,s="string"==typeof e&&e,l=0,u=this.length;if(Q.isFunction(e))return this.each(function(t){Q(this).addClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(ht)||[];u>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(ln," "):" ")){for(o=0;r=t[o++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");a=Q.trim(i),n.className!==a&&(n.className=a)}return this},removeClass:function(e){var t,n,i,r,o,a,s=0===arguments.length||"string"==typeof e&&e,l=0,u=this.length;if(Q.isFunction(e))return this.each(function(t){Q(this).removeClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(ht)||[];u>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(ln," "):"")){for(o=0;r=t[o++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");a=e?Q.trim(i):"",n.className!==a&&(n.className=a)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(Q.isFunction(e)?function(n){Q(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,i=0,r=Q(this),o=e.match(ht)||[];t=o[i++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(n===xt||"boolean"===n)&&(this.className&&vt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":vt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ln," ").indexOf(t)>=0)return!0;return!1}});var un=/\r/g;Q.fn.extend({val:function(e){var t,n,i,r=this[0];return arguments.length?(i=Q.isFunction(e),this.each(function(n){var r;1===this.nodeType&&(r=i?e.call(this,n,Q(this).val()):e,null==r?r="":"number"==typeof r?r+="":Q.isArray(r)&&(r=Q.map(r,function(e){return null==e?"":e+""})),t=Q.valHooks[this.type]||Q.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))})):r?(t=Q.valHooks[r.type]||Q.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(r,"value"))?n:(n=r.value,"string"==typeof n?n.replace(un,""):null==n?"":n)):void 0}}),Q.extend({valHooks:{option:{get:function(e){var t=Q.find.attr(e,"value");return null!=t?t:Q.trim(Q.text(e))}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:i.length,l=0>r?s:o?r:0;s>l;l++)if(n=i[l],!(!n.selected&&l!==r||(J.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&Q.nodeName(n.parentNode,"optgroup"))){if(t=Q(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,i,r=e.options,o=Q.makeArray(t),a=r.length;a--;)i=r[a],(i.selected=Q.inArray(i.value,o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),Q.each(["radio","checkbox"],function(){Q.valHooks[this]={set:function(e,t){return Q.isArray(t)?e.checked=Q.inArray(Q(e).val(),t)>=0:void 0}},J.checkOn||(Q.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),Q.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){Q.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),Q.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var cn=Q.now(),dn=/\?/;Q.parseJSON=function(e){return JSON.parse(e+"")},Q.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&Q.error("Invalid XML: "+e),t};var fn=/#.*$/,hn=/([?&])_=[^&]*/,pn=/^(.*?):[ \t]*([^\r\n]*)$/gm,gn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mn=/^(?:GET|HEAD)$/,vn=/^\/\//,yn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Sn={},wn={},bn="*/".concat("*"),Cn=e.location.href,Rn=yn.exec(Cn.toLowerCase())||[];Q.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Cn,type:"GET",isLocal:gn.test(Rn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":bn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Q.parseJSON,"text xml":Q.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?F(F(e,Q.ajaxSettings),t):F(Q.ajaxSettings,e)},ajaxPrefilter:M(Sn),ajaxTransport:M(wn),ajax:function(e,t){function n(e,t,n,a){var l,c,v,y,w,C=t;2!==S&&(S=2,s&&clearTimeout(s),i=void 0,o=a||"",b.readyState=e>0?4:0,l=e>=200&&300>e||304===e,n&&(y=B(d,b,n)),y=H(d,y,b,l),l?(d.ifModified&&(w=b.getResponseHeader("Last-Modified"),w&&(Q.lastModified[r]=w),w=b.getResponseHeader("etag"),w&&(Q.etag[r]=w)),204===e||"HEAD"===d.type?C="nocontent":304===e?C="notmodified":(C=y.state,c=y.data,v=y.error,l=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),b.status=e,b.statusText=(t||C)+"",l?p.resolveWith(f,[c,C,b]):p.rejectWith(f,[b,C,v]),b.statusCode(m),m=void 0,u&&h.trigger(l?"ajaxSuccess":"ajaxError",[b,d,l?c:v]),g.fireWith(f,[b,C]),u&&(h.trigger("ajaxComplete",[b,d]),--Q.active||Q.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,r,o,a,s,l,u,c,d=Q.ajaxSetup({},t),f=d.context||d,h=d.context&&(f.nodeType||f.jquery)?Q(f):Q.event,p=Q.Deferred(),g=Q.Callbacks("once memory"),m=d.statusCode||{},v={},y={},S=0,w="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===S){if(!a)for(a={};t=pn.exec(o);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===S?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return S||(e=y[n]=y[n]||e,v[e]=t),this},overrideMimeType:function(e){return S||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>S)for(t in e)m[t]=[m[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||w;return i&&i.abort(t),n(0,t),this}};if(p.promise(b).complete=g.add,b.success=b.done,b.error=b.fail,d.url=((e||d.url||Cn)+"").replace(fn,"").replace(vn,Rn[1]+"//"),d.type=t.method||t.type||d.method||d.type,d.dataTypes=Q.trim(d.dataType||"*").toLowerCase().match(ht)||[""],null==d.crossDomain&&(l=yn.exec(d.url.toLowerCase()),d.crossDomain=!(!l||l[1]===Rn[1]&&l[2]===Rn[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(Rn[3]||("http:"===Rn[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=Q.param(d.data,d.traditional)),L(Sn,d,t,b),2===S)return b;u=Q.event&&d.global,u&&0===Q.active++&&Q.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!mn.test(d.type),r=d.url,d.hasContent||(d.data&&(r=d.url+=(dn.test(r)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=hn.test(r)?r.replace(hn,"$1_="+cn++):r+(dn.test(r)?"&":"?")+"_="+cn++)),d.ifModified&&(Q.lastModified[r]&&b.setRequestHeader("If-Modified-Since",Q.lastModified[r]),Q.etag[r]&&b.setRequestHeader("If-None-Match",Q.etag[r])),(d.data&&d.hasContent&&d.contentType!==!1||t.contentType)&&b.setRequestHeader("Content-Type",d.contentType),b.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+bn+"; q=0.01":""):d.accepts["*"]);for(c in d.headers)b.setRequestHeader(c,d.headers[c]);if(d.beforeSend&&(d.beforeSend.call(f,b,d)===!1||2===S))return b.abort();w="abort";for(c in{success:1,error:1,complete:1})b[c](d[c]);if(i=L(wn,d,t,b)){b.readyState=1,u&&h.trigger("ajaxSend",[b,d]),d.async&&d.timeout>0&&(s=setTimeout(function(){b.abort("timeout")},d.timeout));try{S=1,i.send(v,n)}catch(C){if(!(2>S))throw C;n(-1,C)}}else n(-1,"No Transport");return b},getJSON:function(e,t,n){return Q.get(e,t,n,"json")},getScript:function(e,t){return Q.get(e,void 0,t,"script")}}),Q.each(["get","post"],function(e,t){Q[t]=function(e,n,i,r){return Q.isFunction(n)&&(r=r||i,i=n,n=void 0),Q.ajax({url:e,type:t,dataType:r,data:n,success:i})}}),Q._evalUrl=function(e){return Q.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Q.fn.extend({wrapAll:function(e){var t;return Q.isFunction(e)?this.each(function(t){Q(this).wrapAll(e.call(this,t))}):(this[0]&&(t=Q(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(Q.isFunction(e)?function(t){Q(this).wrapInner(e.call(this,t))}:function(){var t=Q(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=Q.isFunction(e);return this.each(function(n){Q(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){Q.nodeName(this,"body")||Q(this).replaceWith(this.childNodes)}).end()}}),Q.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},Q.expr.filters.visible=function(e){return!Q.expr.filters.hidden(e)};var En=/%20/g,xn=/\[\]$/,In=/\r?\n/g,Tn=/^(?:submit|button|image|reset|file)$/i,Nn=/^(?:input|select|textarea|keygen)/i;Q.param=function(e,t){var n,i=[],r=function(e,t){t=Q.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=Q.ajaxSettings&&Q.ajaxSettings.traditional),Q.isArray(e)||e.jquery&&!Q.isPlainObject(e))Q.each(e,function(){r(this.name,this.value)});else for(n in e)V(n,e[n],t,r);return i.join("&").replace(En,"+")},Q.fn.extend({serialize:function(){return Q.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Q.prop(this,"elements");return e?Q.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Q(this).is(":disabled")&&Nn.test(this.nodeName)&&!Tn.test(e)&&(this.checked||!Et.test(e))}).map(function(e,t){var n=Q(this).val();return null==n?null:Q.isArray(n)?Q.map(n,function(e){return{name:t.name,value:e.replace(In,"\r\n")}}):{name:t.name,value:n.replace(In,"\r\n")}}).get()}}),Q.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Dn=0,Pn={},_n={0:200,1223:204},On=Q.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Pn)Pn[e]()}),J.cors=!!On&&"withCredentials"in On,J.ajax=On=!!On,Q.ajaxTransport(function(e){var t;return J.cors||On&&!e.crossDomain?{send:function(n,i){var r,o=e.xhr(),a=++Dn;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(r in n)o.setRequestHeader(r,n[r]);t=function(e){return function(){t&&(delete Pn[a],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?i(o.status,o.statusText):i(_n[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=Pn[a]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(s){if(t)throw s}},abort:function(){t&&t()}}:void 0}),Q.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return Q.globalEval(e),e}}}),Q.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Q.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,r){t=Q("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),Y.head.appendChild(t[0])},abort:function(){n&&n()}}}});var An=[],kn=/(=)\?(?=&|$)|\?\?/;Q.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=An.pop()||Q.expando+"_"+cn++;return this[e]=!0,e}}),Q.ajaxPrefilter("json jsonp",function(t,n,i){var r,o,a,s=t.jsonp!==!1&&(kn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&kn.test(t.data)&&"data");return s||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=Q.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(kn,"$1"+r):t.jsonp!==!1&&(t.url+=(dn.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return a||Q.error(r+" was not called"),a[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){a=arguments},i.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=n.jsonpCallback,An.push(r)),a&&Q.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),Q.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||Y;var i=at.exec(e),r=!n&&[];return i?[t.createElement(i[1])]:(i=Q.buildFragment([e],t,r),r&&r.length&&Q(r).remove(),Q.merge([],i.childNodes))};var Mn=Q.fn.load;Q.fn.load=function(e,t,n){if("string"!=typeof e&&Mn)return Mn.apply(this,arguments);var i,r,o,a=this,s=e.indexOf(" ");return s>=0&&(i=Q.trim(e.slice(s)),e=e.slice(0,s)),Q.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),a.length>0&&Q.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,a.html(i?Q("<div>").append(Q.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){a.each(n,o||[e.responseText,t,e])}),this},Q.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Q.fn[t]=function(e){return this.on(t,e)}}),Q.expr.filters.animated=function(e){return Q.grep(Q.timers,function(t){return e===t.elem}).length};var Ln=e.document.documentElement;Q.offset={setOffset:function(e,t,n){var i,r,o,a,s,l,u,c=Q.css(e,"position"),d=Q(e),f={};"static"===c&&(e.style.position="relative"),s=d.offset(),o=Q.css(e,"top"),l=Q.css(e,"left"),u=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,u?(i=d.position(),a=i.top,r=i.left):(a=parseFloat(o)||0,r=parseFloat(l)||0),Q.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+r),"using"in t?t.using.call(e,f):d.css(f)}},Q.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){Q.offset.setOffset(this,e,t)});var t,n,i=this[0],r={top:0,left:0},o=i&&i.ownerDocument;return o?(t=o.documentElement,Q.contains(t,i)?(typeof i.getBoundingClientRect!==xt&&(r=i.getBoundingClientRect()),n=K(o),{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r):void 0},position:function(){if(this[0]){var e,t,n=this[0],i={top:0,left:0};return"fixed"===Q.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),Q.nodeName(e[0],"html")||(i=e.offset()),i.top+=Q.css(e[0],"borderTopWidth",!0),i.left+=Q.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-Q.css(n,"marginTop",!0),left:t.left-i.left-Q.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Ln;e&&!Q.nodeName(e,"html")&&"static"===Q.css(e,"position");)e=e.offsetParent;return e||Ln})}}),Q.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var i="pageYOffset"===n;Q.fn[t]=function(r){return mt(this,function(t,r,o){var a=K(t);return void 0===o?a?a[n]:t[r]:void(a?a.scrollTo(i?e.pageXOffset:o,i?o:e.pageYOffset):t[r]=o)},t,r,arguments.length,null)}}),Q.each(["top","left"],function(e,t){Q.cssHooks[t]=C(J.pixelPosition,function(e,n){return n?(n=b(e,t),Ut.test(n)?Q(e).position()[t]+"px":n):void 0})}),Q.each({Height:"height",Width:"width"},function(e,t){Q.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){Q.fn[i]=function(i,r){var o=arguments.length&&(n||"boolean"!=typeof i),a=n||(i===!0||r===!0?"margin":"border");return mt(this,function(t,n,i){var r;return Q.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===i?Q.css(t,n,a):Q.style(t,n,i,a)},t,o?i:void 0,o,null)}})}),Q.fn.size=function(){return this.length},Q.fn.andSelf=Q.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Q});var Fn=e.jQuery,Bn=e.$;return Q.noConflict=function(t){return e.$===Q&&(e.$=Bn),t&&e.jQuery===Q&&(e.jQuery=Fn),Q},typeof t===xt&&(e.jQuery=e.$=Q),Q}),function(){var e=this,t=e._,n=Array.prototype,i=Object.prototype,r=Function.prototype,o=n.push,a=n.slice,s=n.concat,l=i.toString,u=i.hasOwnProperty,c=Array.isArray,d=Object.keys,f=r.bind,h=function(e){return e instanceof h?e:this instanceof h?void(this._wrapped=e):new h(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=h):e._=h,h.VERSION="1.7.0";var p=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)}}return function(){return e.apply(t,arguments)}};h.iteratee=function(e,t,n){return null==e?h.identity:h.isFunction(e)?p(e,t,n):h.isObject(e)?h.matches(e):h.property(e)},h.each=h.forEach=function(e,t,n){if(null==e)return e;t=p(t,n);var i,r=e.length;if(r===+r)for(i=0;r>i;i++)t(e[i],i,e);else{var o=h.keys(e);for(i=0,r=o.length;r>i;i++)t(e[o[i]],o[i],e)}return e},h.map=h.collect=function(e,t,n){if(null==e)return[];t=h.iteratee(t,n);for(var i,r=e.length!==+e.length&&h.keys(e),o=(r||e).length,a=Array(o),s=0;o>s;s++)i=r?r[s]:s,a[s]=t(e[i],i,e);return a};var g="Reduce of empty array with no initial value";h.reduce=h.foldl=h.inject=function(e,t,n,i){null==e&&(e=[]),t=p(t,i,4);var r,o=e.length!==+e.length&&h.keys(e),a=(o||e).length,s=0;if(arguments.length<3){if(!a)throw new TypeError(g);n=e[o?o[s++]:s++]}for(;a>s;s++)r=o?o[s]:s,n=t(n,e[r],r,e);return n},h.reduceRight=h.foldr=function(e,t,n,i){null==e&&(e=[]),t=p(t,i,4);var r,o=e.length!==+e.length&&h.keys(e),a=(o||e).length;if(arguments.length<3){if(!a)throw new TypeError(g);n=e[o?o[--a]:--a]}for(;a--;)r=o?o[a]:a,n=t(n,e[r],r,e);return n},h.find=h.detect=function(e,t,n){var i;return t=h.iteratee(t,n),h.some(e,function(e,n,r){return t(e,n,r)?(i=e,!0):void 0}),i},h.filter=h.select=function(e,t,n){var i=[];return null==e?i:(t=h.iteratee(t,n),h.each(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i)},h.reject=function(e,t,n){return h.filter(e,h.negate(h.iteratee(t)),n)},h.every=h.all=function(e,t,n){if(null==e)return!0;t=h.iteratee(t,n);var i,r,o=e.length!==+e.length&&h.keys(e),a=(o||e).length;for(i=0;a>i;i++)if(r=o?o[i]:i,!t(e[r],r,e))return!1;return!0},h.some=h.any=function(e,t,n){if(null==e)return!1;t=h.iteratee(t,n);var i,r,o=e.length!==+e.length&&h.keys(e),a=(o||e).length;for(i=0;a>i;i++)if(r=o?o[i]:i,t(e[r],r,e))return!0;return!1},h.contains=h.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=h.values(e)),h.indexOf(e,t)>=0)},h.invoke=function(e,t){var n=a.call(arguments,2),i=h.isFunction(t);return h.map(e,function(e){return(i?t:e[t]).apply(e,n)})},h.pluck=function(e,t){return h.map(e,h.property(t))},h.where=function(e,t){return h.filter(e,h.matches(t))},h.findWhere=function(e,t){return h.find(e,h.matches(t))},h.max=function(e,t,n){var i,r,o=-1/0,a=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:h.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],i>o&&(o=i)}else t=h.iteratee(t,n),h.each(e,function(e,n,i){r=t(e,n,i),(r>a||r===-1/0&&o===-1/0)&&(o=e,a=r)});return o},h.min=function(e,t,n){var i,r,o=1/0,a=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:h.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],o>i&&(o=i)}else t=h.iteratee(t,n),h.each(e,function(e,n,i){r=t(e,n,i),(a>r||1/0===r&&1/0===o)&&(o=e,a=r)});return o},h.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:h.values(e),i=n.length,r=Array(i),o=0;i>o;o++)t=h.random(0,o),t!==o&&(r[o]=r[t]),r[t]=n[o];return r},h.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=h.values(e)),e[h.random(e.length-1)]):h.shuffle(e).slice(0,Math.max(0,t))},h.sortBy=function(e,t,n){return t=h.iteratee(t,n),h.pluck(h.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,i){var r={};return n=h.iteratee(n,i),h.each(t,function(i,o){var a=n(i,o,t);e(r,i,a)}),r}};h.groupBy=m(function(e,t,n){h.has(e,n)?e[n].push(t):e[n]=[t]}),h.indexBy=m(function(e,t,n){e[n]=t}),h.countBy=m(function(e,t,n){h.has(e,n)?e[n]++:e[n]=1}),h.sortedIndex=function(e,t,n,i){n=h.iteratee(n,i,1);for(var r=n(t),o=0,a=e.length;a>o;){var s=o+a>>>1;n(e[s])<r?o=s+1:a=s}return o},h.toArray=function(e){return e?h.isArray(e)?a.call(e):e.length===+e.length?h.map(e,h.identity):h.values(e):[]},h.size=function(e){return null==e?0:e.length===+e.length?e.length:h.keys(e).length},h.partition=function(e,t,n){t=h.iteratee(t,n);var i=[],r=[];return h.each(e,function(e,n,o){(t(e,n,o)?i:r).push(e)}),[i,r]},h.first=h.head=h.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:a.call(e,0,t)},h.initial=function(e,t,n){return a.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},h.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},h.rest=h.tail=h.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},h.compact=function(e){return h.filter(e,h.identity)};var v=function(e,t,n,i){if(t&&h.every(e,h.isArray))return s.apply(i,e);for(var r=0,a=e.length;a>r;r++){var l=e[r];h.isArray(l)||h.isArguments(l)?t?o.apply(i,l):v(l,t,n,i):n||i.push(l)}return i};h.flatten=function(e,t){return v(e,t,!1,[])},h.without=function(e){return h.difference(e,a.call(arguments,1))},h.uniq=h.unique=function(e,t,n,i){if(null==e)return[];h.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=h.iteratee(n,i));for(var r=[],o=[],a=0,s=e.length;s>a;a++){var l=e[a];if(t)a&&o===l||r.push(l),o=l;else if(n){var u=n(l,a,e);h.indexOf(o,u)<0&&(o.push(u),r.push(l))}else h.indexOf(r,l)<0&&r.push(l)}return r},h.union=function(){return h.uniq(v(arguments,!0,!0,[]))},h.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,i=0,r=e.length;r>i;i++){var o=e[i];if(!h.contains(t,o)){for(var a=1;n>a&&h.contains(arguments[a],o);a++);a===n&&t.push(o)}}return t},h.difference=function(e){var t=v(a.call(arguments,1),!0,!0,[]);return h.filter(e,function(e){return!h.contains(t,e)})},h.zip=function(e){if(null==e)return[];for(var t=h.max(arguments,"length").length,n=Array(t),i=0;t>i;i++)n[i]=h.pluck(arguments,i);return n},h.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},h.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return i=h.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,r+n):n}for(;r>i;i++)if(e[i]===t)return i;return-1},h.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=e.length;for("number"==typeof n&&(i=0>n?i+n+1:Math.min(i,n+1));--i>=0;)if(e[i]===t)return i;return-1},h.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),o=0;i>o;o++,e+=n)r[o]=e;return r};var y=function(){};h.bind=function(e,t){var n,i;if(f&&e.bind===f)return f.apply(e,a.call(arguments,1));if(!h.isFunction(e))throw new TypeError("Bind must be called on a function");return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(a.call(arguments)));y.prototype=e.prototype;var r=new y;y.prototype=null;var o=e.apply(r,n.concat(a.call(arguments)));return h.isObject(o)?o:r}},h.partial=function(e){var t=a.call(arguments,1);return function(){for(var n=0,i=t.slice(),r=0,o=i.length;o>r;r++)i[r]===h&&(i[r]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},h.bindAll=function(e){var t,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(t=1;i>t;t++)n=arguments[t],e[n]=h.bind(e[n],e);return e},h.memoize=function(e,t){var n=function(i){var r=n.cache,o=t?t.apply(this,arguments):i;return h.has(r,o)||(r[o]=e.apply(this,arguments)),r[o]};return n.cache={},n},h.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},h.defer=function(e){return h.delay.apply(h,[e,1].concat(a.call(arguments,1)))},h.throttle=function(e,t,n){var i,r,o,a=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:h.now(),a=null,o=e.apply(i,r),a||(i=r=null)};return function(){var u=h.now();s||n.leading!==!1||(s=u);var c=t-(u-s);return i=this,r=arguments,0>=c||c>t?(clearTimeout(a),a=null,s=u,o=e.apply(i,r),a||(i=r=null)):a||n.trailing===!1||(a=setTimeout(l,c)),o}},h.debounce=function(e,t,n){var i,r,o,a,s,l=function(){var u=h.now()-a;t>u&&u>0?i=setTimeout(l,t-u):(i=null,n||(s=e.apply(o,r),i||(o=r=null)))};return function(){o=this,r=arguments,a=h.now();var u=n&&!i;return i||(i=setTimeout(l,t)),u&&(s=e.apply(o,r),o=r=null),s}},h.wrap=function(e,t){return h.partial(t,e)},h.negate=function(e){return function(){return!e.apply(this,arguments)}},h.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},h.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},h.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},h.once=h.partial(h.before,2),h.keys=function(e){if(!h.isObject(e))return[];if(d)return d(e);var t=[];for(var n in e)h.has(e,n)&&t.push(n);return t},h.values=function(e){for(var t=h.keys(e),n=t.length,i=Array(n),r=0;n>r;r++)i[r]=e[t[r]];return i},h.pairs=function(e){for(var t=h.keys(e),n=t.length,i=Array(n),r=0;n>r;r++)i[r]=[t[r],e[t[r]]];return i},h.invert=function(e){for(var t={},n=h.keys(e),i=0,r=n.length;r>i;i++)t[e[n[i]]]=n[i];return t},h.functions=h.methods=function(e){var t=[];for(var n in e)h.isFunction(e[n])&&t.push(n);return t.sort()},h.extend=function(e){if(!h.isObject(e))return e;for(var t,n,i=1,r=arguments.length;r>i;i++){t=arguments[i];for(n in t)u.call(t,n)&&(e[n]=t[n])}return e},h.pick=function(e,t,n){var i,r={};if(null==e)return r;if(h.isFunction(t)){t=p(t,n);for(i in e){var o=e[i];t(o,i,e)&&(r[i]=o)}}else{var l=s.apply([],a.call(arguments,1));e=new Object(e);for(var u=0,c=l.length;c>u;u++)i=l[u],i in e&&(r[i]=e[i])}return r},h.omit=function(e,t,n){if(h.isFunction(t))t=h.negate(t);else{var i=h.map(s.apply([],a.call(arguments,1)),String);t=function(e,t){return!h.contains(i,t)}}return h.pick(e,t,n)},h.defaults=function(e){if(!h.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var i=arguments[t];for(var r in i)void 0===e[r]&&(e[r]=i[r])}return e},h.clone=function(e){return h.isObject(e)?h.isArray(e)?e.slice():h.extend({},e):e},h.tap=function(e,t){return t(e),e};var S=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof h&&(e=e._wrapped),t instanceof h&&(t=t._wrapped);var r=l.call(e);if(r!==l.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]===e)return i[o]===t;var a=e.constructor,s=t.constructor;if(a!==s&&"constructor"in e&&"constructor"in t&&!(h.isFunction(a)&&a instanceof a&&h.isFunction(s)&&s instanceof s))return!1;n.push(e),i.push(t);var u,c;if("[object Array]"===r){if(u=e.length,c=u===t.length)for(;u--&&(c=S(e[u],t[u],n,i)););}else{var d,f=h.keys(e);if(u=f.length,c=h.keys(t).length===u)for(;u--&&(d=f[u],c=h.has(t,d)&&S(e[d],t[d],n,i)););}return n.pop(),i.pop(),c};h.isEqual=function(e,t){return S(e,t,[],[])},h.isEmpty=function(e){if(null==e)return!0;if(h.isArray(e)||h.isString(e)||h.isArguments(e))return 0===e.length;for(var t in e)if(h.has(e,t))return!1;return!0},h.isElement=function(e){return!(!e||1!==e.nodeType)},h.isArray=c||function(e){return"[object Array]"===l.call(e)},h.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},h.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){h["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}
}),h.isArguments(arguments)||(h.isArguments=function(e){return h.has(e,"callee")}),"function"!=typeof/./&&(h.isFunction=function(e){return"function"==typeof e||!1}),h.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},h.isNaN=function(e){return h.isNumber(e)&&e!==+e},h.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===l.call(e)},h.isNull=function(e){return null===e},h.isUndefined=function(e){return void 0===e},h.has=function(e,t){return null!=e&&u.call(e,t)},h.noConflict=function(){return e._=t,this},h.identity=function(e){return e},h.constant=function(e){return function(){return e}},h.noop=function(){},h.property=function(e){return function(t){return t[e]}},h.matches=function(e){var t=h.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var i=0;n>i;i++){var r=t[i],o=r[0];if(r[1]!==e[o]||!(o in e))return!1}return!0}},h.times=function(e,t,n){var i=Array(Math.max(0,e));t=p(t,n,1);for(var r=0;e>r;r++)i[r]=t(r);return i},h.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},h.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},b=h.invert(w),C=function(e){var t=function(t){return e[t]},n="(?:"+h.keys(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}};h.escape=C(w),h.unescape=C(b),h.result=function(e,t){if(null==e)return void 0;var n=e[t];return h.isFunction(n)?e[t]():n};var R=0;h.uniqueId=function(e){var t=++R+"";return e?e+t:t},h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/(.)^/,x={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,T=function(e){return"\\"+x[e]};h.template=function(e,t,n){!t&&n&&(t=n),t=h.defaults({},t,h.templateSettings);var i=RegExp([(t.escape||E).source,(t.interpolate||E).source,(t.evaluate||E).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(i,function(t,n,i,a,s){return o+=e.slice(r,s).replace(I,T),r=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(s){throw s.source=o,s}var l=function(e){return a.call(this,e,h)},u=t.variable||"obj";return l.source="function("+u+"){\n"+o+"}",l},h.chain=function(e){var t=h(e);return t._chain=!0,t};var N=function(e){return this._chain?h(e).chain():e};h.mixin=function(e){h.each(h.functions(e),function(t){var n=h[t]=e[t];h.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),N.call(this,n.apply(h,e))}})},h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];h.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],N.call(this,n)}}),h.each(["concat","join","slice"],function(e){var t=n[e];h.prototype[e]=function(){return N.call(this,t.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}.call(this),function(e,t){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(n,i,r){e.Backbone=t(e,r,n,i)});else if("undefined"!=typeof exports){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,i){{var r=e.Backbone,o=[],a=(o.push,o.slice);o.splice}t.VERSION="1.1.2",t.$=i,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,n){if(!u(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,i){if(!u(this,"once",e,[t,i])||!t)return this;var r=this,o=n.once(function(){r.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,i)},off:function(e,t,i){var r,o,a,s,l,c,d,f;if(!this._events||!u(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(s=e?[e]:n.keys(this._events),l=0,c=s.length;c>l;l++)if(e=s[l],a=this._events[e]){if(this._events[e]=r=[],t||i)for(d=0,f=a.length;f>d;d++)o=a[d],(t&&t!==o.callback&&t!==o.callback._callback||i&&i!==o.context)&&r.push(o);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!u(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&c(n,t),i&&c(i,arguments),this},stopListening:function(e,t,i){var r=this._listeningTo;if(!r)return this;var o=!t&&!i;i||"object"!=typeof t||(i=this),e&&((r={})[e._listenId]=e);for(var a in r)e=r[a],e.off(t,i,this),(o||n.isEmpty(e._events))&&delete this._listeningTo[a];return this}},l=/\s+/,u=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)e[t].apply(e,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var o=n.split(l),a=0,s=o.length;s>a;a++)e[t].apply(e,[o[a]].concat(i));return!1}return!0},c=function(e,t){var n,i=-1,r=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,a);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,o,a,s);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t);return}},d={listenTo:"on",listenToOnce:"once"};n.each(d,function(e,t){s[t]=function(t,i,r){var o=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=n.uniqueId("l"));return o[a]=t,r||"object"!=typeof i||(r=this),t[e](i,r,this),this}}),s.bind=s.on,s.unbind=s.off,n.extend(t,s);var f=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=n.defaults({},i,n.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(f.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var r,o,a,s,l,u,c,d;if(null==e)return this;if("object"==typeof e?(o=e,i=t):(o={})[e]=t,i||(i={}),!this._validate(o,i))return!1;a=i.unset,l=i.silent,s=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=n.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(r in o)t=o[r],n.isEqual(d[r],t)||s.push(r),n.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,a?delete d[r]:d[r]=t;if(!l){s.length&&(this._pending=i);for(var f=0,h=s.length;h>f;f++)this.trigger("change:"+s[f],this,d[s[f]],i)}if(u)return this;if(!l)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,i=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in e)n.isEqual(r[o],t=e[o])||((i||(i={}))[o]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){return t.set(t.parse(n,e),e)?(i&&i(t,n,e),void t.trigger("sync",t,n,e)):!1},F(this,e),this.sync("read",this,e)},save:function(e,t,i){var r,o,a,s=this.attributes;if(null==e||"object"==typeof e?(r=e,i=t):(r={})[e]=t,i=n.extend({validate:!0},i),r&&!i.wait){if(!this.set(r,i))return!1}else if(!this._validate(r,i))return!1;r&&i.wait&&(this.attributes=n.extend({},s,r)),void 0===i.parse&&(i.parse=!0);var l=this,u=i.success;return i.success=function(e){l.attributes=s;var t=l.parse(e,i);return i.wait&&(t=n.extend(r||{},t)),n.isObject(t)&&!l.set(t,i)?!1:(u&&u(l,e,i),void l.trigger("sync",l,e,i))},F(this,i),o=this.isNew()?"create":i.patch?"patch":"update","patch"===o&&(i.attrs=r),a=this.sync(o,this,i),r&&i.wait&&(this.attributes=s),a},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&r(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;F(this,e);var o=this.sync("delete",this,e);return e.wait||r(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||L();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1):!0}});var h=["keys","values","pairs","invert","pick","omit"];n.each(h,function(e){f.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var p=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};n.extend(p.prototype,s,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,m))},remove:function(e,t){var i=!n.isArray(e);e=i?[e]:n.clone(e),t||(t={});var r,o,a,s;for(r=0,o=e.length;o>r;r++)s=e[r]=this.get(e[r]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s,t));return i?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var i=!n.isArray(e);e=i?e?[e]:[]:n.clone(e);var r,o,a,s,l,u,c,d=t.at,h=this.model,p=this.comparator&&null==d&&t.sort!==!1,m=n.isString(this.comparator)?this.comparator:null,v=[],y=[],S={},w=t.add,b=t.merge,C=t.remove,R=!p&&w&&C?[]:!1;for(r=0,o=e.length;o>r;r++){if(l=e[r]||{},a=l instanceof f?s=l:l[h.prototype.idAttribute||"id"],u=this.get(a))C&&(S[u.cid]=!0),b&&(l=l===s?s.attributes:l,t.parse&&(l=u.parse(l,t)),u.set(l,t),p&&!c&&u.hasChanged(m)&&(c=!0)),e[r]=u;else if(w){if(s=e[r]=this._prepareModel(l,t),!s)continue;v.push(s),this._addReference(s,t)}s=u||s,!R||!s.isNew()&&S[s.id]||R.push(s),S[s.id]=!0}if(C){for(r=0,o=this.length;o>r;++r)S[(s=this.models[r]).cid]||y.push(s);y.length&&this.remove(y,t)}if(v.length||R&&R.length)if(p&&(c=!0),this.length+=v.length,null!=d)for(r=0,o=v.length;o>r;r++)this.models.splice(d+r,0,v[r]);else{R&&(this.models.length=0);var E=R||v;for(r=0,o=E.length;o>r;r++)this.models.push(E[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,o=v.length;o>r;r++)(s=v[r]).trigger("add",s,this,t);(c||R&&R.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,r=this.models.length;r>i;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return a.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var r=e.reset?"reset":"set";i[r](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,r=t.success;return t.success=function(e,n){t.wait&&i.add(e,t),r&&r(e,n,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof f)return e;t=t?n.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_addReference:function(e){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(v,function(e){p.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var y=["groupBy","countBy","sortBy","indexBy"];n.each(y,function(e){p.prototype[e]=function(t,i){var r=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,r,i)}});var S=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];n.extend(S.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var r=t.match(w),o=r[1],a=r[2];i=n.bind(i,this),o+=".delegateEvents"+this.cid,""===a?this.$el.on(o,i):this.$el.on(o,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,r){var o=R[e];n.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:o,dataType:"json"};if(r.url||(a.url=n.result(i,"url")||L()),null!=r.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",r.emulateJSON&&(a.data._method=o);var s=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),s?s.apply(this,arguments):void 0}}"GET"===a.type||r.emulateJSON||(a.processData=!1),"PATCH"===a.type&&C&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=t.ajax(n.extend(a,r));return i.trigger("request",i,l,r),l};var C=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),R={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var E=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},x=/\((.*?)\)/g,I=/(\(\?)?:\w+/g,T=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(E.prototype,s,{initialize:function(){},route:function(e,i,r){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var o=this;return t.history.route(e,function(n){var a=o._extractParameters(e,n);o.execute(r,a),o.trigger.apply(o,["route:"+i].concat(a)),o.trigger("route",i,a),t.history.trigger("route",o,i,a)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(N,"\\$&").replace(x,"(?:$1)?").replace(I,function(e,t){return t?e:"([^/?]+)"}).replace(T,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var D=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,O=/msie [\w.]+/,A=/\/$/,k=/#.*$/;D.started=!1,n.extend(D.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(A,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(P,"")},start:function(e){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),r=document.documentMode,o=O.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);if(this.root=("/"+this.root+"/").replace(_,"/"),o&&this._wantsHashChange){var a=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(P,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!D.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(k,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new D;var M=function(e,t){var i,r=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,t);var o=function(){this.constructor=i};return o.prototype=r.prototype,i.prototype=new o,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};f.extend=p.extend=E.extend=S.extend=D.extend=M;var L=function(){throw new Error('A "url" property or function must be specified')},F=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t});var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,i,r,o,a,s,l,u,c,d,f,h=t&&t.split("/"),p=g.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=e.split("/"),a=e.length-1,g.nodeIdCompat&&S.test(e[a])&&(e[a]=e[a].replace(S,"")),e=h.concat(e),c=0;c<e.length;c+=1)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if(r=p[h.slice(0,d).join("/")],r&&(r=r[i])){o=r,s=c;break}if(o)break;!l&&m&&m[i]&&(l=m[i],u=c)}!o&&l&&(o=l,s=u),o&&(n.splice(0,s,o),e=n.join("/"))}return e}function i(t,n){return function(){var i=y.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),c.apply(e,i.concat([t,n]))}}function r(e){return function(t){return n(t,e)}}function o(e){return function(t){h[e]=t}}function a(n){if(t(p,n)){var i=p[n];delete p[n],m[n]=!0,u.apply(e,i)}if(!t(h,n)&&!t(m,n))throw new Error("No "+n);return h[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return g&&g.config&&g.config[e]||{}}}var u,c,d,f,h={},p={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice,S=/\.js$/;d=function(e,t){var i,o=s(e),l=o[0];return e=o[1],l&&(l=n(l,t),i=a(l)),l?e=i&&i.normalize?i.normalize(e,r(t)):n(e,t):(e=n(e,t),o=s(e),l=o[0],e=o[1],l&&(i=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:i}},f={require:function(e){return i(e)},exports:function(e){var t=h[e];return"undefined"!=typeof t?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:l(e)}}},u=function(n,r,s,l){var u,c,g,v,y,S,w=[],b=typeof s;if(l=l||n,"undefined"===b||"function"===b){for(r=!r.length&&s.length?["require","exports","module"]:r,y=0;y<r.length;y+=1)if(v=d(r[y],l),c=v.f,"require"===c)w[y]=f.require(n);else if("exports"===c)w[y]=f.exports(n),S=!0;else if("module"===c)u=w[y]=f.module(n);else if(t(h,c)||t(p,c)||t(m,c))w[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,i(l,!0),o(c),{}),w[y]=h[c]}g=s?s.apply(h[n],w):void 0,n&&(u&&u.exports!==e&&u.exports!==h[n]?h[n]=u.exports:g===e&&S||(h[n]=g))}else n&&(h[n]=s)},requirejs=require=c=function(t,n,i,r,o){if("string"==typeof t)return f[t]?f[t](n):a(d(t,n).f);if(!t.splice){if(g=t,g.deps&&c(g.deps,g.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=r,r=o),r?u(e,t,n,i):setTimeout(function(){u(e,t,n,i)},4),c},c.config=function(e){return c(e)},requirejs._defined=h,define=function(e,n,i){n.splice||(i=n,n=[]),t(h,e)||t(p,e)||(p[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("almond",function(){}),define("text",["module"],function(e){var t,n,i,r,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,u=l&&location.protocol&&location.protocol.replace(/\:/,""),c=l&&location.hostname,d=l&&(location.port||void 0),f=[],h=e.config&&e.config()||{};return t={version:"2.0.6",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(i){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,o=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!a||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(r="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var o,a,s,l=t.xdRegExp.exec(e);return l?(o=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==n||a&&a.toLowerCase()!==i.toLowerCase()||(s||a)&&s!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,h.isBuild&&(f[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return void i();h.isBuild=r.isBuild;var o=t.parseName(e),a=o.moduleName+(o.ext?"."+o.ext:""),s=n.toUrl(a),f=h.useXhr||t.useXhr;!l||f(s,u,c,d)?t.get(s,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([a],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)})},write:function(e,n,i){if(f.hasOwnProperty(n)){var r=t.jsEscape(f[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,o){var a=t.parseName(n),s=a.ext?"."+a.ext:"",l=a.moduleName+s,u=i.toUrl(a.moduleName+s)+".js";t.load(l,i,function(){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},t.write(e,l,n,o)},o)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("﻿")&&(i=i.substring(1)),t(i)}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,n,i,r){var o,a=t.createXhr();if(a.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&a.setRequestHeader(o.toLowerCase(),r[o]);h.onXhr&&h.onXhr(a,e),a.onreadystatechange=function(){var t,r;4===a.readyState&&(t=a.status,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=a,i(r)):n(a.responseText),h.onXhrComplete&&h.onXhrComplete(a,e))},a.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,r="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(n=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=s.readLine());)n.append(a),n.append(i);l=String(n.toString())}finally{s.close()}t(l)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,o,a={},s=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(s,1,0,!1),o=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),o.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(l){throw new Error((s&&s.path||"")+": "+l)}}),t}),function(){console.debug||(console.debug=console.log),console.info||(console.info=console.log),console.warn||(console.warn=console.log),console.error||(console.error=console.log)}(),define("console_shim",function(){}),ReadiumSDK={version:function(){return"0.8.0"},Models:{Smil:{}},Views:{ORIENTATION_LANDSCAPE:"orientation_landscape",ORIENTATION_PORTRAIT:"orientation_portrait"},Collections:{},Routers:{},Helpers:{},Events:{READER_INITIALIZED:"ReaderInitialized",PAGINATION_CHANGED:"PaginationChanged",SETTINGS_APPLIED:"SettingsApplied",FXL_VIEW_RESIZED:"FXLViewResized",READER_VIEW_CREATED:"ReaderViewCreated",READER_VIEW_DESTROYED:"ReaderViewDestroyed",CONTENT_DOCUMENT_LOAD_START:"ContentDocumentLoadStart",CONTENT_DOCUMENT_LOADED:"ContentDocumentLoaded",MEDIA_OVERLAY_STATUS_CHANGED:"MediaOverlayStatusChanged",MEDIA_OVERLAY_TTS_SPEAK:"MediaOverlayTTSSpeak",MEDIA_OVERLAY_TTS_STOP:"MediaOverlayTTSStop"},InternalEvents:{CURRENT_VIEW_PAGINATION_CHANGED:"CurrentViewPaginationChanged"}},navigator.epubReadingSystem={name:"",version:"0.0.0",layoutStyle:"paginated",hasFeature:function(e,t){return t&&"1.0"!==t?!1:"dom-manipulation"===e?!0:"layout-changes"===e?!0:"touch-events"===e?!1:"mouse-events"===e?!0:"keyboard-events"===e?!0:"spine-scripting"===e?!0:!1}},_.extend(ReadiumSDK,Backbone.Events),define("readiumSDK",["backbone"],function(e){return function(){var t;return t||e.readiumSDK}}(this)),function(e){var t=function(e){return parseInt(e,10)||0};e.each(["min","max"],function(n,i){e.fn[i+"Size"]=function(e){var n,r;return e?(void 0!==e.width&&this.css(i+"-width",e.width),void 0!==e.height&&this.css(i+"-height",e.height),this):(n=this.css(i+"-width"),r=this.css(i+"-height"),{width:"max"===i&&(void 0===n||"none"===n||-1===t(n))&&Number.MAX_VALUE||t(n),height:"max"===i&&(void 0===r||"none"===r||-1===t(r))&&Number.MAX_VALUE||t(r)})}}),e.fn.isVisible=function(){return this.is(":visible")},e.each(["border","margin","padding"],function(n,i){e.fn[i]=function(e){return e?(void 0!==e.top&&this.css(i+"-top"+("border"===i?"-width":""),e.top),void 0!==e.bottom&&this.css(i+"-bottom"+("border"===i?"-width":""),e.bottom),void 0!==e.left&&this.css(i+"-left"+("border"===i?"-width":""),e.left),void 0!==e.right&&this.css(i+"-right"+("border"===i?"-width":""),e.right),this):{top:t(this.css(i+"-top"+("border"===i?"-width":""))),bottom:t(this.css(i+"-bottom"+("border"===i?"-width":""))),left:t(this.css(i+"-left"+("border"===i?"-width":""))),right:t(this.css(i+"-right"+("border"===i?"-width":"")))}
}})}(jQuery),define("jquerySizes",["jquery"],function(e){return function(){var t;return t||e.jquerySizes}}(this)),ReadiumSDK.Helpers.Rect=function(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i,this.right=function(){return this.left+this.width},this.bottom=function(){return this.top+this.height},this.isOverlap=function(e,t){return void 0==t&&(t=0),!(e.right()<this.left+t||e.left>this.right()-t||e.bottom()<this.top+t||e.top>this.bottom()-t)}},ReadiumSDK.Helpers.Rect.fromElement=function(e){var t;t=_.isArray(e)||e instanceof jQuery?e[0]:e,3===t.nodeType&&(t=e.parent()[0]);for(var n=t.offsetLeft,i=t.offsetTop,r=t.offsetWidth,o=t.offsetHeight;t=t.offsetParent;)n+=t.offsetLeft,i+=t.offsetTop;return new ReadiumSDK.Helpers.Rect(n,i,r,o)},ReadiumSDK.Helpers.ResolveContentRef=function(e,t){if(!t)return e;var n=t.split("/");n.pop();for(var i=e.split("/");n.length>0&&".."===i[0];)n.pop(),i.splice(0,1);var r=n.concat(i);return r.join("/")},ReadiumSDK.Helpers.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},ReadiumSDK.Helpers.BeginsWith=function(e,t){return 0===e.indexOf(t)},ReadiumSDK.Helpers.RemoveFromString=function(e,t){var n=e.indexOf(t);return-1==n?e:e.substring(0,n)+e.substring(n+t.length)},ReadiumSDK.Helpers.Margins=function(e,t,n){this.margin=e,this.border=t,this.padding=n,this.left=this.margin.left+this.border.left+this.padding.left,this.right=this.margin.right+this.border.right+this.padding.right,this.top=this.margin.top+this.border.top+this.padding.top,this.bottom=this.margin.bottom+this.border.bottom+this.padding.bottom,this.width=function(){return this.left+this.right},this.height=function(){return this.top+this.bottom}},ReadiumSDK.Helpers.triggerLayout=function(e){var t=e[0].contentDocument;if(t){var n=void 0;try{if(n=t.styleSheets&&t.styleSheets.length?t.styleSheets[0]:void 0,!n){var i=t.createElement("style");t.head.appendChild(i),i.appendChild(t.createTextNode("")),n=i.sheet}n&&n.insertRule("body:first-child::before {content:'READIUM';color: red;font-weight: bold;}",n.cssRules.length)}catch(r){console.error(r)}try{var o=t.createElementNS("http://www.w3.org/1999/xhtml","style");o.appendChild(t.createTextNode("*{}")),t.body.appendChild(o),t.body.removeChild(o),n&&n.deleteRule(n.cssRules.length-1)}catch(r){console.error(r)}if(t.body){t.body.offsetTop}}},ReadiumSDK.Helpers.deduceSyntheticSpread=function(e,t,n){if(!e||0==e.length)return 0;var i=t?t.getRenditionSpread():void 0;if(i===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE)return!1;if("double"==n.syntheticSpread)return!0;if("single"==n.syntheticSpread)return!1;if(!t)return 0;if(i===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH)return!0;var r=ReadiumSDK.Helpers.getOrientation(e);if(i===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE)return r===ReadiumSDK.Views.ORIENTATION_LANDSCAPE;if(i===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT)return r===ReadiumSDK.Views.ORIENTATION_PORTRAIT;if(!i||i===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO){var o=r===ReadiumSDK.Views.ORIENTATION_LANDSCAPE;return o?1:0}return console.warn("ReadiumSDK.Helpers.deduceSyntheticSpread: spread properties?!"),0},ReadiumSDK.Helpers.Margins.fromElement=function(e){return new this(e.margin(),e.border(),e.padding())},ReadiumSDK.Helpers.Margins.empty=function(){return new this({left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0})},ReadiumSDK.Helpers.loadTemplate=function(e){return ReadiumSDK.Helpers.loadTemplate.cache[e]},ReadiumSDK.Helpers.loadTemplate.cache={fixed_book_frame:'<div id="fixed-book-frame" class="clearfix book-frame fixed-book-frame"></div>',single_page_frame:'<div><div id="scaler"><iframe scrolling="no" class="iframe-fixed"></iframe></div></div>',scrolled_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"><div id="scrolled-content-frame"></div></div>',reflowable_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"></div>',reflowable_book_page_frame:'<div id="reflowable-content-frame" class="reflowable-content-frame"><iframe scrolling="no" id="epubContentIframe"></iframe></div>'},ReadiumSDK.Helpers.setStyles=function(e,t){var n=e.length;if(n)for(var i=0;n>i;i++){var r=e[i];r.selector?$(r.selector,t).css(r.declarations):t.css(r.declarations)}},ReadiumSDK.Helpers.isIframeAlive=function(e){var t=void 0,n=void 0;try{t=e.contentWindow,n=e.contentDocument}catch(i){return console.error(i),!1}return t&&n},ReadiumSDK.Helpers.getOrientation=function(e){var t=e.width(),n=e.height();return t&&n?t>=n?ReadiumSDK.Views.ORIENTATION_LANDSCAPE:ReadiumSDK.Views.ORIENTATION_PORTRAIT:void 0},ReadiumSDK.Helpers.isRenditionSpreadPermittedForItem=function(e,t){var n=e.getRenditionSpread();return!n||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE&&t==ReadiumSDK.Views.ORIENTATION_LANDSCAPE||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT&&t==ReadiumSDK.Views.ORIENTATION_PORTRAIT},ReadiumSDK.Helpers.CSSTransformString=function(e){var t,n,i,r=e.origin;if(e.left||e.top){var o=e.left||0,a=e.top||0;t="translate("+o+"px, "+a+"px)"}if(e.scale&&(n="scale("+e.scale+")"),e.angle&&(i="rotate("+e.angle+"deg)"),!(t||n||i))return{};var s=t&&n?t+" "+n:t?t:n;i&&(s=s+" "+i);var l={};return _.each(["-webkit-","-moz-","-ms-",""],function(e){l[e+"transform"]=s,l[e+"transform-origin"]=r?r:"0 0"}),l},ReadiumSDK.Helpers.escapeJQuerySelector=function(e){if(!e)return void 0;var t=e.replace(/([;&,\.\+\*\~\?':"\!\^#$%@\[\]\(\)<=>\|\/\\{}`])/g,"\\$1");return t},define("helpers",["readiumSDK","jquerySizes"],function(e){return function(){var t;return t||e.helpers}}(this)),ReadiumSDK.Models.ViewerSettings=function(e){function t(e){for(var t=[],n=e.split(/[\s,;]+/),i=0;i<n.length;i++){var r=n[i].trim();""!==r&&t.push(r)}return t}function n(e,t,n){void 0!==t[e]&&(i[e]=n?n(t[e]):t[e])}var i=this;this.syntheticSpread="auto",this.fontSize=100,this.columnGap=20,this.mediaOverlaysPreservePlaybackWhenScroll=!1,this.mediaOverlaysSkipSkippables=!1,this.mediaOverlaysEscapeEscapables=!0,this.mediaOverlaysSkippables=[],this.mediaOverlaysEscapables=[],this.mediaOverlaysEnableClick=!0,this.mediaOverlaysRate=1,this.mediaOverlaysVolume=100,this.mediaOverlaysSynchronizationGranularity="",this.mediaOverlaysAutomaticPageTurn=!0,this.enableGPUHardwareAccelerationCSS3D=!0,this.pageTransition=-1,this.scroll="auto",this.update=function(e){n("columnGap",e),n("fontSize",e),n("mediaOverlaysPreservePlaybackWhenScroll",e),n("mediaOverlaysSkipSkippables",e),n("mediaOverlaysEscapeEscapables",e),n("mediaOverlaysSkippables",e,t),n("mediaOverlaysEscapables",e,t),n("mediaOverlaysEnableClick",e),n("mediaOverlaysRate",e),n("mediaOverlaysVolume",e),n("mediaOverlaysSynchronizationGranularity",e),n("mediaOverlaysAutomaticPageTurn",e),n("scroll",e),n("syntheticSpread",e),n("pageTransition",e),n("enableGPUHardwareAccelerationCSS3D",e)},this.update(e)},define("viewerSettings",["readiumSDK"],function(e){return function(){var t;return t||e.viewerSettings}}(this)),ReadiumSDK.Models.Style=function(e,t){this.selector=e,this.declarations=t,this.setDeclarations=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.declarations[t]=e[t])}},define("style",["readiumSDK"],function(e){return function(){var t;return t||e.style}}(this)),ReadiumSDK.Collections.StyleCollection=function(){var e=[];this.clear=function(){e.length=0},this.findStyle=function(t){for(var n=e.length,i=0;n>i;i++)if(e[i].selector===t)return e[i];return void 0},this.addStyle=function(t,n){var i=this.findStyle(t);return i?i.setDeclarations(n):(i=new ReadiumSDK.Models.Style(t,n),e.push(i)),i},this.removeStyle=function(t){for(var n=e.length,i=0;n>i;i++)if(e[i].selector===t)return void e.splice(i,1)},this.getStyles=function(){return e},this.resetStyleValues=function(){for(var t=e.length,n=0;t>n;n++){var i=e[n],r=i.declarations;for(var o in r)r.hasOwnProperty(o)&&(r[o]="")}}},define("styleCollection",["readiumSDK","style"],function(e){return function(){var t;return t||e.styleCollection}}(this)),ReadiumSDK.Models.SpineItem=function(e,t,n){function i(){o.page_spread&&o.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_LEFT&&o.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_RIGHT&&o.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_CENTER&&console.error(o.page_spread+" is not a recognized spread type")}function r(e,t){return o[e]?o[e]===t:o.spine.package[e]?o.spine.package[e]===t:!1}var o=this;this.idref=e.idref,this.href=e.href,this.linear=e.linear?e.linear.toLowerCase():e.linear,this.page_spread=e.page_spread,this.rendition_viewport=e.rendition_viewport,this.rendition_spread=e.rendition_spread,this.rendition_orientation=e.rendition_orientation,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.media_overlay_id=e.media_overlay_id,this.media_type=e.media_type,this.index=t,this.spine=n,i(),this.setSpread=function(e){this.page_spread=e,i()},this.isRenditionSpreadAllowed=function(){var e=o.getRenditionSpread();return!e||e!=ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE},this.isLeftPage=function(){return o.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_LEFT},this.isRightPage=function(){return o.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_RIGHT},this.isCenterPage=function(){return o.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_CENTER},this.isReflowable=function(){return!o.isFixedLayout()},this.isFixedLayout=function(){var e=o.getRenditionLayout();if(e){if(o.rendition_layout){if(o.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED)return!0;if(o.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_REFLOWABLE)return!1}return o.spine.package.isFixedLayout()}return o.media_type.indexOf("image/")>=0},this.getRenditionFlow=function(){return o.rendition_flow?o.rendition_flow:o.spine.package.rendition_flow},this.getRenditionViewport=function(){return o.rendition_viewport?o.rendition_viewport:o.spine.package.rendition_viewport},this.getRenditionSpread=function(){return o.rendition_spread?o.rendition_spread:o.spine.package.rendition_spread},this.getRenditionOrientation=function(){return o.rendition_orientation?o.rendition_orientation:o.spine.package.rendition_orientation},this.getRenditionLayout=function(){return o.rendition_layout?o.rendition_layout:o.spine.package.rendition_layout},this.isFlowScrolledContinuous=function(){return r("rendition_flow",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_CONTINUOUS)},this.isFlowScrolledDoc=function(){return r("rendition_flow",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_DOC)}},ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_REFLOWABLE="reflowable",ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED="pre-paginated",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_LANDSCAPE="landscape",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_PORTRAIT="portrait",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_AUTO="auto",ReadiumSDK.Models.SpineItem.SPREAD_LEFT="page-spread-left",ReadiumSDK.Models.SpineItem.SPREAD_RIGHT="page-spread-right",ReadiumSDK.Models.SpineItem.SPREAD_CENTER="page-spread-center",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE="none",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE="landscape",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT="portrait",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH="both",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO="auto",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_PAGINATED="paginated",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_CONTINUOUS="scrolled-continuous",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_DOC="scrolled-doc",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_AUTO="auto",ReadiumSDK.Models.SpineItem.alternateSpread=function(e){return e===ReadiumSDK.Models.SpineItem.SPREAD_LEFT?ReadiumSDK.Models.SpineItem.SPREAD_RIGHT:e===ReadiumSDK.Models.SpineItem.SPREAD_RIGHT?ReadiumSDK.Models.SpineItem.SPREAD_LEFT:e},define("spineItem",["readiumSDK"],function(e){return function(){var t;return t||e.spineItem}}(this)),ReadiumSDK.Models.Spine=function(e,t){function n(e){return!l||"no"!==e.linear}function i(e){if(!o(e))return void 0;var t=s.items[e];return n(t)?t:i(t.index+1)}function r(e){if(!o(e))return void 0;var t=s.items[e];return n(t)?t:r(t.index-1)}function o(e){return e>=0&&e<s.items.length}function a(){for(var e=s.items.length,t=!1,n=s.isLeftToRight()?ReadiumSDK.Models.SpineItem.SPREAD_LEFT:ReadiumSDK.Models.SpineItem.SPREAD_RIGHT,i=0;e>i;i++){var r=s.items[i];if(!r.page_spread){var o=t?n:ReadiumSDK.Models.SpineItem.alternateSpread(n);r.setSpread(o)}t=!r.isRenditionSpreadAllowed()||r.page_spread!=n}}var s=this;this.items=[],this.direction="ltr",this.package=e;var l=!1;if(this.handleLinear=function(e){l=e},this.isValidLinearItem=function(e){return n(this.item(e))},this.prevItem=function(e){return r(e.index-1)},this.nextItem=function(e){return i(e.index+1)},this.getItemUrl=function(e){return s.package.resolveRelativeUrl(e.href)},this.first=function(){return i(0)},this.last=function(){return r(this.items.length-1)},this.isFirstItem=function(e){return s.first()===e},this.isLastItem=function(e){return s.last()===e},this.item=function(e){return o(e)?s.items[e]:void 0},this.isRightToLeft=function(){return"rtl"==s.direction},this.isLeftToRight=function(){return!s.isRightToLeft()},this.getItemById=function(e){for(var t=s.items.length,n=0;t>n;n++)if(s.items[n].idref==e)return s.items[n];return void 0},this.getItemByHref=function(e){for(var t=s.items.length,n=0;t>n;n++)if(s.items[n].href==e)return s.items[n];return void 0},t){t.direction&&(this.direction=t.direction);for(var u=t.items.length,c=0;u>c;c++){var d=new ReadiumSDK.Models.SpineItem(t.items[c],c,this);this.items.push(d)}a()}},define("spine",["readiumSDK","spineItem"],function(e){return function(){var t;return t||e.spine}}(this)),ReadiumSDK.Models.Smil.SmilNode=function(e){this.parent=e,this.id="",this.getSmil=function(){for(var e=this;e.parent;)e=e.parent;return e},this.hasAncestor=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1}},ReadiumSDK.Models.Smil.TimeContainerNode=function(e){this.parent=e,this.children=void 0,this.index=void 0,this.epubtype="",this.isEscapable=function(e){if(""===this.epubtype)return!1;var t=this.getSmil();if(!t.mo)return!1;var n=t.mo.escapables;e.length>0&&(n=e);for(var i=0;i<n.length;i++)if(this.epubtype.indexOf(n[i])>=0)return!0;return!1},this.isSkippable=function(e){if(""===this.epubtype)return!1;var t=this.getSmil();if(!t.mo)return!1;var n=t.mo.skippables;e.length>0&&(n=e);for(var i=0;i<n.length;i++)if(this.epubtype.indexOf(n[i])>=0)return!0;return!1}},ReadiumSDK.Models.Smil.TimeContainerNode.prototype=new ReadiumSDK.Models.Smil.SmilNode,ReadiumSDK.Models.Smil.MediaNode=function(e){this.parent=e,this.src=""},ReadiumSDK.Models.Smil.MediaNode.prototype=new ReadiumSDK.Models.Smil.SmilNode,ReadiumSDK.Models.Smil.SeqNode=function(e){this.parent=e,this.children=[],this.nodeType="seq",this.textref="",this.durationMilliseconds=function(){for(var e=this.getSmil(),t=0,n=0;n<this.children.length;n++){var i=this.children[n];if("par"===i.nodeType){if(!i.audio)continue;if(i.text&&(!i.text.manifestItemId||i.text.manifestItemId!=e.spineItemId))continue;var r=i.audio.clipDurationMilliseconds();t+=r}else"seq"===i.nodeType&&(t+=i.durationMilliseconds())}return t},this.clipOffset=function(e,t){for(var n=this.getSmil(),i=0;i<this.children.length;i++){var r=this.children[i];if("par"===r.nodeType){if(r==t)return!0;if(!r.audio)continue;if(r.text&&(!r.text.manifestItemId||r.text.manifestItemId!=n.spineItemId))continue;var o=r.audio.clipDurationMilliseconds();e.offset+=o}else if("seq"===r.nodeType){var a=r.clipOffset(e,t);if(a)return!0}}return!1},this.parallelAt=function(e){for(var t=this.getSmil(),n=0,i=0;i<this.children.length;i++){var r=e-n,o=this.children[i];if("par"===o.nodeType){if(!o.audio)continue;if(o.text&&(!o.text.manifestItemId||o.text.manifestItemId!=t.spineItemId))continue;var a=o.audio.clipDurationMilliseconds();if(a>0&&a>=r)return o;n+=a}else if("seq"===o.nodeType){var s=o.parallelAt(r);if(s)return s;n+=o.durationMilliseconds()}}return void 0},this.nthParallel=function(e,t){for(var n=0;n<this.children.length;n++){var i=this.children[n];if("par"===i.nodeType){if(t.count++,t.count==e)return i}else if("seq"===i.nodeType){var r=i.nthParallel(e,t);if(r)return r}}return void 0}},ReadiumSDK.Models.Smil.SeqNode.prototype=new ReadiumSDK.Models.Smil.TimeContainerNode,ReadiumSDK.Models.Smil.ParNode=function(e){this.parent=e,this.children=[],this.nodeType="par",this.text=void 0,this.audio=void 0,this.element=void 0,this.getFirstSeqAncestorWithEpubType=function(e,t){if(!e)return void 0;for(var n=t?this:this.parent;n;){if(n.epubtype&&n.epubtype.indexOf(e)>=0)return n;n=n.parent}return void 0}},ReadiumSDK.Models.Smil.ParNode.prototype=new ReadiumSDK.Models.Smil.TimeContainerNode,ReadiumSDK.Models.Smil.TextNode=function(e){this.parent=e,this.nodeType="text",this.srcFile="",this.srcFragmentId="",this.manifestItemId=void 0,this.updateMediaManifestItemId=function(){var e=this.getSmil();if(e.href&&e.href.length){for(var t=this.srcFile?this.srcFile:this.src,n=ReadiumSDK.Helpers.ResolveContentRef(t,e.href),i=e.mo.package.resolveRelativeUrlMO(n),r=0;r<e.mo.package.spine.items.length;r++){var o=e.mo.package.spine.items[r],a=e.mo.package.resolveRelativeUrl(o.href);if(a===i)return void(this.manifestItemId=o.idref)}console.error("Cannot set the Media ManifestItemId? "+this.src+" && "+e.href)}}},ReadiumSDK.Models.Smil.TextNode.prototype=new ReadiumSDK.Models.Smil.MediaNode,ReadiumSDK.Models.Smil.AudioNode=function(e){this.parent=e,this.nodeType="audio",this.clipBegin=0,this.MAX=1234567890.1,this.clipEnd=this.MAX,this.clipDurationMilliseconds=function(){var e=1e3*this.clipBegin,t=1e3*this.clipEnd;return this.clipEnd>=this.MAX||e>=t?0:t-e}},ReadiumSDK.Models.Smil.AudioNode.prototype=new ReadiumSDK.Models.Smil.MediaNode,ReadiumSDK.Models.SmilModel=function(){this.parent=void 0,this.children=[],this.id=void 0,this.href=void 0,this.duration=void 0,this.mo=void 0,this.parallelAt=function(e){return this.children[0].parallelAt(e)},this.nthParallel=function(e){var t={count:-1};return this.children[0].nthParallel(e,t)},this.clipOffset=function(e){var t={offset:0};return this.children[0].clipOffset(t,e)?t.offset:0},this.durationMilliseconds_Calculated=function(){return this.children[0].durationMilliseconds()};var e=[];this.hasSync=function(t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},this.addSync=function(t){if(t)for(var n=t.split(" "),i=0;i<n.length;i++){var r=n[i].trim();r.length>0&&!this.hasSync(r)&&e.push(r)}}},ReadiumSDK.Models.SmilModel.fromSmilDTO=function(e,t){t.DEBUG&&console.debug("Media Overlay DTO import...");var n=0,i=function(){for(var e="",t=0;n>t;t++)e+="   ";return e},r=new ReadiumSDK.Models.SmilModel;r.id=e.id,r.spineItemId=e.spineItemId,r.href=e.href,r.smilVersion=e.smilVersion,r.duration=e.duration,r.duration&&r.duration.length&&r.duration.length>0&&(console.error("SMIL duration is string, parsing float... ("+r.duration+")"),r.duration=parseFloat(r.duration)),r.mo=t,r.mo.DEBUG&&(console.log("JS MO smilVersion="+r.smilVersion),console.log("JS MO id="+r.id),console.log("JS MO spineItemId="+r.spineItemId),console.log("JS MO href="+r.href),console.log("JS MO duration="+r.duration));var o=function(e,t,n,o){e in t?(e in n||console.debug("property "+e+" not declared in smil node "+n.nodeType),n[e]=t[e],r.mo.DEBUG&&console.log(i()+"JS MO: ["+e+"="+n[e]+"]")):o&&console.log("Required property "+e+" not found in smil node "+t.nodeType)},a=function(e,t){var a;if("seq"==e.nodeType)r.mo.DEBUG&&console.log(i()+"JS MO seq"),a=new ReadiumSDK.Models.Smil.SeqNode(t),o("textref",e,a,t&&t.parent?!0:!1),o("id",e,a),o("epubtype",e,a),a.epubtype&&a.getSmil().addSync(a.epubtype),n++,s(e,a),n--;else if("par"==e.nodeType){r.mo.DEBUG&&console.log(i()+"JS MO par"),a=new ReadiumSDK.Models.Smil.ParNode(t),o("id",e,a),o("epubtype",e,a),a.epubtype&&a.getSmil().addSync(a.epubtype),n++,s(e,a),n--;for(var l=0,u=a.children.length;u>l;l++){var c=a.children[l];"text"==c.nodeType?a.text=c:"audio"==c.nodeType?a.audio=c:console.error("Unexpected smil node type: "+c.nodeType)}var d=!1;if(d||!a.audio){var f=new ReadiumSDK.Models.Smil.AudioNode(a);f.clipBegin=0,f.clipEnd=f.MAX,f.src=void 0,a.audio=f}}else if("text"==e.nodeType)r.mo.DEBUG&&console.log(i()+"JS MO text"),a=new ReadiumSDK.Models.Smil.TextNode(t),o("src",e,a,!0),o("srcFile",e,a,!0),o("srcFragmentId",e,a,!1),o("id",e,a),a.updateMediaManifestItemId();else{if("audio"!=e.nodeType)return void console.error("Unexpected smil node type: "+e.nodeType);r.mo.DEBUG&&console.log(i()+"JS MO audio"),a=new ReadiumSDK.Models.Smil.AudioNode(t),o("src",e,a,!0),o("id",e,a),o("clipBegin",e,a),a.clipBegin&&a.clipBegin.length&&a.clipBegin.length>0&&(console.error("SMIL clipBegin is string, parsing float... ("+a.clipBegin+")"),a.clipBegin=parseFloat(a.clipBegin)),a.clipBegin<0&&(r.mo.DEBUG&&console.log(i()+"JS MO clipBegin adjusted to ZERO"),a.clipBegin=0),o("clipEnd",e,a),a.clipEnd&&a.clipEnd.length&&a.clipEnd.length>0&&(console.error("SMIL clipEnd is string, parsing float... ("+a.clipEnd+")"),a.clipEnd=parseFloat(a.clipEnd)),a.clipEnd<=a.clipBegin&&(r.mo.DEBUG&&console.log(i()+"JS MO clipEnd adjusted to MAX"),a.clipEnd=a.MAX)}return a},s=function(e,t){for(var n=e.children.length,i=0;n>i;i++){var r=a(e.children[i],t);r.index=i,t.children.push(r)}};return s(e,r),r},define("smilModel",["readiumSDK"],function(e){return function(){var t;return t||e.smilModel}}(this)),ReadiumSDK.Models.MediaOverlay=function(e){this.package=e,this.parallelAt=function(e){for(var t=0,n=0;n<this.smil_models.length;n++){var i=this.smil_models[n],r=e-t,o=i.parallelAt(r);if(o)return o;t+=i.durationMilliseconds_Calculated()}return void 0},this.percentToPosition=function(e,t,n,i){(0>e||e>100)&&(e=0);var r=this.durationMilliseconds_Calculated(),o=r*(e/100);if(n.par=this.parallelAt(o),n.par){var a=n.par.getSmil();if(a){for(var s=0,l=0;l<this.smil_models.length&&(t.smilData=this.smil_models[l],t.smilData!=a);l++)s+=t.smilData.durationMilliseconds_Calculated();i.milliseconds=o-(s+t.smilData.clipOffset(n.par))}}},this.durationMilliseconds_Calculated=function(){for(var e=0,t=0;t<this.smil_models.length;t++){var n=this.smil_models[t];e+=n.durationMilliseconds_Calculated()}return e},this.smilAt=function(e){return 0>e||e>=this.smil_models.length?void 0:this.smil_models[e]},this.positionToPercent=function(e,t,n){if(e>=this.smil_models.length)return-1;for(var i=0,r=0;e>r;r++){var o=this.smil_models[r];i+=o.durationMilliseconds_Calculated()}var a=this.smil_models[e],s=a.nthParallel(t);if(!s)return-1;var l=i+a.clipOffset(s)+n,u=this.durationMilliseconds_Calculated(),c=l/u*100;return c},this.smil_models=[],this.skippables=[],this.escapables=[],this.duration=void 0,this.narrator=void 0,this.activeClass=void 0,this.playbackActiveClass=void 0,this.DEBUG=!1,this.getSmilBySpineItem=function(e){if(!e)return void 0;for(var t=0,n=this.smil_models.length;n>t;t++){var i=this.smil_models[t];if(i.spineItemId===e.idref)return e.media_overlay_id!==i.id&&console.error("SMIL INCORRECT ID?? "+e.media_overlay_id+" /// "+i.id),i}return void 0},this.getNextSmil=function(e){var t=this.smil_models.indexOf(e);return-1==t||t==this.smil_models.length-1?void 0:this.smil_models[t+1]},this.getPreviousSmil=function(e){var t=this.smil_models.indexOf(e);return-1==t||0==t?void 0:this.smil_models[t-1]}},ReadiumSDK.Models.MediaOverlay.fromDTO=function(e,t){var n=new ReadiumSDK.Models.MediaOverlay(t);if(!e)return console.debug("No Media Overlay."),n;console.debug("Media Overlay INIT..."),n.duration=e.duration,n.duration&&n.duration.length&&n.duration.length>0&&(console.error("SMIL total duration is string, parsing float... ("+n.duration+")"),n.duration=parseFloat(n.duration)),n.DEBUG&&console.debug("Media Overlay Duration (TOTAL): "+n.duration),n.narrator=e.narrator,n.DEBUG&&console.debug("Media Overlay Narrator: "+n.narrator),n.activeClass=e.activeClass,n.DEBUG&&console.debug("Media Overlay Active-Class: "+n.activeClass),n.playbackActiveClass=e.playbackActiveClass,n.DEBUG&&console.debug("Media Overlay Playback-Active-Class: "+n.playbackActiveClass);var i=e.smil_models.length;n.DEBUG&&console.debug("Media Overlay SMIL count: "+i);for(var r=0;i>r;r++){var o=ReadiumSDK.Models.SmilModel.fromSmilDTO(e.smil_models[r],n);n.smil_models.push(o),n.DEBUG&&console.debug("Media Overlay Duration (SPINE ITEM): "+o.duration)}i=e.skippables.length,n.DEBUG&&console.debug("Media Overlay SKIPPABLES count: "+i);for(var r=0;i>r;r++)n.skippables.push(e.skippables[r]);i=e.escapables.length,n.DEBUG&&console.debug("Media Overlay ESCAPABLES count: "+i);for(var r=0;i>r;r++)n.escapables.push(e.escapables[r]);return n},define("mediaOverlay",["readiumSDK","smilModel"],function(e){return function(){var t;return t||e.mediaOverlay}}(this)),ReadiumSDK.Models.Package=function(e){var t=this;this.spine=void 0,this.rootUrl=void 0,this.rootUrlMO=void 0,this.media_overlay=void 0,this.rendition_viewport=void 0,this.rendition_flow=void 0,this.rendition_layout=void 0,this.rendition_spread=void 0,this.rendition_orientation=void 0,this.resolveRelativeUrlMO=function(e){return t.rootUrlMO&&t.rootUrlMO.length>0?ReadiumSDK.Helpers.EndsWith(t.rootUrlMO,"/")?t.rootUrlMO+e:t.rootUrlMO+"/"+e:t.resolveRelativeUrl(e)},this.resolveRelativeUrl=function(e){return t.rootUrl?ReadiumSDK.Helpers.EndsWith(t.rootUrl,"/")?t.rootUrl+e:t.rootUrl+"/"+e:e},this.isFixedLayout=function(){return t.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED},this.isReflowable=function(){return!t.isFixedLayout()},e&&(this.rootUrl=e.rootUrl,this.rootUrlMO=e.rootUrlMO,this.rendition_viewport=e.rendition_viewport,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.rendition_orientation=e.rendition_orientation,this.rendition_spread=e.rendition_spread,this.spine=new ReadiumSDK.Models.Spine(this,e.spine),this.media_overlay=ReadiumSDK.Models.MediaOverlay.fromDTO(e.media_overlay,this))},define("package",["readiumSDK","spine","mediaOverlay"],function(e){return function(){var t;return t||e.package}}(this)),function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,t=navigator.userAgent.toLowerCase().indexOf("android")>-1,n=!1,i=new Audio;n&&(i.addEventListener("load",function(){console.debug("0) load")}),i.addEventListener("loadstart",function(){console.debug("1) loadstart")}),i.addEventListener("durationchange",function(){console.debug("2) durationchange")}),i.addEventListener("loadedmetadata",function(){console.debug("3) loadedmetadata")}),i.addEventListener("loadeddata",function(){console.debug("4) loadeddata")}),i.addEventListener("progress",function(){console.debug("5) progress")}),i.addEventListener("canplay",function(){console.debug("6) canplay")}),i.addEventListener("canplaythrough",function(){console.debug("7) canplaythrough")}),i.addEventListener("play",function(){console.debug("8) play")}),i.addEventListener("pause",function(){console.debug("9) pause")}),i.addEventListener("ended",function(){console.debug("10) ended")}),i.addEventListener("seeked",function(){console.debug("X) seeked")}),i.addEventListener("timeupdate",function(){console.debug("Y) timeupdate")})),ReadiumSDK.Views.AudioPlayer=function(r,o,a,s,l){function u(){r({isPlaying:!0}),s()}function c(){l(),r({isPlaying:!1})}function d(){return i.moSeeking?void(n&&console.debug("onEnded() skipped (still seeking...)")):(h(),a(),void r({isPlaying:!1}))}function f(){R||(R=setInterval(function(){if(i.moSeeking)return n&&console.debug("interval timer skipped (still seeking...)"),C++,void(C>1e3&&(C=0,h()));var e=i.currentTime;o(e,1)},20))}function h(){R&&clearInterval(R),R=void 0}function p(e){$(i).off(D,p),n&&console.debug("onReadyToSeek #"+e.data.playId),g(e.data.seekBegin,e.data.playId,!0)}function g(e,t,r){if(n&&console.debug("playSeekCurrentTime() #"+t),0==e&&(e=.01),Math.abs(e-i.currentTime)<.3)return n&&console.debug("playSeekCurrentTime() CONTINUE"),i.moSeeking=void 0,void v.play();var o=r?_:O;n&&console.debug("playSeekCurrentTime() NEED SEEK, EV: "+o),v.pause(),$(i).on(o,{newCurrentTime:e,playId:t,isNewSrc:r},m);try{i.currentTime=e}catch(a){console.error(a.message),setTimeout(function(){try{i.currentTime=e}catch(t){console.error(t.message)}},5)}}function m(e){var t=e.data.isNewSrc?_:O,r=void 0==e.data.seekRetries;(r||e.data.seekRetries==P)&&$(i).off(t,m),n&&console.debug("onSeeked() #"+e.data.playId+" FIRST? "+r+" EV: "+t);var o=i.currentTime,a=Math.abs(e.data.newCurrentTime-o);if((r||e.data.seekRetries>=0)&&a>=1)n&&console.debug("onSeeked() time diff: "+e.data.newCurrentTime+" vs. "+o+" ("+a+")"),r&&(e.data.seekRetries=P,e.data.isNewSrc=!1),e.data.seekRetries--,n&&console.debug("onSeeked() FAIL => retry again (timeout)"),setTimeout(function(){m(e)},50),setTimeout(function(){try{i.pause(),setTimeout(function(){i.currentTime=e.data.newCurrentTime},0)}catch(t){console.error(t.message),setTimeout(function(){try{i.pause(),setTimeout(function(){i.currentTime=e.data.newCurrentTime},0)}catch(t){console.error(t.message)}},4)}},5);else{if(n&&(console.debug("onSeeked() STATE:"),console.debug(r),console.debug(e.data.seekRetries),console.debug(a)),a>=1){n&&console.debug("onSeeked() ABORT, TRY AGAIN FROM SCRATCH!");var s=S,l=y,u=e.data.newCurrentTime;return v.reset(),void setTimeout(function(){v.playFile(s,l,u)},10)}n&&console.debug("onSeeked() OKAY => play!"),e.data.seekRetries=void 0,v.play(),i.moSeeking=void 0}}var v=this,y=void 0,S=void 0;this.currentSmilSrc=function(){return S};var w=1;this.setRate=function(e){w=e,.5>w&&(w=.5),w>4&&(w=4),i.playbackRate=w},v.setRate(w),this.getRate=function(){return w};var b=100;this.setVolume=function(e){b=e,0>b&&(b=0),b>1&&(b=1),i.volume=b},v.setVolume(b),this.getVolume=function(){return b},this.play=function(){return n&&console.error("this.play()"),y?(f(),v.setVolume(b),v.setRate(w),i.play(),!0):!1},this.pause=function(){n&&console.error("this.pause()"),h(),i.pause()},i.addEventListener("play",u,!1),i.addEventListener("pause",c,!1),i.addEventListener("ended",d,!1);var C=0,R=void 0;this.isPlaying=function(){return void 0!==R},this.reset=function(){n&&console.error("this.reset()"),this.pause(),i.moSeeking=void 0,S=void 0,y=void 0,setTimeout(function(){i.setAttribute("src","")},1)},i.addEventListener("loadstart",function(){E=!0});var E=!1;this.touchInit=function(){return e?E?!1:(E=!0,i.setAttribute("src","touch/init/html5/audio.mp3"),i.load(),!0):!1};var x=0,I=0;this.playFile=function(e,r,o){x++,x>99999&&(x=0);var a=x;if(i.moSeeking)return I++,I>P?void(I=0):(n&&console.debug("this.playFile("+r+") @"+o+" (POSTPONE, SEEKING...)"),void setTimeout(function(){v.playFile(e,r,o)},20));i.moSeeking={},n&&console.debug("this.playFile("+r+") @"+o+" #"+a);var s=!y||y!==r;return s?(n&&(console.debug("this.playFile() NEW SRC"),console.debug("_currentEpubSrc: "+y),console.debug("epubSrc: "+r)),this.reset(),i.moSeeking={},S=e,y=r,t||i.addEventListener("play",N,!1),$(i).on(D,{seekBegin:o,playId:a},p),void setTimeout(function(){i.setAttribute("src",y),i.load(),t||T()},1)):(n&&console.debug("this.playFile() SAME SRC"),this.pause(),S=e,y=r,void g(o,a,!1))};var T=function(){n&&console.debug("playToForcePreload");var e=b;b=0,v.play(),b=e},N=function(){i.removeEventListener("play",N,!1),n&&console.debug("onPlayToForcePreload"),i.pause()},D=t?"canplaythrough":"canplay",P=10,_=e?"canplaythrough":"seeked",O=e?"timeupdate":"seeked"}}(),define("audioPlayer",["readiumSDK"],function(e){return function(){var t;return t||e.audioPlayer}}(this)),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](u)}function t(){var t=c;l&&t.length&&(c=[],e(t))}function n(){l||(l=!0,a&&clearInterval(a),t())}function i(e){return l?e(u):c.push(e),i}var r,o,a,s="undefined"!=typeof window&&window.document,l=!s,u=s?document:null,c=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);
else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{r=null===window.frameElement}catch(d){}o.doScroll&&r&&window.external&&(a=setInterval(function(){try{o.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,r){r.isBuild?n(null):i(n)},i}),function(e){function t(e,t){var n=typeof e[t];return n==S||!(n!=y||!e[t])||"unknown"==n}function n(e,t){return!(typeof e[t]!=y||!e[t])}function i(e,t){return typeof e[t]!=w}function r(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function o(e){return e&&x(e,E)&&T(e,R)}function a(e){return n(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(e){n(window,"console")&&t(window.console,"log")&&window.console.log(e)}function l(e,t){t?window.alert(e):s(e)}function u(e){D.initialized=!0,D.supported=!1,l("Rangy is not supported on this page in your browser. Reason: "+e,D.config.alertOnFail)}function c(e){l("Rangy warning: "+e,D.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function f(){if(!D.initialized){var e,n=!1,i=!1;t(document,"createRange")&&(e=document.createRange(),x(e,C)&&T(e,b)&&(n=!0),e.detach());var r=a(document);if(!r||"body"!=r.nodeName.toLowerCase())return void u("No body element found");if(r&&t(r,"createTextRange")&&(e=r.createTextRange(),o(e)&&(i=!0)),!n&&!i)return void u("Neither Range nor TextRange are available");D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:i};var l,c;for(var f in N)(l=N[f])instanceof p&&l.init(l,D);for(var h=0,g=_.length;g>h;++h)try{_[h](D)}catch(m){c="Rangy init listener threw an exception. Continuing. Detail: "+d(m),s(c)}}}function h(e){e=e||window,f();for(var t=0,n=O.length;n>t;++t)O[t](e)}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function g(e,t,n,i){var r=new p(t,n,function(e){if(!e.initialized){e.initialized=!0;try{i(D,e),e.supported=!0}catch(n){var r="Module '"+t+"' failed to load: "+d(n);s(r)}}});N[t]=r}function m(){}function v(){}var y=("function"==typeof e.define&&e.define.amd,"object"),S="function",w="undefined",b=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],R=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],E=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],x=r(t),I=r(n),T=r(i),N={},D={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:n,isHostProperty:i,areHostMethods:x,areHostObjects:I,areHostProperties:T,isTextRange:o,getBody:a},features:{},modules:N,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};D.fail=u,D.warn=c,{}.hasOwnProperty?D.util.extend=function(e,t,n){var i,r;for(var o in t)t.hasOwnProperty(o)&&(i=e[o],r=t[o],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&D.util.extend(i,r,!0),e[o]=r);return e}:u("hasOwnProperty not supported"),function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","div");e.appendChild(document.createElementNS("http://www.w3.org/1999/xhtml","span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(i){}t||(t=function(e){for(var t=[],n=0,i=e.length;i>n;++n)t[n]=e[n];return t}),D.util.toArray=t}();var P;t(document,"addEventListener")?P=function(e,t,n){e.addEventListener(t,n,!1)}:t(document,"attachEvent")?P=function(e,t,n){e.attachEvent("on"+t,n)}:u("Document does not have required addEventListener or attachEvent method"),D.util.addListener=P;var _=[];D.init=f,D.addInitListener=function(e){D.initialized?e(D):_.push(e)};var O=[];D.addCreateMissingNativeApiListener=function(e){O.push(e)},D.createMissingNativeApi=h,p.prototype={init:function(){for(var e,t,n=this.dependencies||[],i=0,r=n.length;r>i;++i){if(t=n[i],e=N[t],!(e&&e instanceof p))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),g(!1,e,n,t)},D.createCoreModule=function(e,t,n){g(!0,e,t,n)},D.RangePrototype=m,D.rangePrototype=new m,D.selectionPrototype=new v;var A=!1,k=function(){A||(A=!0,D.initialized||f())};return typeof window==w?void u("No window found"):typeof document==w?void u("No document found"):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",k,!1),P(window,"load",k),void(e.rangy=D))}(this),rangy.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==D||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)++t;return t}function o(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(A(i,n))return n;return null}function s(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function l(e,t){return s(e,t,!0)}function u(e,t,n){for(var i,r=n?e:e.parentNode;r;){if(i=r.parentNode,i===t)return r;r=i}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function f(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function h(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),f(i,e),n)for(var o,a=0;o=n[a++];)o.node==e&&o.offset>t?(o.node=i,o.offset-=t):o.node==e.parentNode&&o.offset>r(e)&&++o.offset;return i}function p(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=D)return e.ownerDocument;if(typeof e.document!=D)return e.document;if(e.parentNode)return p(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var n=p(e);if(typeof n.defaultView!=D)return n.defaultView;if(typeof n.parentWindow!=D)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=D)return e.contentDocument;if(typeof e.contentWindow!=D)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=D)return e.contentWindow;if(typeof e.contentDocument!=D)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&P.isHostMethod(e,"setTimeout")&&P.isHostObject(e,"document")}function S(e,t,n){var i;if(e?P.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):p(e):y(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function w(e){for(var t;t=e.parentNode;)e=t;return e}function b(e,n,i,o){var s,l,c,d,f;if(e==i)return n===o?0:o>n?-1:1;if(s=u(i,e,!0))return n<=r(s)?-1:1;if(s=u(e,i,!0))return r(s)<o?-1:1;if(l=a(e,i),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===l?l:u(e,l,!0),d=i===l?l:u(i,l,!0),c===d)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=l.firstChild;f;){if(f===c)return-1;if(f===d)return 1;f=f.nextSibling}}function C(e){try{return e.parentNode,!1}catch(t){return!0}}function R(e){if(!e)return"[No node]";if(k&&C(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+r(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function E(e){for(var t,n=p(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function x(e){this.root=e,this._next=e}function I(e){return new x(e)}function T(e,t){this.node=e,this.offset=t}function N(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var D="undefined",P=e.util;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var _=document.createElementNS("http://www.w3.org/1999/xhtml","div");P.areHostMethods(_,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(_,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),P.isHostProperty(_,"innerHTML")||t.fail("Element is missing innerHTML property");var O=document.createTextNode("test");P.areHostMethods(O,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(_,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(O,["data"]))||t.fail("Incomplete Text Node implementation");var A=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},k=!1;!function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",k=C(n),e.features.crashyTextNodes=k}();var M;typeof window.getComputedStyle!=D?M=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=D?M=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),x.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},T.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+R(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},N.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},N.prototype.toString=function(){return this.message},e.dom={arrayContains:A,isHtmlNamespace:n,parentElement:i,getNodeIndex:r,getNodeLength:o,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:u,isCharacterDataNode:c,isTextOrCommentNode:d,insertAfter:f,splitDataNode:h,getDocument:p,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:P.getBody,isWindow:y,getContentDocument:S,getRootContainer:w,comparePoints:b,isBrokenNode:C,inspectNode:R,getComputedStyleProperty:M,fragmentFromNodeChildren:E,createIterator:I,DomPosition:T},e.DOMException=N}),rangy.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(U(e,t.startContainer)||U(e,t.endContainer))}function n(e){return e.document||j(e.startContainer)}function i(e){return new B(e.parentNode,K(e))}function r(e){return new B(e.parentNode,K(e)+1)}function o(e,t,n){var i=11==e.nodeType?e.firstChild:e;return V(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:W(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function a(e,t,i){if(I(e),I(t),n(t)!=n(e))throw new H("WRONG_DOCUMENT_ERR");var r=$(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=$(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return i?0>=r&&o>=0:0>r&&o>0}function s(e){for(var t,i,r,o=n(e.range).createDocumentFragment();i=e.next();){if(t=e.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(r=e.getSubtreeIterator(),i.appendChild(s(r)),r.detach(!0)),10==i.nodeType)throw new H("HIERARCHY_REQUEST_ERR");o.appendChild(i)}return o}function l(e,t,n){var i,r;n=n||{stop:!1};for(var o,a;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),l(a,t,n),a.detach(!0),n.stop)return}else for(i=L.createIterator(o);r=i.next();)if(t(r)===!1)return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach(!0)):e.remove()}function c(e){for(var t,i,r=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(c(i)),i.detach(!0)):e.remove(),10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function d(e,t,n){var i,r=!(!t||!t.length),o=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var a=[];return l(new h(e,!1),function(t){if(!(r&&!i.test(t.nodeType)||o&&!n(t))){var s=e.startContainer;if(t!=s||!V(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&V(l)&&0==e.endOffset||a.push(t)}}}),a}function f(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&V(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||V(this.sc)?q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||V(this.ec)?q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function p(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function g(e){return function(t,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.nodeType,z(e,i))return r;r=r.parentNode}return null}}function m(e,t){if(rt(e,t))throw new p("INVALID_NODE_TYPE_ERR")}function v(e){if(!e.startContainer)throw new H("INVALID_STATE_ERR")}function y(e,t){if(!z(t,e.nodeType))throw new p("INVALID_NODE_TYPE_ERR")}function S(e,t){if(0>t||t>(V(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function w(e,t){if(nt(e,!0)!==nt(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function b(e){if(it(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function C(e,t){if(!e)throw new H(t)}function R(e){return J&&L.isBrokenNode(e)||!z(Z,e.nodeType)&&!nt(e,!0)}function E(e,t){return t<=(V(e)?e.length:e.childNodes.length)}function x(e){return!!e.startContainer&&!!e.endContainer&&!R(e.startContainer)&&!R(e.endContainer)&&E(e.startContainer,e.startOffset)&&E(e.endContainer,e.endOffset)}function I(e){if(v(e),!x(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function T(e,t){I(e);var n=e.startContainer,i=e.startOffset,r=e.endContainer,o=e.endOffset,a=n===r;V(r)&&o>0&&o<r.length&&W(r,o,t),V(n)&&i>0&&i<n.length&&(n=W(n,i,t),a?(o-=i,r=n):r==n.parentNode&&o>=K(n)&&o++,i=0),e.setStartAndEnd(n,i,r,o)}function N(e){e.START_TO_START=ct,e.START_TO_END=dt,e.END_TO_END=ft,e.END_TO_START=ht,e.NODE_BEFORE=pt,e.NODE_AFTER=gt,e.NODE_BEFORE_AND_AFTER=mt,e.NODE_INSIDE=vt}function D(e){N(e),N(e.prototype)}function P(e,t){return function(){I(this);var n,i,o=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,u=new h(this,!0);o!==s&&(n=q(o,s,!0),i=r(n),o=i.node,a=i.offset),l(u,b),u.reset();var c=e(u);return u.detach(),t(this,o,a,o,a),c}}function _(n,o,a){function s(e,t){return function(n){v(this),y(n,Y),y(X(n),Z);var o=(e?i:r)(n);(t?l:d)(this,o.node,o.offset)}}function l(e,t,n){var i=e.endContainer,r=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(i)||1==$(t,n,i,r))&&(i=t,r=n),o(e,t,n,i,r))}function d(e,t,n){var i=e.startContainer,r=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(i)||-1==$(t,n,i,r))&&(i=t,r=n),o(e,i,r,t,n))}var f=function(){};f.prototype=e.rangePrototype,n.prototype=new f,F.extend(n.prototype,{setStart:function(e,t){v(this),m(e,!0),S(e,t),l(this,e,t)},setEnd:function(e,t){v(this),m(e,!0),S(e,t),d(this,e,t)},setStartAndEnd:function(){v(this);var e=arguments,t=e[0],n=e[1],i=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:i=e[2],r=e[3]}o(this,t,n,i,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){I(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(this),m(e,!0),o(this,e,0,e,G(e))},selectNode:function(e){v(this),m(e,!1),y(e,Y);var t=i(e),n=r(e);o(this,t.node,t.offset,n.node,n.offset)},extractContents:P(c,o),deleteContents:P(u,o),canSurroundContents:function(){I(this),b(this.startContainer),b(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){a(this)},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(e){T(this,e)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(r){var o=r.previousSibling;if(o&&o.nodeType==r.nodeType){e=r;var a=r.length;if(t=o.length,r.insertData(0,o.data),o.parentNode.removeChild(o),e==n)i+=t,n=e;else if(n==r.parentNode){var s=K(r);i==s?(n=r,i=a):i>s&&i--}}},s=!0;if(V(n))n.length==i&&r(n);else{if(i>0){var l=n.childNodes[i-1];l&&V(l)&&r(l)}s=!this.collapsed}if(s){if(V(e))0==t&&a(e);else if(t<e.childNodes.length){var u=e.childNodes[t];u&&V(u)&&a(u)}}else e=n,t=i;o(this,e,t,n,i)},collapseToPoint:function(e,t){v(this),m(e,!0),S(e,t),this.setStartAndEnd(e,t)}}),D(n)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function A(e,t,n,i,r){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=r,e.document=L.getDocument(t),O(e)}function k(e){v(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,O(this)}var L=e.dom,F=e.util,B=L.DomPosition,H=e.DOMException,V=L.isCharacterDataNode,K=L.getNodeIndex,U=L.isOrIsAncestorOf,j=L.getDocument,$=L.comparePoints,W=L.splitDataNode,q=L.getClosestAncestorIn,G=L.getNodeLength,z=L.arrayContains,X=L.getRootContainer,J=e.features.crashyTextNodes;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,V(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!V(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new M(n(this.range));var t=this._current,i=t,r=0,o=t,a=G(t);U(t,this.sc)&&(i=this.sc,r=this.so),U(t,this.ec)&&(o=this.ec,a=this.eo),A(e,i,r,o,a)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},p.prototype.toString=function(){return this.message};var Y=[1,3,4,5,7,8,10],Z=[2,9,11],Q=[5,6,10,12],et=[1,3,4,5,7,8,10,11],tt=[1,3,4,5,7,8],nt=g([9,11]),it=g(Q),rt=g([6,10,12]),ot=document.createElementNS("http://www.w3.org/1999/xhtml","style"),at=!1;try{ot.innerHTML="<b>x</b>",at=3==ot.firstChild.nodeType}catch(st){}e.features.htmlParsingConforms=at;var lt=at?function(e){var t=this.startContainer,n=j(t);if(!t)throw new H("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:V(t)&&(i=L.parentElement(t)),i=null===i||"HTML"==i.nodeName&&L.isHtmlNamespace(j(i).documentElement)&&L.isHtmlNamespace(i)?n.createElementNS("http://www.w3.org/1999/xhtml","body"):i.cloneNode(!1),i.innerHTML=e,L.fragmentFromNodeChildren(i)}:function(e){v(this);var t=n(this),i=t.createElementNS("http://www.w3.org/1999/xhtml","body");return i.innerHTML=e,L.fragmentFromNodeChildren(i)},ut=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ct=0,dt=1,ft=2,ht=3,pt=0,gt=1,mt=2,vt=3;F.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){I(this),w(this.startContainer,t.startContainer);var n,i,r,o,a=e==ht||e==ct?"start":"end",s=e==dt||e==ct?"start":"end";return n=this[a+"Container"],i=this[a+"Offset"],r=t[s+"Container"],o=t[s+"Offset"],$(n,i,r,o)},insertNode:function(e){if(I(this),y(e,et),b(this.startContainer),U(e,this.startContainer))throw new H("HIERARCHY_REQUEST_ERR");var t=o(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&V(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var i=new h(this,!0);return e=s(i),i.detach(),e},canSurroundContents:function(){I(this),b(this.startContainer),b(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(y(e,tt),!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);o(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){I(this);for(var e,t=new M(n(this)),i=ut.length;i--;)e=ut[i],t[e]=this[e];return t},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&V(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return l(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){I(this);var t=e.parentNode,n=K(e);if(!t)throw new H("NOT_FOUND_ERR");var i=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>i?r>0?mt:pt:r>0?gt:vt},comparePoint:function(e,t){return I(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),$(e,t,this.startContainer,this.startOffset)<0?-1:$(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:lt,toHtml:function(){I(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(I(this),C(e,"NOT_FOUND_ERR"),j(e)!==n(this))return!1;var i=e.parentNode,r=K(e);C(i,"NOT_FOUND_ERR");var o=$(i,r,this.endContainer,this.endOffset),a=$(i,r+1,this.startContainer,this.startOffset);return t?0>=o&&a>=0:0>o&&a>0},isPointInRange:function(e,t){return I(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),$(e,t,this.startContainer,this.startOffset)>=0&&$(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return a(this,e,!1)},intersectsOrTouchesRange:function(e){return a(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=$(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=$(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==$(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==$(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new p("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==vt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,G(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();t.setEnd(i,i.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},getNodes:function(e,t){return I(this),d(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){v(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){v(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var i=n(this),r=e.createRange(i);t=t||L.getBody(i),r.selectNodeContents(t);var o=this.intersection(r),a=0,s=0;return o&&(r.setEnd(o.startContainer,o.startOffset),a=r.toString().length,s=a+o.toString().length,r.detach()),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,r,o,a,s=[t],l=!1,u=!1;!u&&(i=s.pop());)if(3==i.nodeType)r=n+i.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(i,e.end-n),u=!0),n=r;else for(a=i.childNodes,o=a.length;o--;)s.push(a[o])},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return x(this)},inspect:function(){return f(this)}}),_(M,A,k),F.extend(M,{rangeProperties:ut,RangeIterator:h,copyComparisonConstants:D,createPrototypeRange:_,inspect:f,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=M,e.RangeException=p}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,r=e.dom,o=e.util,a=r.DomPosition,s=e.DomRange,l=r.getBody,u=r.getContentDocument,c=r.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function i(e){for(var t,n=h.length;n--;)t=h[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,i,r){var o=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==i||e.endOffset!=r,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(i,r),e.setStart(t,n))}function c(e){e.nativeRange.detach(),e.detached=!0;for(var t=h.length;t--;)e[h[t]]=null}var d,f,h=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,i(this)},s.createPrototypeRange(n,a,c),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),i(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),i(this)},d.collapse=function(e){this.nativeRange.collapse(e),i(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){i(this)},d.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");l(document).appendChild(p);var g=document.createRange();g.setStart(p,0),g.setEnd(p,0);try{g.setStart(p,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),i(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),i(this)},f=function(e){return function(t){this.nativeRange[e](t),i(this)}}}catch(m){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}i(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}i(this)},f=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}i(this)}}}d.setStartBefore=f("setStartBefore","setEndBefore"),d.setStartAfter=f("setStartAfter","setEndAfter"),d.setEndBefore=f("setEndBefore","setStartBefore"),d.setEndAfter=f("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},g.selectNodeContents(p),g.setEnd(p,3);var v=document.createRange();v.selectNodeContents(p),v.setEnd(p,4),v.setStart(p,2),d.compareBoundaryPoints=-1==g.compareBoundaryPoints(g.START_TO_END,v)&&1==g.compareBoundaryPoints(g.END_TO_START,v)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElementNS("http://www.w3.org/1999/xhtml","div");y.innerHTML="123";var S=y.firstChild,w=l(document);w.appendChild(y),g.setStart(S,1),g.setEnd(S,2),g.deleteContents(),"13"==S.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return i(this),e}),w.removeChild(y),w=null,o.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(p),g.detach(),v.detach(),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var d=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var o=n.parentElement(),a=i==o?i:r.getCommonAncestor(i,o);return a==t?a:r.getCommonAncestor(t,a)},f=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,i,o){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(r.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var u=new a(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:u,nodeInfo:{nodeIndex:u.offset,containerElement:u.node}}}var d=r.getDocument(l).createElementNS("http://www.w3.org/1999/xhtml","span");d.parentNode&&d.parentNode.removeChild(d);for(var f,h,p,g,m,v=n?"StartToStart":"StartToEnd",y=o&&o.containerElement==l?o.nodeIndex:0,S=l.childNodes.length,w=S,b=w;;){if(b==S?l.appendChild(d):l.insertBefore(d,l.childNodes[b]),s.moveToElementText(d),f=s.compareEndPoints(v,e),0==f||y==w)break;if(-1==f){if(w==y+1)break;y=b}else w=w==y+1?y:b;b=Math.floor((y+w)/2),l.removeChild(d)}if(m=d.nextSibling,-1==f&&m&&c(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var C;if(/[\r\n]/.test(m.data)){var R=s.duplicate(),E=R.text.replace(/\r\n/g,"\r").length;for(C=R.moveStart("character",E);-1==(f=R.compareEndPoints("StartToEnd",R));)C++,R.moveStart("character",1)}else C=s.text.length;g=new a(m,C)}else h=(i||!n)&&d.previousSibling,p=(i||n)&&d.nextSibling,g=p&&c(p)?new a(p,0):h&&c(h)?new a(h,h.data.length):new a(l,r.getNodeIndex(d));return d.parentNode.removeChild(d),{boundaryPosition:g,nodeInfo:{nodeIndex:b,containerElement:l}}},p=function(e,t){var n,i,o,a,s=e.offset,u=r.getDocument(e.node),d=l(u).createTextRange(),f=c(e.node);return f?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),o=u.createElementNS("http://www.w3.org/1999/xhtml","span"),o.innerHTML="&#feff;",n?i.insertBefore(o,n):i.appendChild(o),d.moveToElementText(o),d.collapse(!t),i.removeChild(o),f&&d[t?"moveStart":"moveEnd"]("character",s),d
};if(i=function(e){this.textRange=e,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var e,t,n,i=d(this.textRange);f(this.textRange)?t=e=h(this.textRange,i,!0,!0).boundaryPosition:(n=h(this.textRange,i,!0,!1),e=n.boundaryPosition,t=h(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(i),i.rangeToTextRange=function(e){if(e.collapsed)return p(new a(e.startContainer,e.startOffset),!0);var t=p(new a(e.startContainer,e.startOffset),!0),n=p(new a(e.endContainer,e.endOffset),!1),i=l(s.getRangeDocument(e)).createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var g=function(){return this}();"undefined"==typeof g.Range&&(g.Range=i),e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=u(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=u(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function i(e,n){if(e){if(N.isWindow(e))return e;if(e instanceof v)return e.win;var i=N.getContentDocument(e,t,n);return N.getWindow(i)}return window}function r(e){return i(e,"getWinSelection").getSelection()}function o(e){return i(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==N.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var i=n?"end":"start",r=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function u(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var n;return t instanceof _?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof O?n=t.nativeRange:M.implementsDomRange&&t instanceof N.getWindow(t.startContainer).Range&&(n=t),n}function d(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!N.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var n=e.getNodes();if(!d(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function p(e,t){var n=new O(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)u(t);else{var n=t.docSelection.createRange();if(h(n))p(t,n);else{t.rangeCount=n.length;for(var i,r=F(n.item(0)),o=0;o<t.rangeCount;++o)i=e.createRange(r),i.selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var i=e.docSelection.createRange(),r=f(n),o=F(i.item(0)),a=B(o).createControlRange(),s=0,l=i.length;l>s;++s)a.add(i.item(s));try{a.add(r)}catch(u){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),g(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function S(e,t){for(var n,i,r=tt.length;r--;)if(n=tt[r],i=n.selection,"deleteAll"==t)y(i);else if(n.win==e)return"delete"==t?(tt.splice(r,1),!0):i;return"deleteAll"==t&&(tt.length=0),null}function w(e,n){for(var i,r=F(n[0].startContainer),o=B(r).createControlRange(),a=0,s=n.length;s>a;++a){i=f(n[a]);try{o.add(i)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),g(e)}function b(e,t){if(e.win.document!=F(t))throw new A("WRONG_DOCUMENT_ERR")}function C(t){return function(n,i){var r;this.rangeCount?(r=this.getRangeAt(0),r["set"+(t?"Start":"End")](n,i)):(r=e.createRange(this.win.document),r.setStartAndEnd(n,i)),this.setSingleRange(r,this.isBackward())}}function R(e){var t=[],n=new k(e.anchorNode,e.anchorOffset),i=new k(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,a=e.rangeCount;a>o;++o)t[o]=_.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.config.checkSelectionRanges=!0;var E,x,I="boolean",T="number",N=e.dom,D=e.util,P=D.isHostMethod,_=e.DomRange,O=e.WrappedRange,A=e.DOMException,k=N.DomPosition,M=e.features,L="Control",F=N.getDocument,B=N.getBody,H=_.rangesEqual,V=P(window,"getSelection"),K=D.isHostObject(document,"selection");M.implementsWinGetSelection=V,M.implementsDocSelection=K;var U=K&&(!V||e.config.preferTextRange);U?(E=o,e.isSelectionValid=function(e){var t=i(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||F(n.createRange().parentElement())==t}):V?(E=r,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=E;var j=E(),$=e.createNativeRange(document),W=B(document),q=D.areHostProperties(j,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=q;var G=P(j,"extend");M.selectionHasExtend=G;var z=typeof j.rangeCount==T;M.selectionHasRangeCount=z;var X=!1,J=!0,Y=G?function(t,n){var i=_.getRangeDocument(n),r=e.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(c(r)),t.extend(n.startContainer,n.startOffset)}:null;D.areHostMethods(j,["addRange","getRangeAt","removeAllRanges"])&&typeof j.rangeCount==T&&M.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,r=[],o=a(t),s=0;n>s;++s)r[s]=t.getRangeAt(s);var l=B(document),u=l.appendChild(document.createElementNS("http://www.w3.org/1999/xhtml","div"));u.contentEditable="false";var c=u.appendChild(document.createTextNode("   ")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.addRange(d),J=1==t.rangeCount,t.removeAllRanges(),!i){var f=d.cloneRange();d.setStart(c,0),f.setEnd(c,3),f.setStart(c,2),t.addRange(d),t.addRange(f),X=2==t.rangeCount,f.detach()}for(l.removeChild(u),t.removeAllRanges(),d.detach(),s=0;n>s;++s)0==s&&o?Y?Y(t,r[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(r[s])):t.addRange(r[s])}}(),M.selectionSupportsMultipleRanges=X,M.collapsedNonEditableSelectionsSupported=J;var Z,Q=!1;W&&P(W,"createControlRange")&&(Z=W.createControlRange(),D.areHostProperties(Z,["item","add"])&&(Q=!0)),M.implementsControlRange=Q,x=q?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var et;P(j,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:q&&(et=function(t){var n=F(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),v.prototype=e.selectionPrototype;var tt=[],nt=function(e){if(e&&e instanceof v)return e.refresh(),e;e=i(e,"getNativeSelection");var t=S(e),n=E(e),r=K?o(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new v(n,r,e),tt.push({win:e,selection:t})),t};e.getSelection=nt,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(N.getIframeWindow(n))};var it=v.prototype;if(!U&&q&&D.areHostMethods(j,["removeAllRanges","addRange"])){it.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),u(this)};var rt=function(e,t){Y(e.nativeSelection,t),e.refresh()};it.addRange=z?function(t,i){if(Q&&K&&this.docSelection.type==L)m(this,t);else if(n(i)&&G)rt(this,t);else{var r;if(X?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(c(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var o=et(this.nativeSelection,this.rangeCount-1);o&&!H(o,t)&&(t=new O(o))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=x(this)}else this.refresh()}}:function(e,t){n(t)&&G?rt(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},it.setRanges=function(e){if(Q&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(P(j,"empty")&&P($,"select")&&Q&&U))return t.fail("No means of selecting a Range or TextRange was found"),!1;it.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=F(this.anchorNode);else if(this.docSelection.type==L){var t=this.docSelection.createRange();t.length&&(e=F(t.item(0)))}if(e){var n=B(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}u(this)},it.addRange=function(t){this.docSelection.type==L?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},it.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}it.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new A("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ot;if(U)ot=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=B(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==L?g(t):h(n)?p(t,n):u(t)};else if(P(j,"getRangeAt")&&typeof j.rangeCount==T)ot=function(t){if(Q&&K&&t.docSelection.type==L)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=x(t)}else u(t)};else{if(!q||typeof j.isCollapsed!=I||typeof $.collapsed!=I||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ot=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=x(e)):u(e)}}it.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(ot(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!H(t[r],this._ranges[r]))return!0;return!1}};var at=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,r=n.length;r>i;++i)H(t,n[i])||e.addRange(n[i]);e.rangeCount||u(e)};it.removeRange=Q?function(e){if(this.docSelection.type==L){for(var t,n=this.docSelection.createRange(),i=f(e),r=F(n.item(0)),o=B(r).createControlRange(),a=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==i||a?o.add(n.item(s)):a=!0;o.select(),g(this)}else at(this,e)}:function(e){at(this,e)};var st;!U&&q&&M.implementsDomRange?(st=a,it.isBackward=function(){return st(this)}):st=it.isBackward=function(){return!1},it.isBackwards=it.isBackward,it.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},it.collapse=function(t,n){b(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},it.collapseToStart=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},it.collapseToEnd=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},it.selectAllChildren=function(t){b(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},it.deleteFromDocument=function(){if(Q&&K&&this.docSelection.type==L){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,r=n.length;r>i;++i)n[i].deleteContents();this.addRange(n[r-1])}}},it.eachRange=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(e(this.getRangeAt(n)))return t},it.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},it.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},it.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t))}),n},it.setStart=C(!0),it.setEnd=C(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},it.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},it.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},it.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},it.moveToBookmark=function(t){for(var n,i,r=[],o=0;n=t.rangeBookmarks[o++];)i=e.createRange(this.win),i.moveToBookmark(n),r.push(i);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},it.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},it.getName=function(){return"WrappedSelection"},it.inspect=function(){return R(this)},it.detach=function(){S(this.win,"delete"),y(this)},v.detachAll=function(){S(null,"deleteAll")},v.inspect=R,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=it,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return nt(e)}),e=null})}),define("rangy-core",["domReady"],function(e){return function(){var t,n;return n=function(e){var t=this.rangy;return e(function(){t.init()}),this.rangy},t=n.apply(e,arguments),t||e.rangy}}(this)),rangy.createModule("Highlighter",["ClassApplier"],function(e){function t(e,t){return e.characterRange.start-t.characterRange.start}function n(e,t){this.type=e,this.converterCreator=t}function i(e,t){h[e]=new n(e,t)}function r(e){var t=h[e];if(t instanceof n)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function o(e,t){this.start=e,this.end=t}function a(e,t,n,i,r,o){r?(this.id=r,f=Math.max(f,r+1)):this.id=f++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=i,this.containerElementId=o||null,this.applied=!1}function s(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=r(t)}var l=e.dom,u=l.arrayContains,c=l.getBody,d=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,i=e.length;i>n;++n)t(e[n])},f=1,h={};n.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=i,o.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},union:function(e){return new o(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new o(Math.max(this.start,e.start),Math.min(this.end,e.end))},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},o.fromCharacterRange=function(e){return new o(e.start,e.end)};var p={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new o(n.start,n.end)},characterRangeToRange:function(t,n,i){var r=e.createRange(t);return r.moveToBookmark({start:n.start,end:n.end,containerNode:i}),r},serializeSelection:function(e,t){for(var n=e.getAllRanges(),i=n.length,r=[],o=1==i&&e.isBackward(),a=0,s=n.length;s>a;++a)r[a]={characterRange:this.rangeToCharacterRange(n[a],t),backward:o};return r},restoreSelection:function(e,t,n){e.removeAllRanges();for(var i,r,o,a=e.win.document,s=0,l=t.length;l>s;++s)r=t[s],o=r.characterRange,i=this.characterRangeToRange(a,r.characterRange,n),e.addRange(i,r.backward)}};i("textContent",function(){return p}),i("TextRange",function(){var t;return function(){if(!t){var n=e.modules.TextRange;if(!n)throw new Error("TextRange module is missing.");if(!n.supported)throw new Error("TextRange module is present but not supported.");t={rangeToCharacterRange:function(e,t){return o.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,i){var r=e.createRange(t);return r.selectCharacters(i,n.start,n.end),r},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return t}}()),a.prototype={getContainerElement:function(){return this.containerElementId?this.doc.getElementById(this.containerElementId):c(this.doc)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.cssClass+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},s.prototype={addClassApplier:function(e){this.classAppliers[e.cssClass]=e},getHighlightForElement:function(e){for(var t=this.highlights,n=0,i=t.length;i>n;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t,n=0,i=this.highlights.length;i>n;++n)t=this.highlights[n],u(e,t)&&(t.unapply(),this.highlights.splice(n--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){{var t=[],n=this.highlights;this.converter}return d(e,function(e){d(n,function(n){e.intersectsRange(n.getRange())&&!u(t,n)&&t.push(n)})}),t},highlightCharacterRanges:function(t,n,i){var r,s,l,u=this.highlights,c=this.converter,f=this.doc,h=[],p=this.classAppliers[t];i=i||null;var g,m,v;i&&(g=this.doc.getElementById(i),g&&(m=e.createRange(this.doc),m.selectNodeContents(g),v=new o(0,m.toString().length),m.detach()));var y,S,w;for(r=0,s=n.length;s>r;++r){for(y=n[r],w=!1,v&&(y=y.intersection(v)),l=0;l<u.length;++l)i==u[l].containerElementId&&(S=u[l].characterRange,S.intersects(y)&&(h.push(u[l]),u[l]=new a(f,S.union(y),p,c,null,i)));w||u.push(new a(f,y,p,c,null,i))}d(h,function(e){e.unapply()});var b=[];return d(u,function(e){e.applied||(e.apply(),b.push(e))}),b},highlightRanges:function(t,n,i){var r,o=[],a=this.converter,s=i?i.id:null;return i&&(r=e.createRange(i),r.selectNodeContents(i)),d(n,function(e){var t=i?r.intersection(e):e;o.push(a.rangeToCharacterRange(t,i||c(e.getDocument())))}),this.highlightCharacterRanges(o,n,s)},highlightSelection:function(t,n,i){var r=this.converter;n=n||e.getSelection();var a=this.classAppliers[t],s=n.win.document,l=i?s.getElementById(i):c(s);if(!a)throw new Error("No class applier found for class '"+t+"'");var u=r.serializeSelection(n,l),f=[];d(u,function(e){f.push(o.fromCharacterRange(e.characterRange))});var h=this.highlightCharacterRanges(t,f,i);return r.restoreSelection(n,u,l),h},unhighlightSelection:function(t){t=t||e.getSelection();var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var n=this.highlights;n.sort(t);var i=["type:"+this.converter.type];return d(n,function(t){var n=t.characterRange,r=[n.start,n.end,t.id,t.classApplier.cssClass,t.containerElementId];e&&e.serializeHighlightText&&r.push(t.getText()),i.push(r.join("$"))}),i.join("|")},deserialize:function(e){var t,n,i,s=e.split("|"),l=[],u=s[0],d=!1;if(!u||!(t=/^type:(\w+)$/.exec(u)))throw new Error("Serialized highlights are invalid.");n=t[1],n!=this.converter.type&&(i=r(n),d=!0),s.shift();for(var f,h,p,g,m,v,y=s.length;y-->0;)v=s[y].split("$"),p=new o(+v[0],+v[1]),g=v[4]||null,m=g?this.doc.getElementById(g):c(this.doc),d&&(p=this.converter.rangeToCharacterRange(i.characterRangeToRange(this.doc,p,m),m)),f=this.classAppliers[v[3]],h=new a(this.doc,p,f,this.converter,parseInt(v[2]),g),h.apply(),l.push(h);this.highlights=l}},e.Highlighter=s,e.createHighlighter=function(e,t){return new s(e,t)}}),define("rangy-highlighter",["rangy-core"],function(e){return function(){var t;return t||e.rangy.modules.Highlighter}}(this)),rangy.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function i(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function o(e,t){e.className?r(e,t)||(e.className+=" "+t):e.className=t}function a(e){return e.split(/\s+/).sort().join(" ")}function s(e){return a(e.className)}function l(e,t){return s(e)==s(t)}function u(e,t,n,i,r){var o=e.node,a=e.offset,s=o,l=a;o==i&&a>r&&++l,o!=t||a!=n&&a!=n+1||(s=i,l+=r-n),o==t&&a>n+1&&--l,e.node=s,e.offset=l}function c(e,t,n){e.node==t&&e.offset>n&&--e.offset}function d(e,t,n,i){-1==n&&(n=t.childNodes.length);for(var r,o=e.parentNode,a=A.getNodeIndex(e),s=0;r=i[s++];)u(r,o,a,t,n);t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function f(e,t){for(var n,i=e.parentNode,r=A.getNodeIndex(e),o=0;n=t[o++];)c(n,i,r);e.parentNode.removeChild(e)}function h(e,t,n,i,r){for(var o,a=[];o=e.firstChild;)d(o,t,n++,r),a.push(o);return i&&e.parentNode.removeChild(e),a}function p(e,t){return h(e,e.parentNode,A.getNodeIndex(e),!0,t)}function g(e,t){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e),r=i?i.toString():"";return n.detach(),""!=r}function m(e){for(var t,n=e.getNodes([3]),i=0;(t=n[i])&&!g(e,t);)++i;for(var r=n.length-1;(t=n[r])&&!g(e,t);)--r;return n.slice(i,r+1)}function v(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,r,o=0,a=e.attributes.length;a>o;++o)if(n=e.attributes[o],r=n.name,"class"!=r){if(i=t.attributes.getNamedItem(r),null===n!=(null===i))return!1;if(n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function y(e,t){for(var n,i=0,r=e.attributes.length;r>i;++i)if(n=e.attributes[i].name,(!t||!M(t,n))&&e.attributes[i].specified&&"class"!=n)return!0;return!1}function S(e,t){return n(t,function(t,n){if("object"==typeof n){if(!S(e[t],n))return!1}else if(e[t]!==n)return!1}),!0}function w(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||H(e)&&!H(e.parentNode))}function b(e){return(H(e)||1!=e.nodeType&&H(e.parentNode))&&!w(e)}function C(e){return e&&1==e.nodeType&&!V.test(B(e,"display"))}function R(e){if(0==e.data.length)return!0;if(K.test(e.data))return!1;var t=B(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return C(e.previousSibling)||C(e.nextSibling)}function E(e){var t,n,i=[];for(t=0;n=e[t++];)i.push(new k(n.startContainer,n.startOffset),new k(n.endContainer,n.endOffset));return i}function x(e,t){for(var n,i,r,o=0,a=e.length;a>o;++o)n=e[o],i=t[2*o],r=t[2*o+1],n.setStartAndEnd(i.node,i.offset,r.node,r.offset)}function I(e,t){return A.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function T(e,n,i,r){var o,a,s=0==i;if(A.isAncestorOf(n,e))return e;if(A.isCharacterDataNode(n)){var l=A.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(I(n,i)){o=n.cloneNode(!1),a=n.parentNode,o.id&&o.removeAttribute("id");for(var u,c=0;u=n.childNodes[i];)d(u,o,c++,r);return d(o,a,A.getNodeIndex(n)+1,r),n==e?o:T(e,a,A.getNodeIndex(o),r)}if(e!=n){o=n.parentNode;var f=A.getNodeIndex(n);return s||f++,T(e,o,f,r)}return e}function N(e,t){return e.tagName==t.tagName&&l(e,t)&&v(e,t)&&"inline"==B(e,"display")&&"inline"==B(t,"display")}function D(e){var t=e?"nextSibling":"previousSibling";return function(n,i){var r=n.parentNode,o=n[t];if(o){if(o&&3==o.nodeType)return o}else if(i&&(o=r[t],o&&1==o.nodeType&&N(r,o))){var a=o[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}function P(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function _(e,t,r){var o,a,s,l,u=this;u.cssClass=e;var c=null,d={};if("object"==typeof t&&null!==t){for(r=t.tagNames,c=t.elementProperties,d=t.elementAttributes,a=0;l=$[a++];)t.hasOwnProperty(l)&&(u[l]=t[l]);o=t.normalize}else o=t;u.normalize="undefined"==typeof o?!0:o,u.attrExceptions=[];var f=document.createElementNS("http://www.w3.org/1999/xhtml",u.elementTagName);u.elementProperties=u.copyPropertiesToElement(c,f,!0),n(d,function(e){u.attrExceptions.push(e)}),u.elementAttributes=d,u.elementSortedClassName=u.elementProperties.hasOwnProperty("className")?u.elementProperties.className:e,u.applyToAnyTagName=!1;var h=typeof r;if("string"==h)"*"==r?u.applyToAnyTagName=!0:u.tagNames=i(r.toLowerCase()).split(/\s*,\s*/);else if("object"==h&&"number"==typeof r.length)for(u.tagNames=[],a=0,s=r.length;s>a;++a)"*"==r[a]?u.applyToAnyTagName=!0:u.tagNames.push(r[a].toLowerCase());else u.tagNames=[u.elementTagName]}function O(e,t,n){return new _(e,t,n)}var A=e.dom,k=A.DomPosition,M=A.arrayContains,L="span",F=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}(),B=A.getComputedStyleProperty,H=function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","div");return"boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||H(e.parentNode):!1}}(),V=/^inline(-block|-table)?$/i,K=/[^\r\n\t\f ​]/,U=D(!1),j=D(!0);P.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){for(var i,r,o,a,s=[],l=0,u=0,c=t.length;c>u;++u){if(i=t[u],r=i.parentNode,u>0&&(r.removeChild(i),r.hasChildNodes()||r.parentNode.removeChild(r),e))for(o=0;a=e[o++];)a.node==i&&(a.node=n,a.offset+=l);s[u]=i.data,l+=i.data.length}n.data=s.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var $=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],W={};_.prototype={elementTagName:L,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var i,r,s,l,u,c,d={};for(var f in e)if(e.hasOwnProperty(f))if(l=e[f],u=t[f],"className"==f)o(t,l),o(t,this.cssClass),t[f]=a(t[f]),n&&(d[f]=t[f]);else if("style"==f){r=u,n&&(d[f]=s={});for(i in e[f])r[i]=l[i],n&&(s[i]=r[i]);this.attrExceptions.push(f)}else t[f]=l,n&&(d[f]=t[f],c=W.hasOwnProperty(f)?W[f]:f,this.attrExceptions.push(c));return n?d:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},hasClass:function(e){return 1==e.nodeType&&M(this.tagNames,e.tagName.toLowerCase())&&r(e,this.cssClass)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||b(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&R(e)},postApply:function(e,t,n,i){for(var r,o,a,s=e[0],l=e[e.length-1],u=[],c=s,d=l,f=0,h=l.length,p=0,g=e.length;g>p;++p)o=e[p],a=U(o,!i),a?(r||(r=new P(a),u.push(r)),r.textNodes.push(o),o===s&&(c=r.textNodes[0],f=c.length),o===l&&(d=r.textNodes[0],h=r.getLength())):r=null;var m=j(l,!i);if(m&&(r||(r=new P(l),u.push(r)),r.textNodes.push(m)),u.length){for(p=0,g=u.length;g>p;++p)u[p].doMerge(n);t.setStartAndEnd(c,f,d,h)}},createContainer:function(e){var t=e.createElementNS("http://www.w3.org/1999/xhtml",this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),o(t,this.cssClass),this.onElementCreate&&this.onElementCreate(t,this),t},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&M(this.tagNames,t.tagName.toLowerCase())&&S(t,this.elementProperties))o(t,this.cssClass);else{var n=this.createContainer(A.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&s(e)==this.elementSortedClassName&&S(e,this.elementProperties)&&!y(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){for(var t,n=this,i=e.getNodes([1],function(e){return n.isEmptyContainer(e)}),r=[e],o=E(r),a=0;t=i[a++];)f(t,o);x(r,o)},undoToTextNode:function(e,t,n,i){if(!t.containsNode(n)){var r=t.cloneRange();r.selectNode(n),r.isPointInRange(t.endContainer,t.endOffset)&&(T(n,t.endContainer,t.endOffset,i),t.setEndAfter(n)),r.isPointInRange(t.startContainer,t.startOffset)&&(n=T(n,t.startContainer,t.startOffset,i))}this.isRemovable(n)?p(n,i):F(n,this.cssClass)},applyToRange:function(e,t){t=t||[];var n=E(t||[]);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e);var i=m(e);if(i.length){for(var r,o=0;r=i[o++];)this.isIgnorableWhiteSpaceNode(r)||this.getSelfOrAncestorWithClass(r)||!this.isModifiable(r)||this.applyToTextNode(r,n);r=i[i.length-1],e.setStartAndEnd(i[0],0,r,r.length),this.normalize&&this.postApply(i,e,n,!1),x(t,n)}},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=E(t);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e,n);var i,r,o=m(e),a=o[o.length-1];if(o.length){for(var s=0,l=o.length;l>s;++s)i=o[s],r=this.getSelfOrAncestorWithClass(i),r&&this.isModifiable(i)&&this.undoToTextNode(i,e,r,n),e.setStartAndEnd(o[0],0,a,a.length);this.normalize&&this.postApply(o,e,n,!0),x(t,n)}},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),i=e.getSelection(t).getAllRanges();
this.undoToRanges(i),n.setRanges(i)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,i=0;n=t[i++];)if(!this.isIgnorableWhiteSpaceNode(n)&&g(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var i=n.getSelfOrAncestorWithClass(e);i&&!M(t,i)&&t.push(i)}),t},detach:function(){}},_.util={hasClass:r,addClass:o,removeClass:F,hasSameClasses:l,replaceWithOwnChildren:p,elementsHaveSameNonClassAttributes:v,elementHasNonClassAttributes:y,splitNodeAt:T,isEditableElement:H,isEditingHost:w,isEditable:b},e.CssClassApplier=e.ClassApplier=_,e.createCssClassApplier=e.createClassApplier=O}),define("rangy-cssclassapplier",["rangy-core"],function(e){return function(){var t;return t||e.rangy.modules.ClassApplier}}(this)),rangy.createModule("TextRange",["WrappedSelection"],function(e,t){function n(e,t){function n(t,n,i){for(var r=e.slice(t,n),o={isWord:i,chars:r,toString:function(){return r.join("")}},a=0,l=r.length;l>a;++a)r[a].token=o;s.push(o)}for(var i,r,o,a=e.join(""),s=[],l=0;i=t.wordRegex.exec(a);){if(r=i.index,o=r+i[0].length,r>l&&n(l,r,!1),t.includeTrailingSpace)for(;X.test(e[o]);)++o;n(r,o,!0),l=o}return l<e.length&&n(l,e.length,!1),s}function i(e,t){if(e){var n={};return $(n,t),$(n,e),n}return t}function r(e){var t,n;return e?(t=e.language||J,n={},$(n,ot[t]||ot[J]),$(n,e),n):ot[J]}function o(e){return i(e,it)}function a(e){return i(e,rt)}function s(e,t){var n=ct(e,"display",t),i=e.tagName.toLowerCase();return"block"==n&&nt&&dt.hasOwnProperty(i)?dt[i]:n}function l(e){for(var t=h(e),n=0,i=t.length;i>n;++n)if(1==t[n].nodeType&&"none"==s(t[n]))return!0;return!1}function u(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==ct(t,"visibility")}function c(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(s(e))||9==e.nodeType||11==e.nodeType)}function d(e){return U.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function f(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function h(e){return f(e).concat([e])}function p(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}function g(e,t){return!t&&e.hasChildNodes()?e.firstChild:p(e)}function m(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var n=e.parentNode;return n&&1==n.nodeType?n:null}function v(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var n=e.parentNode;if(!n||1!=n.nodeType)return!1;var i=ct(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(i)||/^[\t\r ]+$/.test(t)&&"pre-line"==i}function y(e){if(""===e.data)return!0;if(!v(e))return!1;var t=e.parentNode;return t?l(e)?!0:!1:!0}function S(e){var t=e.nodeType;return 7==t||8==t||l(e)||/^(script|style)$/i.test(e.nodeName)||u(e)||y(e)}function w(e,t){var n=e.nodeType;return 7==n||8==n||1==n&&"none"==s(e,t)}function b(){this.store={}}function C(e,t,n){return function(i){var r=this.cache;if(r.hasOwnProperty(e))return ft++,r[e];ht++;var o=t.call(this,n?this[n]:this,i);return r[e]=o,o}}function R(e,t){this.node=e,this.session=t,this.cache=new b,this.positions=new b}function E(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new b}function x(){return"[Position("+U.inspectNode(this.node)+":"+this.offset+")]"}function I(){return N(),xt=new It}function T(){return xt||I()}function N(){xt&&xt.detach(),xt=null}function D(e,n,i,r){function o(){var e=null;return n?(e=s,l||(s=s.previousVisible(),l=!s||i&&s.equals(i))):l||(e=s=s.nextVisible(),l=!s||i&&s.equals(i)),l&&(s=null),e}i&&(n?S(i.node)&&(i=e.previousVisible()):S(i.node)&&(i=i.nextVisible()));var a,s=e,l=!1,u=!1;return{next:function(){if(u)return u=!1,a;for(var e,t;e=o();)if(t=e.getCharacter(r))return a=e,e;return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");u=!0},dispose:function(){e=i=null}}}function P(e,t,n){function i(e){for(var t,n,i=[],a=e?r:o,s=!1,l=!1;t=a.next();){if(n=t.character,z.test(n))l&&(l=!1,s=!0);else{if(s){a.rewind();break}l=!0}i.push(t)}return i}var r=D(e,!1,null,t),o=D(e,!0,null,t),a=n.tokenizer,s=i(!0),l=i(!1).reverse(),u=a(l.concat(s),n),c=s.length?u.slice(Tt(u,s[0].token)):[],d=l.length?u.slice(0,Tt(u,l.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==c.length&&!(e=c[0]).isWord&&(t=i(!0)).length>0;)c=a(e.chars.concat(t),n);return c.shift()},previousStartToken:function(){for(var e,t;1==d.length&&!(e=d[0]).isWord&&(t=i(!1)).length>0;)d=a(t.reverse().concat(e.chars),n);return d.pop()},dispose:function(){r.dispose(),o.dispose(),c=d=null}}}function _(e,t,n,i,r){var o,a,s,l,u=0,c=e,d=Math.abs(n);if(0!==n){var f=0>n;switch(t){case V:for(a=D(e,f,null,i);(o=a.next())&&d>u;)++u,c=o;s=o,a.dispose();break;case K:for(var h=P(e,i,r),p=f?h.previousStartToken:h.nextEndToken;(l=p())&&d>u;)l.isWord&&(++u,c=f?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}f?(c=c.previousVisible(),u=-u):c&&c.isLeadingSpace&&(t==K&&(a=D(e,!1,null,i),s=a.next(),a.dispose()),s&&(c=s.previousVisible()))}return{position:c,unitsMoved:u}}function O(e,t,n,i){var r=e.getRangeBoundaryPosition(t,!0),o=e.getRangeBoundaryPosition(t,!1),a=i?o:r,s=i?r:o;return D(a,!!i,s,n)}function A(e,t,n){for(var i,r=[],o=O(e,t,n);i=o.next();)r.push(i);return o.dispose(),r}function k(t,n,i){var r=e.createRange(t.node);r.setStartAndEnd(t.node,t.offset,n.node,n.offset);var o=!r.expand("word",i);return r.detach(),o}function M(e,t,n,i,r){function o(e,t){var n=g[e].previousVisible(),i=g[t-1],o=!r.wholeWordsOnly||k(n,i,r.wordOptions);return{startPos:n,endPos:i,valid:o}}for(var a,s,l,u,c,d,f=Y(r.direction),h=D(e,f,e.session.getRangeBoundaryPosition(i,f),r),p="",g=[],m=null;a=h.next();)if(s=a.character,n||r.caseSensitive||(s=s.toLowerCase()),f?(g.unshift(a),p=s+p):(g.push(a),p+=s),n){if(c=t.exec(p))if(d){if(l=c.index,u=l+c[0].length,!f&&u<p.length||f&&l>0){m=o(l,u);break}}else d=!0}else if(-1!=(l=p.indexOf(t))){m=o(l,l+t.length);break}return d&&(m=o(l,u)),h.dispose(),m}function L(e){return function(){var t=!!xt,n=T(),i=[n].concat(j.toArray(arguments)),r=e.apply(this,i);return t||N(),r}}function F(e,t){return L(function(n,a,s,l){"undefined"==typeof s&&(s=a,a=V),l=i(l,st);var u=o(l.characterOptions),c=r(l.wordOptions),d=e;t&&(d=s>=0,this.collapse(!d));var f=_(n.getRangeBoundaryPosition(this,d),a,s,u,c),h=f.position;return this[d?"setStart":"setEnd"](h.node,h.offset),f.unitsMoved})}function B(e){return L(function(t,n){n=o(n);for(var i,r=O(t,this,n,!e),a=0;(i=r.next())&&z.test(i.character);)++a;r.dispose();var s=a>0;return s&&this[e?"moveStart":"moveEnd"]("character",e?a:-a,{characterOptions:n}),s})}function H(e){return L(function(t,n){var i=!1;return this.changeEachRange(function(t){i=t[e](n)||i}),i})}var V="character",K="word",U=e.dom,j=e.util,$=j.extend,W=U.getBody,q=/^[ \t\f\r\n]+$/,G=/^[ \t\f\r]+$/,z=/^[\t-\r   ᠎ -​\u2028\u2029  　]+$/,X=/^[\t   ᠎ -​  　]+$/,J="en",Y=e.Selection.isDirectionBackward,Z=!1,Q=!1,et=!1,tt=!0;!function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.contentEditable="true",t.innerHTML="<p>1 </p><p></p>";var n=W(document),i=t.firstChild,r=e.getSelection();n.appendChild(t),r.collapse(i.lastChild,2),r.setStart(i.firstChild,0),Z=1==(""+r).length,t.innerHTML="1 <br>",r.collapse(t,2),r.setStart(t.firstChild,0),Q=1==(""+r).length,t.innerHTML="1 <p>1</p>",r.collapse(t,2),r.setStart(t.firstChild,0),et=1==(""+r).length,n.removeChild(t),r.removeAllRanges()}();var nt,it={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},rt={includeBlockContentTrailingSpace:!tt,includeSpaceBeforeBr:!Q,includeSpaceBeforeBlock:!et,includePreLineTrailingSpace:!0},ot={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:n}},at={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},st={wordOptions:null,characterOptions:null},lt={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ut={wordOptions:null,characterOptions:null,direction:"forward"},ct=U.getComputedStyleProperty;!function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","table"),t=W(document);t.appendChild(e),nt="block"==ct(e,"display"),t.removeChild(e)}(),e.features.tableCssDisplayBlock=nt;var dt={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};b.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var ft=0,ht=0,pt={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new E(this,e))},toString:function(){return"[NodeWrapper("+U.inspectNode(this.node)+")]"}};R.prototype=pt;var gt="EMPTY",mt="NON_SPACE",vt="UNCOLLAPSIBLE_SPACE",yt="COLLAPSIBLE_SPACE",St="TRAILING_SPACE_BEFORE_BLOCK",wt="TRAILING_SPACE_IN_BLOCK",bt="TRAILING_SPACE_BEFORE_BR",Ct="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Rt="TRAILING_LINE_BREAK_AFTER_BR";$(pt,{isCharacterDataNode:C("isCharacterDataNode",U.isCharacterDataNode,"node"),getNodeIndex:C("nodeIndex",U.getNodeIndex,"node"),getLength:C("nodeLength",U.getNodeLength,"node"),containsPositions:C("containsPositions",d,"node"),isWhitespace:C("isWhitespace",v,"node"),isCollapsedWhitespace:C("isCollapsedWhitespace",y,"node"),getComputedDisplay:C("computedDisplay",s,"node"),isCollapsed:C("collapsed",S,"node"),isIgnored:C("ignored",w,"node"),next:C("nextPos",g,"node"),previous:C("previous",m,"node"),getTextNodeInfo:C("textNodeInfo",function(e){var t=null,n=!1,i=ct(e.parentNode,"whiteSpace"),r="pre-line"==i;return r?(t=G,n=!0):("normal"==i||"nowrap"==i)&&(t=q,n=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:r}},"node"),hasInnerText:C("hasInnerText",function(e,t){for(var n=this.session,i=n.getPosition(e.parentNode,this.getNodeIndex()+1),r=n.getPosition(e,0),o=t?i:r,a=t?r:i;o!==a;){if(o.prepopulateChar(),o.isDefinitelyNonEmpty())return!0;o=t?o.previousVisible():o.nextVisible()}return!1},"node"),isRenderedBlock:C("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),n=0,i=t.length;i>n;++n)if(!S(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:C("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!w(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:C("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var Et={character:"",characterType:gt,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,i="",r=gt,o=!1;if(n>0)if(3==t.nodeType){var a=t.data,s=a.charAt(n-1),l=e.nodeWrapper.getTextNodeInfo(),u=l.spaceRegex;l.collapseSpaces?u.test(s)?n>1&&u.test(a.charAt(n-2))||(l.preLine&&"\n"===a.charAt(n)?(i=" ",r=Ct):(i=" ",r=yt)):(i=s,r=mt,o=!0):(i=s,r=vt,o=!0)}else{var c=t.childNodes[n-1];if(c&&1==c.nodeType&&!S(c)&&("br"==c.tagName.toLowerCase()?(i="\n",e.isBr=!0,r=yt,o=!1):e.checkForTrailingSpace=!0),!i){var d=t.childNodes[n];d&&1==d.nodeType&&!S(d)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=i,e.characterType=r,e.isCharInvariant=o}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==mt||e==vt},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=yt),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=yt),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t,n=this;n=n.previousVisible();)if(t=n.getCharacter(e),""!==t)return n;return null},getCharacter:function(e){function t(){return l||(o=u.getPrecedingUncollapsedPosition(e),l=!0),o}if(this.resolveLeadingAndTrailingSpaces(),this.isCharInvariant)return this.character;var n=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace].join("_"),i=this.cache.get(n);if(null!==i)return i;var r,o,a="",s=this.characterType==yt,l=!1,u=this;return s?(" "!=this.character||t()&&!o.isTrailingSpace&&"\n"!=o.character)&&("\n"==this.character&&this.isLeadingSpace?t()&&"\n"!=o.character&&(a="\n"):(r=this.nextUncollapsed(),r&&(r.isBr?this.type=bt:r.isTrailingSpace&&"\n"==r.character?this.type=wt:r.isLeadingSpace&&"\n"==r.character&&(this.type=St),"\n"===r.character?(this.type!=bt||e.includeSpaceBeforeBr)&&(this.type!=St||e.includeSpaceBeforeBlock)&&(this.type==wt&&r.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=Ct||r.type!=mt||e.includePreLineTrailingSpace)&&("\n"===this.character?r.isTrailingSpace?this.isTrailingSpace||this.isBr&&(r.type=Rt,t()&&o.isLeadingSpace&&"\n"==o.character&&(r.character="")):a="\n":" "===this.character&&(a=" "))):a=this.character))):"\n"===this.character&&(!(r=this.nextUncollapsed())||r.isTrailingSpace),this.cache.set(n,a),a},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:x,toString:function(){return this.character}};E.prototype=Et,$(Et,{next:C("nextPos",function(e){var t=e.nodeWrapper,n=e.node,i=e.offset,r=t.session;if(!n)return null;var o,a,s;return i==t.getLength()?(o=n.parentNode,a=o?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(o=n,a=i+1):(s=n.childNodes[i],r.getNodeWrapper(s).containsPositions()?(o=s,a=0):(o=n,a=i+1)),o?r.getPosition(o,a):null}),previous:C("previous",function(e){var t,n,i,r=e.nodeWrapper,o=e.node,a=e.offset,s=r.session;return 0==a?(t=o.parentNode,n=t?r.getNodeIndex():0):r.isCharacterDataNode()?(t=o,n=a-1):(i=o.childNodes[a-1],s.getNodeWrapper(i).containsPositions()?(t=i,n=U.getNodeLength(i)):(t=o,n=a-1)),t?s.getPosition(t,n):null}),nextVisible:C("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,i=t.node,r=t;return n.isCollapsed()&&(r=n.session.getPosition(i.parentNode,n.getNodeIndex()+1)),r}),nextUncollapsed:C("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:C("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,i=t.node,r=t;return n.isCollapsed()&&(r=n.session.getPosition(i.parentNode,n.getNodeIndex())),r})});var xt=null,It=function(){function e(e){var t=new b;return{get:function(n){var i=t.get(n[e]);if(i)for(var r,o=0;r=i[o++];)if(r.node===n)return r;return null},set:function(n){var i=n.node[e],r=t.get(i)||t.set(i,[]);r.push(n)}}}function t(){this.initCaches()}var n=j.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=n?function(){var e=new b;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new R(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();$(U,{nextNode:g,previousNode:m});var Tt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,i=e.length;i>n;++n)if(e[n]===t)return n;return-1};$(e.rangePrototype,{moveStart:F(!0,!1),moveEnd:F(!1,!1),move:F(!0,!0),trimStart:B(!0),trimEnd:B(!1),trim:L(function(e,t){var n=this.trimStart(t),i=this.trimEnd(t);return n||i}),expand:L(function(e,t,n){var a=!1;n=i(n,lt);var s=o(n.characterOptions);if(t||(t=V),t==K){var l,u,c=r(n.wordOptions),d=e.getRangeBoundaryPosition(this,!0),f=e.getRangeBoundaryPosition(this,!1),h=P(d,s,c),p=h.nextEndToken(),g=p.chars[0].previousVisible();if(this.collapsed)l=p;else{var m=P(f,s,c);l=m.previousStartToken()}return u=l.chars[l.chars.length-1],g.equals(d)||(this.setStart(g.node,g.offset),a=!0),u&&!u.equals(f)&&(this.setEnd(u.node,u.offset),a=!0),n.trim&&(n.trimStart&&(a=this.trimStart(s)||a),n.trimEnd&&(a=this.trimEnd(s)||a)),a}return this.moveEnd(V,1,n)}),text:L(function(e,t){return this.collapsed?"":A(e,this,o(t)).join("")}),selectCharacters:L(function(e,t,n,i,r){var o={characterOptions:r};t||(t=W(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,o),this.collapse(!0),this.moveEnd("character",i-n,o)}),toCharacterRange:L(function(e,t,n){t||(t=W(this.getDocument()));var i,r,o=t.parentNode,a=U.getNodeIndex(t),s=-1==U.comparePoints(this.startContainer,this.endContainer,o,a),l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,o,a),i=-l.text(n).length):(l.setStartAndEnd(o,a,this.startContainer,this.startOffset),i=l.text(n).length),r=i+this.text(n).length,{start:i,end:r}}),findText:L(function(t,n,o){o=i(o,at),o.wholeWordsOnly&&(o.wordOptions=r(o.wordOptions),o.wordOptions.includeTrailingSpace=!1);var a=Y(o.direction),s=o.withinRange;s||(s=e.createRange(),s.selectNodeContents(this.getDocument()));var l=n,u=!1;"string"==typeof l?o.caseSensitive||(l=l.toLowerCase()):u=!0;var c=t.getRangeBoundaryPosition(this,!a),d=s.comparePoint(c.node,c.offset);-1===d?c=t.getRangeBoundaryPosition(s,!0):1===d&&(c=t.getRangeBoundaryPosition(s,!1));for(var f,h=c,p=!1;;)if(f=M(h,l,u,s,o)){if(f.valid)return this.setStartAndEnd(f.startPos.node,f.startPos.offset,f.endPos.node,f.endPos.offset),!0;h=a?f.startPos:f.endPos}else{if(!o.wrap||p)return!1;s=s.cloneRange(),h=t.getRangeBoundaryPosition(s,!a),s.setBoundary(c.node,c.offset,a),p=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),$(e.selectionPrototype,{expand:L(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:L(function(e,t,n,i){var r=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var o=this.getRangeAt(0);i||(i={}),i.characterOptions=a(i.characterOptions),r=o.move(t,n,i),this.setSingleRange(o)}return r}),trimStart:H("trimStart"),trimEnd:H("trimEnd"),trim:H("trim"),selectCharacters:L(function(t,n,i,r,o,a){var s=e.createRange(n);s.selectCharacters(n,i,r,a),this.setSingleRange(s,o)}),saveCharacterRanges:L(function(e,t,n){for(var i=this.getAllRanges(),r=i.length,o=[],a=1==r&&this.isBackward(),s=0,l=i.length;l>s;++s)o[s]={characterRange:i[s].toCharacterRange(t,n),backward:a,characterOptions:n};return o}),restoreCharacterRanges:L(function(t,n,i){this.removeAllRanges();for(var r,o,a,s=0,l=i.length;l>s;++s)o=i[s],a=o.characterRange,r=e.createRange(n),r.selectCharacters(n,a.start,a.end,o.characterOptions),this.addRange(r,o.backward)}),text:L(function(e,t){for(var n=[],i=0,r=this.rangeCount;r>i;++i)n[i]=this.getRangeAt(i).text(t);return n.join("")})}),e.innerText=function(t,n){var i=e.createRange(t);i.selectNodeContents(t);var r=i.text(n);return i.detach(),r},e.createWordIterator=function(e,t,n){var a=T();n=i(n,ut);var s=o(n.characterOptions),l=r(n.wordOptions),u=a.getPosition(e,t),c=P(u,s,l),d=Y(n.direction);return{next:function(){return d?c.previousStartToken():c.nextEndToken()},dispose:function(){c.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=T();e(t),N()},e.noMutation.createEntryPointFunction=L,e.textRange={isBlockNode:c,isCollapsedWhitespaceNode:y,createPosition:L(function(e,t,n){return e.getPosition(t,n)})}}),define("rangy-textrange",["rangy-core"],function(e){return function(){var t;return t||e.rangy.modules.TextRange}}(this)),rangy.createModule("Position",["WrappedSelection"],function(e,t){function n(e){var t=0,n=0;if(typeof e.pageXOffset==b&&typeof e.pageYOffset==b)t=e.pageXOffset,n=e.pageYOffset;else{var i=e.document,r=i.documentElement,o=i.compatMode,a="string"==typeof o&&o.indexOf("CSS")>=0&&r?r:x.getBody(i);if(a&&typeof a.scrollLeft==b&&typeof a.scrollTop==b)try{t=a.scrollLeft,n=a.scrollTop}catch(s){}}return{x:t,y:n}}function i(e,t){for(t=t.toLowerCase();e;){if(1==e.nodeType&&e.tagName.toLowerCase()==t)return e;e=e.parentNode}return null}function r(e,t,n,i){this.top=e,this.right=t,this.bottom=n,this.left=i,this.width=t-i,this.height=n-e}function o(e,t,n){return new r(e.top+n,e.right+t,e.bottom+n,e.left+t)}function a(e,t){var n=0,i=0,r=t.documentElement,a=x.getBody(t),s=0===r.clientWidth&&typeof a.clientTop==b?a:r,l=s.clientLeft,u=s.clientTop;return l&&(n=-l),u&&(i=-u),o(e,n,i)}function s(e){for(var t,n=[],i=[],o=[],a=[],s=0,l=e.length;l>s;++s)t=e[s],t&&(n.push(t.top),i.push(t.bottom),o.push(t.left),a.push(t.right));return new r(Math.min.apply(Math,n),Math.max.apply(Math,a),Math.max.apply(Math,i),Math.min.apply(Math,o))}function l(t,n,i){var r=x.getBody(t).createTextRange();r.moveToPoint(n,i);var o=new e.WrappedTextRange(r);return new T(o.startContainer,o.startOffset)}function u(e,t,n){var i=e.caretPositionFromPoint(t,n);return new T(i.offsetNode,i.offset)}function c(e,t,n){var i=e.caretRangeFromPoint(t,n);return new T(i.startContainer,i.startOffset)}function d(e){var t=(e.nativeRange||e).getClientRects();return t.length>0?t[t.length-1]:null}function f(e,t,n){return console.log("pointIsInOrAboveRect",e,t,Math.floor(n.top),Math.floor(n.right),Math.floor(n.bottom),Math.floor(n.left)),t<n.bottom&&e>=n.left&&e<=n.right}function h(t,n,i,r){var o=t.elementFromPoint(n,i);console.log("elementFromPoint is ",o);var a=e.createRange(t);a.selectNodeContents(o),a.collapse(!0);var s,l,u,c=o.firstChild;if(c){e:for(;c;){if(console.log(c),3==c.nodeType){for(s=0,u=c.length;u>=s;++s)if(a.setEnd(c,s),l=d(a),l&&f(n,i,l)){l.right-n>n-l.left&&--s;break e}}else if(a.setEndAfter(c),l=d(a),l&&f(n,i,l)){s=x.getNodeIndex(c),c=o.parentNode,r||++s;break}c=c.nextSibling}c||(c=o,s=o.childNodes.length)}else c=o.parentNode,s=x.getNodeIndex(o),r||++s;return new T(c,s)}function p(n){if(e.features.implementsTextRange)return l;if(typeof n.caretPositionFromPoint!=C)return u;if(typeof n.caretRangeFromPoint!=C)return c;if(typeof n.elementFromPoint!=C&&P)return h;throw t.createError("createCaretPositionFromPointGetter(): Browser does not provide a recognised method to create a selection from pixel coordinates")}function g(n,i,r,o,a){a=x.getContentDocument(a,t,"createRangeFromPoints");var s=p(a),l=s(a,n,i,!1),u=s(a,r,o,!0);console.log(l.node,l.offset,u.node,u.offset);var c=e.createRange(a);return c.setStartAndEnd(l.node,l.offset,u.node,u.offset),c}function m(e,t,n,i,r){var o,a,s,l,u=t>i||t==i&&e>n;u?(o=n,a=i,s=e,l=t):(o=e,a=t,s=n,l=i);var c=rangy.getSelection(r),d=g(o,a,s,l,r);return c.setSingleRange(d),c}function v(e){return function(){var t=this["get"+(e?"Start":"End")+"ClientPos"](),i=n(x.getWindow(this.startContainer));return{x:t.x+i.x,y:t.y+i.y}}}function y(e,t){return e.compareBoundaryPoints(t.START_TO_START,t)}function S(e){return function(){for(var t="getBounding"+(e?"Document":"Client")+"Rect",n=[],i=0;i<this.rangeCount;++i)n.push(this.getRangeAt(i)[t]());return s(n)}}function w(e,t){return function(){if(0==this.rangeCount)return null;var n=t?"Document":"Client",i=this.getAllRanges();return i.length>1&&i.sort(y),e?i[0]["getStart"+n+"Pos"]():i[i.length-1]["getEnd"+n+"Pos"]()}}var b="number",C="undefined",R=e.WrappedRange,E=e.WrappedTextRange,x=e.dom,I=e.util,T=x.DomPosition,N=document.createElementNS("http://www.w3.org/1999/xhtml","span"),D=I.isHostMethod(N,"getBoundingClientRect");N=null;var P=!1,_=!1;if(e.features.implementsDomRange){var O=e.createNativeRange();P=I.isHostMethod(O,"getClientRects"),_=I.isHostMethod(O,"getBoundingClientRect"),O.detach()}I.extend(e.features,{rangeSupportsGetBoundingClientRect:_,rangeSupportsGetClientRects:P,elementSupportsGetBoundingClientRect:D});var A=function(e){return function(){var t=this.cloneRange();t.collapse(e);var n=t.getBoundingClientRect();return{x:n[e?"left":"right"],y:n[e?"top":"bottom"]}}},k=e.rangePrototype;if(e.features.implementsTextRange&&D)k.getBoundingClientRect=function(){var e,t=E.rangeToTextRange(this),n=this.getNodes([1],function(e){return/^t[dh]$/i.test(e.tagName)}),r=[];if(n.length>0){for(var o,l,u,c,d=i(this.startContainer,"table"),f=0;o=n[f];++f)u=i(o,"table"),d&&u==d||(c=this.cloneRange(),d&&c.setStartAfter(d),c.setEndBefore(u),r.push(E.rangeToTextRange(c).getBoundingClientRect())),this.containsNode(o)?r.push(o.getBoundingClientRect()):(l=t.duplicate(),l.moveToElementText(o),-1==l.compareEndPoints("StartToStart",t)?l.setEndPoint("StartToStart",t):1==l.compareEndPoints("EndToEnd",t)&&l.setEndPoint("EndToEnd",t),r.push(l.getBoundingClientRect())),d=u;var h=i(this.endContainer,"table");!h&&d&&(c=this.cloneRange(),c.setStartAfter(d),r.push(E.rangeToTextRange(c).getBoundingClientRect())),e=s(r)}else e=t.getBoundingClientRect();return a(e,x.getDocument(this.startContainer))};else if(e.features.implementsDomRange){var M=function(e){return e instanceof R?e:new R(e)};if(_){if(k.getBoundingClientRect=function(){var e=M(this).nativeRange,t=e.getBoundingClientRect()||e.getClientRects()[0];return a(t,x.getDocument(this.startContainer))},P){A=function(e){return function(){var n,i=M(this).nativeRange,r=i.getClientRects();if(0==r.length&&D&&(console.log(i,i.getClientRects(),i.getBoundingClientRect()),this.collapsed&&1==this.startContainer.nodeType&&this.startOffset<this.startContainer.childNodes.length)){var o=this.startContainer.childNodes[this.startOffset];o.getClientRects&&console.log(o,o.getClientRects(),this.startContainer.getClientRects())}if(r.length>0)return e?(n=r[0],{x:n.left,y:n.top}):(n=r[r.length-1],{x:n.right,y:n.bottom});throw t.createError("Cannot get position for range "+this.inspect())}}}}else{var L=D?function(e){return a(e.getBoundingClientRect(),x.getDocument(e))}:function(e){for(var t=0,n=0,i=e,o=e.offsetWidth,s=e.offsetHeight;i;)t+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;return a(new r(n,t+o,n+s,t),x.getDocument(e))},F=function(e){var t;e.splitBoundaries();var n=document.createElementNS("http://www.w3.org/1999/xhtml","span");if(e.collapsed)e.insertNode(n),t=L(n),n.parentNode.removeChild(n);else{var i=e.cloneRange();i.collapse(!0),i.insertNode(n);var r=L(n);n.parentNode.removeChild(n),i.collapseToPoint(e.endContainer,e.endOffset),i.insertNode(n);var o=L(n);n.parentNode.removeChild(n);for(var a=[r,o],l=e.getNodes([1],function(t){return e.containsNode(t)}),u=0,c=l.length;c>u;++u)a.push(L(l[u]));t=s(a)}return e.normalizeBoundaries(),t};k.getBoundingClientRect=function(e){return F(M(e))}}}I.extend(k,{getBoundingDocumentRect:function(){var e=n(x.getWindow(this.startContainer));return o(this.getBoundingClientRect(),e.x,e.y)},getStartClientPos:A(!0),getEndClientPos:A(!1),getStartDocumentPos:v(!0),getEndDocumentPos:v(!1)}),I.extend(e.selectionPrototype,{getBoundingClientRect:S(!1),getBoundingDocumentRect:S(!0),getStartClientPos:w(!0,!1),getEndClientPos:w(!1,!1),getStartDocumentPos:w(!0,!0),getEndDocumentPos:w(!1,!0)}),e.positionFromPoint=function(e,n,i){return i=x.getContentDocument(i,t,"positionFromPoint"),p(i)(i,e,n)},e.createRangeFromPoints=g,e.moveSelectionToPoints=m}),define("rangy-position",["rangy-core"],function(e){return function(){var t;return t||e.rangy.modules.Position}}(this)),define("rangy",["rangy-core","rangy-highlighter","rangy-cssclassapplier","rangy-textrange","rangy-position"],function(e){return e}),ReadiumSDK.Views.MediaOverlayElementHighlighter=function(e){function t(e,t,i){if(h)try{if(h[0].ownerDocument===e[0].ownerDocument)return}catch(r){}$head=$("head",e[0].ownerDocument.documentElement),h=$("<style type='text/css'> </style>"),h.append("."+n+" {");var o="background-color: yellow !important; color: black !important; border-radius: 0.4em;",a=i;if(a){var s=!1;for(var l in a.declarations)a.declarations.hasOwnProperty(l)&&(s=!0,h.append(l+": "+a.declarations[l]+"; "));s||t||h.append(o)}else t||h.append(o);h.append("}"),h.appendTo($head)}this.includeParWhenAdjustingToSeqSyncGranularity=!0;var n="mo-active-default",i="mo-sub-sync",r=void 0;this.isElementHighlighted=function(e){return r&&e===r};var o=void 0;this.isCfiHighlighted=function(e){return o&&e===o};var a="",s="",l=e,u=!0&&"undefined"!=typeof rangy,c=void 0,d=void 0,f="MO_SPEAK",h=void 0;this.reDo=function(){h&&h.remove(),h=void 0;var e=r,t=o,n=a,i=s;r?(this.reset(),this.highlightElement(e,n,i)):o&&(this.reset(),this.highlightCfi(t,n,i))},this.highlightElement=function(e,u,c){if(e&&e!==r){this.reset(),r=e,o=void 0,a=u,s=c;var d=this.adjustParToSeqSyncGranularity(r),f=d.element;s&&""!==s&&$(f.ownerDocument.documentElement).addClass(s);var h=$(f),p=a&&""!==a,g=l.userStyles().findStyle("."+n);t(h,p,g),g||!p?(p&&h.addClass(a),h.addClass(n)):h.addClass(a),(this.includeParWhenAdjustingToSeqSyncGranularity||r!==d)&&$(r.element).addClass(i)}},this.highlightCfi=function(e,i,h){if(e&&e!==o){this.reset(),r=void 0,o=e,a=i,s=h;var p=$(o.cfi.cfiTextParent),g=a&&""!==a,m=l.userStyles().findStyle("."+n);t(p,g,m);var v=m||!g?(g?a+" ":"")+n:a;if(u){var y=o.cfi.cfiTextParent.ownerDocument;d=rangy.createRange(y);var S="epubcfi("+o.cfi.partialStartCfi+")",w=EPUBcfi.getTextTerminusInfoWithPartialCFI(S,y,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),b="epubcfi("+o.cfi.partialEndCfi+")",C=EPUBcfi.getTextTerminusInfoWithPartialCFI(b,y,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);d.setStartAndEnd(w.textNode[0],w.textOffset,C.textNode[0],C.textOffset);d.MO_createCssClassApplier=!0,c&&c.cssClass===v||(c=rangy.createCssClassApplier(v,{elementTagName:"span",elementProperties:{className:"mo-cfi-highlight"},ignoreWhiteSpace:!0,applyToEditableOnly:!1,normalize:!0},["span"])),c.applyToRange(d)}else try{var R=e.getSmil().spineItemId;l.addHighlight(R,e.cfi.partialRangeCfi,f,"highlight",void 0)}catch(E){console.error(E)}}},this.reset=function(){if(o){var e=o.cfi.cfiTextParent.ownerDocument;if(u){if(c&&d.MO_createCssClassApplier)c.undoToRange(d);else for(var t=void 0;null!==(t=e.getElementById(f));){var h=t.textContent,p=e.createTextNode(h);t.parentNode.replaceChild(p,t),p.parentNode.normalize()}d=void 0}else try{l.removeHighlight(f);for(var t=void 0;null!==(t=e.getElementById("start-"+f));)console.log("toRemove START"),console.log(t),t.parentNode.removeChild(t);for(;null!==(t=e.getElementById("end-"+f));)console.log("toRemove END"),console.log(t),t.parentNode.removeChild(t)}catch(g){console.error(g)}o=void 0}if(r){var m=this.adjustParToSeqSyncGranularity(r),v=m.element;(this.includeParWhenAdjustingToSeqSyncGranularity||r!==m)&&$(r.element).removeClass(i),s&&""!==s&&$(v.ownerDocument.documentElement).removeClass(s),a&&""!==a&&$(v).removeClass(a),$(v).removeClass(n),r=void 0
}a="",s=""},this.adjustParToSeqSyncGranularity=function(e){if(!e)return void 0;var t=l.viewerSettings().mediaOverlaysSynchronizationGranularity;if(t&&t.length>0){var n=e.element||(e.cfi?e.cfi.cfiTextParent:void 0);if(!n)return console.error("adjustParToSeqSyncGranularity !element ???"),e;var i=e.getFirstSeqAncestorWithEpubType(t,this.includeParWhenAdjustingToSeqSyncGranularity);if(i&&i.element)return i}return e}},define("mediaOverlayElementHighlighter",["readiumSDK","rangy"],function(e){return function(){var t;return t||e.mediaOverlayElementHighlighter}}(this)),ReadiumSDK.Views.MediaOverlayPlayer=function(e,t){function n(e){var t=e.getSmil();return f&&f.smil==t?f.reset():f=new ReadiumSDK.Models.SmilIterator(t),f.goToPar(e),f.currentPar?void r():void console.error("playPar !_smilIterator.currentPar")}function i(){R.resetBlankPage(),N=setTimeout(function(){if(N){if(R.resetBlankPage(),!f||!f.currentPar)return void R.reset();P=0,a(f.currentPar.audio.clipEnd+.1,2)}},2e3),t({isPlaying:!0})}function r(){if(F=!1,!f||!f.currentPar)return void console.error("playCurrentPar !_smilIterator || !_smilIterator.currentPar ???");if(!f.smil.id)return h.reset(),R.resetTTS(),R.resetEmbedded(),void setTimeout(function(){i()},100);if(f.currentPar.audio.src){R.resetTTS(),R.resetEmbedded(),R.resetBlankPage();var e=f.currentPar.audio.clipEnd-f.currentPar.audio.clipBegin;(0>=e||T>e)&&(console.error("### MO XXX PAR OFFSET: "+T+" / "+e),T=0);var n=ReadiumSDK.Helpers.ResolveContentRef(f.currentPar.audio.src,f.smil.href),r=b.resolveRelativeUrlMO(n),o=f.currentPar.audio.clipBegin+T;h.playFile(f.currentPar.audio.src,r,o)}else{T=0,h.reset();var a=f.currentPar.element;if(a){P=0;var s=a.nodeName?a.nodeName.toLowerCase():void 0;"audio"===s||"video"===s?(R.resetTTS(),R.resetBlankPage(),w&&R.resetEmbedded(),w=a,w.pause(),w.currentTime=0,w.play(),$(w).on("ended",R.onEmbeddedEnd),S=!0,setTimeout(function(){t({isPlaying:!0})},80)):(R.resetEmbedded(),R.resetBlankPage(),g=a.textContent,g&&""!=g?k(g):g=void 0)}var l=f.currentPar.cfi;if(l){P=0,R.resetEmbedded(),R.resetBlankPage(),E.reset();var u=l.cfiTextParent.ownerDocument,c="epubcfi("+l.partialStartCfi+")",p=EPUBcfi.getTextTerminusInfoWithPartialCFI(c,u,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),m="epubcfi("+l.partialEndCfi+")",v=EPUBcfi.getTextTerminusInfoWithPartialCFI(m,u,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);if(rangy){var y=rangy.createRange(u);y.setStartAndEnd(p.textNode[0],p.textOffset,v.textNode[0],v.textOffset),g=y.toString()}else g=void 0;g&&""!=g?k(g):g=void 0}}T=0,d()}function o(t){R.pause();var n=t?b.media_overlay.getNextSmil(f.smil):b.media_overlay.getPreviousSmil(f.smil);if(n){if(f=new ReadiumSDK.Models.SmilIterator(n),f.currentPar){if(!t)for(;!f.isLast();)f.next();e.openContentUrl(f.currentPar.text.src,f.smil.href,R)}}else console.log("No more SMIL"),R.reset()}function a(e,t){if(P=e,D=!1,f&&f.currentPar){var n=f.currentPar,i=f.currentPar.audio;if(!(e>_&&e<=i.clipEnd)){D=!0;var s=h.isPlaying();s&&6===t&&console.debug("from userNav _audioPlayer.isPlaying() ???");var l=e>i.clipEnd,u=!H&&6!==t&&l,c=f&&f.smil&&f.smil.spineItemId?f.smil.spineItemId:I&&I.spineItem&&I.spineItem.idref?I.spineItem.idref:void 0;if(u&&c&&I&&I.paginationInfo&&I.paginationInfo.openPages&&I.paginationInfo.openPages.length>1){var p=0,g=I.paginationInfo.openPages[p];c===g.idref&&(u=!1)}if(l?f.next():f.previous(),!f.currentPar)return void(u?(B=!0,R.reset()):o(l));if(!f.currentPar.audio)return void R.pause();if(C.mediaOverlaysSkipSkippables){for(var m=!1,v=f.currentPar;v;){if(v.isSkippable&&v.isSkippable(C.mediaOverlaysSkippables)){m=!0;break}v=v.parent}if(m){console.log("MO SKIP: "+v.epubtype),R.pause();var y=l?f.currentPar.audio.clipEnd+.1:_-1;return void a(y,t,!0)}}if(!s&&(f.currentPar.element||f.currentPar.cfi&&f.currentPar.cfi.cfiTextParent)){var S=E.adjustParToSeqSyncGranularity(f.currentPar);if(S&&S!==f.currentPar){var w=E.adjustParToSeqSyncGranularity(n);if(w&&(w===S||!l)){if(w===S){do l?f.next():f.previous();while(f.currentPar&&f.currentPar.hasAncestor(w));if(!f.currentPar)return void(u?(B=!0,R.reset()):o(l))}if(!l){var b=E.adjustParToSeqSyncGranularity(f.currentPar);if(b&&b!==f.currentPar){var x=f.currentPar,T=void 0;do T=f.currentPar,f.previous();while(f.currentPar&&f.currentPar.hasAncestor(b));f.currentPar?(f.next(),f.currentPar.hasAncestor(b)||console.error("adjustParToSeqSyncGranularity !_smilIterator.currentPar.hasAncestor(landed) ???")):(f.reset(),f.currentPar!==T&&console.error("adjustParToSeqSyncGranularity _smilIterator.currentPar !=== innerPar???")),f.currentPar||(console.error("adjustParToSeqSyncGranularity !_smilIterator.currentPar ?????"),f.goToPar(x))}}}}}return h.isPlaying()&&f.currentPar.audio.src&&f.currentPar.audio.src==h.currentSmilSrc()&&e>=f.currentPar.audio.clipBegin&&e<=f.currentPar.audio.clipEnd?void d():void r()}}}function s(e){if(!A||A[0].ownerDocument!==e[0].ownerDocument){var t=".tts_on{background-color:red;color:white;} .tts_off{}";$head=$("head",e[0].ownerDocument.documentElement),A=$("<style type='text/css'> </style>").appendTo($head),A.append(t)}}function l(){u();var e=function(){if(f&&f.currentPar){var e=f.smil;if(e.mo){var n=P-f.currentPar.audio.clipBegin;if(!(0>=n)){for(var i=e.mo.smil_models.indexOf(e),r=new ReadiumSDK.Models.SmilIterator(e),o=-1;r.currentPar&&(o++,r.currentPar!=f.currentPar);)r.next();t({playPosition:n,smilIndex:i,parIndex:o})}}}};setTimeout(e,500),L=setInterval(e,1500)}function u(){P=0,void 0!==L&&clearInterval(L),L=void 0}function c(){return u(),D?void(D=!1):f&&f.currentPar?void a(f.currentPar.audio.clipEnd+.1,5):void R.reset()}function d(){if(f&&f.currentPar){if(f.currentPar.text.srcFragmentId&&f.currentPar.text.srcFragmentId.length>0){if(f.currentPar.element)return void(E.isElementHighlighted(f.currentPar)||(E.highlightElement(f.currentPar,b.media_overlay.activeClass,b.media_overlay.playbackActiveClass),F||e.insureElementVisibility(f.currentPar.getSmil().spineItemId,f.currentPar.element,R)));if(f.currentPar.cfi)return void(E.isCfiHighlighted(f.currentPar)||(E.highlightCfi(f.currentPar,b.media_overlay.activeClass,b.media_overlay.playbackActiveClass),F||e.insureElementVisibility(f.currentPar.getSmil().spineItemId,f.currentPar.cfi.cfiTextParent,R)))}if(!f.currentPar.element){var t=f.currentPar.text.src,n=f.smil.href;f=void 0,e.openContentUrl(t,n,R)}}}var f=void 0,h=new ReadiumSDK.Views.AudioPlayer(t,a,c,l,u),p=!1,g=void 0,m=!0&&"undefined"!=typeof window.speechSynthesis&&null!=speechSynthesis,v=void 0,y=!1,S=!1,w=void 0;this.isPlaying=function(){return h.isPlaying()||p||S||N};var b=e.package(),C=e.viewerSettings(),R=this,E=new ReadiumSDK.Views.MediaOverlayElementHighlighter(e);e.on(ReadiumSDK.Events.READER_VIEW_DESTROYED,function(){R.reset()}),this.applyStyles=function(){E.reDo()},this.onSettingsApplied=function(){h.setRate(C.mediaOverlaysRate),h.setVolume(C.mediaOverlaysVolume/100)},R.onSettingsApplied(),e.on(ReadiumSDK.Events.SETTINGS_APPLIED,this.onSettingsApplied,this);var x=!1;this.onDocLoadStart=function(){var e=R.isPlaying();e&&(x=!0,R.pause())};var I=void 0;this.onPageChanged=function(t){I=t;var i=B;B=!1;var o=x;if(x=!1,!t)return void R.reset();var a=void 0,s="/99!",l="epubcfi";if(t.elementId||t.initiator==R){for(var u=e.getLoadedSpineItems(),c=e.spine().isRightToLeft(),h=c?u.length-1:0;c&&h>=0||!c&&h<u.length;h+=c?-1:1){var p=u[h];if(!t.spineItem||t.spineItem==p){if(t.elementId&&0===t.elementId.indexOf(l)){E.reset();var g=t.elementId.substr(l.length+1,t.elementId.length-l.length-2);0===g.indexOf(s)&&(g=g.substr(s.length,g.length-s.length));var m=g.split(",");if(m&&3===m.length)try{var v=m[0]+m[1],y=e.getElementByCfi(p,v,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);if(a=y&&y.length>0?y[0]:void 0){a.nodeType===Node.TEXT_NODE&&(a=a.parentNode);break}}catch(S){console.error(S)}else try{var y=e.getElementByCfi(p,g,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);if(a=y&&y.length>0?y[0]:void 0){a.nodeType===Node.TEXT_NODE&&(a=a.parentNode);break}}catch(S){console.error(S)}}if(!a){if(t.initiator!=R||t.elementId){var y=e.getElementById(p,t.elementId);a=y&&y.length>0?y[0]:void 0}else{var y=e.getElement(p,"body");a=y&&y.length>0?y[0]:void 0}if(a)break}}}a||console.error("paginationData.elementId BUT !element: "+t.elementId)}var w=R.isPlaying()||o;if(!f||!f.currentPar){if(t.initiator!==R)return T=0,R.reset(),void(t.elementId&&a?(w||i)&&(t.elementIdResolved=a,R.toggleMediaOverlayRefresh(t)):(w||i)&&R.toggleMediaOverlay());if(!a)return console.error("!element: "+t.elementId),void(T=0);var b=$(a).data("mediaOverlayData");if(!b)return console.error("!moData: "+t.elementId),void(T=0);var C=b.par?b.par:b.pars[0];if(b.pars)for(var N=0;N<b.pars.length;N++){var D=b.pars[N];if(t.elementId===D.cfi.smilTextSrcCfi){C=D;break}}return void n(C)}var P=!f.currentPar.element&&!f.currentPar.cfi;if(P&&console.error("!! _smilIterator.currentPar.element ??"),t.initiator==R){var _=t.elementId&&t.elementId!==f.currentPar.text.srcFragmentId;if(_&&console.error("!! paginationData.elementId !== _smilIterator.currentPar.text.srcFragmentId"),_||P)return void(T=0);w?d():r()}else{if(!w&&!i)return void R.reset();if(!t.elementId,t.elementId&&!a)return;t.elementId&&(t.elementIdResolved=a),R.toggleMediaOverlayRefresh(t)}};var T=0,N=void 0,D=!1,P=0,_=-999;this.touchInit=function(){var e=h.touchInit();e&&m&&k("o",0)};var O=function(e){var t=["p","div","pagenum","td","table","li","ul","ol"],n=[",",";",".","-","??","??","?","!"],i=function(e,t){if(!(e.word.length<=0)){var n=e.text.length;t.spanMap[n]=e.counter,e.text+=e.word,e.markup+=e.html.substring(0,e.wordStart)+'<span class="tts_off" id="tts_'+e.counter+'">'+e.html.substring(e.wordStart,e.wordEnd)+"</span>"+e.html.substring(e.wordEnd,e.html.length),e.word="",e.html="",e.wordStart=-1,e.wordEnd=-1,e.counter++}},r={element:e,innerHTML_tts:"",spanMap:{},text:"",lastCharIndex:void 0};r.element.innerHTML_original=e.innerHTML;for(var o={inTag:!1,counter:0,wordStart:-1,wordEnd:-1,text:"",markup:"",word:"",html:""},a=r.element.innerHTML_original.length,s=0;a>=s;){if(o.inTag){if(o.html+=r.element.innerHTML_original[s],">"==r.element.innerHTML_original[s]){o.inTag=!1;var l=o.html.match(/<\/(.*?)>$/);l&&t.indexOf(l[1])>-1&&(i(o,r),o.text+=" ")}}else s==a||r.element.innerHTML_original[s].match(/\s/)?(i(o,r),a>s&&(o.text+=r.element.innerHTML_original[s],o.markup+=r.element.innerHTML_original[s])):n.indexOf(r.element.innerHTML_original[s])>-1?(i(o,r),o.wordStart=o.html.length,o.wordEnd=o.html.length+1,o.word+=r.element.innerHTML_original[s],o.html+=r.element.innerHTML_original[s],i(o,r)):"<"==r.element.innerHTML_original[s]?(o.inTag=!0,o.html+=r.element.innerHTML_original[s]):(0==o.word.length&&(o.wordStart=o.html.length),o.wordEnd=o.html.length+1,o.word+=r.element.innerHTML_original[s],o.html+=r.element.innerHTML_original[s]);s++}return r.text=o.text,r.innerHTML_tts=o.markup,r.element.innerHTML=r.innerHTML_tts,r},A=void 0,k=function(n,i){function r(e){e||window.speechSynthesis.pending?(console.debug("TTS cancel before speak"),window.speechSynthesis.cancel(),setTimeout(function(){r(!1)},5)):o()}function o(){v=new SpeechSynthesisUtterance,y&&a&&(v.tokenData=a,v.onboundary=function(e){if(v){console.debug("TTS boundary: "+e.name+" / "+e.charIndex);var t=e.target.tokenData;if(t&&t.spanMap.hasOwnProperty(e.charIndex)){var n;[].forEach.call(t.element.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF "+e.id),e.className="tts_off"});var n="tts_"+t.spanMap[e.charIndex];console.debug("TTS charIndex ID: "+n);var i=t.element.querySelector("#"+n);i&&(console.debug("TTS ON"),i.className="tts_on"),t.lastCharIndex=e.charIndex}}}),v.onend=function(e){if(v)if(console.debug("TTS ended"),y){var t=e.target.tokenData,n=!e.forceSkipEnd&&v===e.target&&(!t||t.element.innerHTML_original);t&&(t.element.innerHTML_original?t.element.innerHTML=t.element.innerHTML_original:[].forEach.call(t.element.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF (end)"+e.id),e.className="tts_off"}),t.element.innerHTML_original=void 0),n?R.onTTSEnd():console.debug("TTS end SKIPPED")}else R.onTTSEnd()},v.onerror=function(e){if(v&&(console.error("TTS error"),console.debug(v.text),console.debug(window.speechSynthesis.paused),console.debug(window.speechSynthesis.pending),console.debug(window.speechSynthesis.speaking),y)){var t=e.target.tokenData;t&&(t.element.innerHTML_original?t.element.innerHTML=t.element.innerHTML_original:[].forEach.call(t.element.ownerDocument.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF (error)"+e.id),e.className="tts_off"}),t.element.innerHTML_original=void 0)}};var e=i||h.getVolume();v.volume=e,v.rate=h.getRate(),v.pitch=1,v.text=d,window.speechSynthesis.speak(v),window.speechSynthesis.paused&&(console.debug("TTS resume"),window.speechSynthesis.resume())}{var a=void 0,l=f&&f.currentPar?f.currentPar:void 0,u=l?l.element:void 0;l?l.cfi:void 0}if((!i||i>0)&&(setTimeout(function(){t({isPlaying:!0})},80),p=!0,y&&u)){var c=$(u);s(c),u.innerHTML_original&&(u.innerHTML=u.innerHTML_original,u.innerHTML_original=void 0),a=O(u)}if(!m)return void e.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_TTS_SPEAK,{tts:n});if(!n&&window.speechSynthesis.paused)return void window.speechSynthesis.resume();var d=n||g;d&&(v&&(y&&(v.onend&&v.onend({forceSkipEnd:!0,target:v}),v.tokenData=void 0,v.onboundary=void 0),v.onend=void 0,v.onerror=void 0,v=void 0),console.debug("paused: "+window.speechSynthesis.paused),console.debug("speaking: "+window.speechSynthesis.speaking),console.debug("pending: "+window.speechSynthesis.pending),r(!0))},M=function(){return t({isPlaying:!1}),p=!1,m?void window.speechSynthesis.pause():void e.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_TTS_STOP,void 0)},L=void 0;this.onEmbeddedEnd=function(){return P=0,S=!1,f&&f.currentPar?void a(f.currentPar.audio.clipEnd+.1,3):void R.reset()},this.onTTSEnd=function(){return P=0,p=!1,f&&f.currentPar?void a(f.currentPar.audio.clipEnd+.1,4):void R.reset()},this.escape=function(){if(!f||!f.currentPar)return void this.toggleMediaOverlay();if(!R.isPlaying())return void R.play();if(C.mediaOverlaysEscapeEscapables)for(var e=f.currentPar;e;){if(e.isEscapable&&e.isEscapable(C.mediaOverlaysEscapables)){do f.next();while(f.currentPar&&f.currentPar.hasAncestor(e));return f.currentPar?void r():void o(!0)}e=e.parent}this.nextMediaOverlay(!0)},this.playUserPar=function(e){if(R.isPlaying()&&R.pause(),e.element||e.cfi&&e.cfi.cfiTextParent){var t=E.adjustParToSeqSyncGranularity(e);if(t&&t!==e){var i=function(e){if(e.nodeType&&"par"===e.nodeType)return e;if(!e.children||e.children.length<=0)return void 0;for(var t=0;t<e.children.length;t++){var n=e.children[t],r=i(n);if(r)return r}},r=i(t);r&&(e=r)}}n(e)},this.resetTTS=function(){g=void 0,M()},this.resetBlankPage=function(){if(N){var e=N;N=void 0,clearTimeout(e)}N=void 0,t({isPlaying:!1})},this.resetEmbedded=function(){w&&($(w).off("ended",R.onEmbeddedEnd),w.pause()),w=void 0,t({isPlaying:!1}),S=!1},this.reset=function(){T=0,h.reset(),R.resetTTS(),R.resetEmbedded(),R.resetBlankPage(),E.reset(),f=void 0,D=!1},this.play=function(){if(f&&f.smil&&!f.smil.id)return void i();if(w)S=!0,w.play(),t({isPlaying:!0});else if(g)k(void 0);else if(!h.play())return console.log("Audio player was dead, reactivating..."),this.reset(),void this.toggleMediaOverlay();d()},this.pause=function(){F=!1,N?this.resetBlankPage():S?(S=!1,w&&w.pause(),t({isPlaying:!1})):p?M():h.pause(),E.reset()},this.isMediaOverlayAvailable=function(){var t=e.getFirstVisibleMediaOverlayElement();return"undefined"!=typeof t},this.nextOrPreviousMediaOverlay=function(e){if(R.isPlaying())R.pause();else if(f&&f.currentPar)return void R.play();if(!f)return void this.toggleMediaOverlay();var t=e?_-1:f.currentPar.audio.clipEnd+.1;a(t,6)},this.nextMediaOverlay=function(){this.nextOrPreviousMediaOverlay(!1)},this.previousMediaOverlay=function(){this.nextOrPreviousMediaOverlay(!0)},this.mediaOverlaysOpenContentUrl=function(t,n,i){T=i,f=void 0,e.openContentUrl(t,n,R)},this.toggleMediaOverlay=function(){return R.isPlaying()?void R.pause():f?void R.play():void this.toggleMediaOverlayRefresh(void 0)};var F=!1;this.toggleMediaOverlayRefresh=function(t){var n=e.getLoadedSpineItems(),i=e.spine().isRightToLeft(),o=void 0,a=R.isPlaying();if(a&&f){var s=t.initiator&&t.initiator instanceof ReadiumSDK.Views.ScrollView;if(s&&C.mediaOverlaysPreservePlaybackWhenScroll)return void(F=!0);o=f.currentPar,R.pause()}F=!1;var l=t&&t.elementIdResolved?t.elementIdResolved:void 0,u=t&&t.elementId?t.elementId:void 0;if(!l){u&&console.error("[WARN] id did not resolve to element?");for(var c=i?n.length-1:0;i&&c>=0||!i&&c<n.length;c+=i?-1:1){var d=n[c];if(d){if(!t||!t.spineItem||t.spineItem==d){if(u){var h=e.getElementById(d,u);l=h&&h.length>0?h[0]:void 0}else if(d.isFixedLayout()&&t&&t.paginationInfo&&t.paginationInfo.openPages){var p=0;if(t.paginationInfo.openPages[p]&&t.paginationInfo.openPages[p].idref&&t.paginationInfo.openPages[p].idref===d.idref){var h=e.getElement(d,"body");l=h&&h.length>0?h[0]:void 0}}if(l)break}}else console.error("spineItems[i] is undefined??")}}if(l||(l=e.getFirstVisibleMediaOverlayElement()),!l)return void R.reset();var g=$(l).data("mediaOverlayData");if(!g){for(var m=!1,v=function(e){if(!e)return!1;for(var t=0;t<e.length;t++){if(l===e[t]&&(m=!0),m){var n=$(e[t]).data("mediaOverlayData");if(n)return g=n,!0}var i=v(e[t].children);if(i)return!0}return!1},y=l;y&&"body"!==y.nodeName.toLowerCase();)y=y.parentNode;if(!y)return void R.reset();v([y])}if(!g)return void R.reset();var S=g.par?g.par:g.pars[0],w=S.getSmil();return f&&f.smil==w?f.reset():f=new ReadiumSDK.Models.SmilIterator(w),f.goToPar(S),!f.currentPar&&u&&(f.reset(),f.findTextId(u)),f.currentPar?void(a&&o&&o===f.currentPar?R.play():r()):void R.reset()},this.isPlayingCfi=function(){return f&&f.currentPar&&f.currentPar.cfi};var B=!1,H=!0;this.setAutomaticNextSmil=function(e){H=e}},define("mediaOverlayPlayer",["readiumSDK","mediaOverlay","audioPlayer","mediaOverlayElementHighlighter","rangy"],function(e){return function(){var t;return t||e.mediaOverlayPlayer}}(this)),ReadiumSDK.Models.PageOpenRequest=function(e,t){this.spineItem=e,this.spineItemPageIndex=void 0,this.elementId=void 0,this.elementCfi=void 0,this.firstPage=!1,this.lastPage=!1,this.initiator=t,this.reset=function(){this.spineItemPageIndex=void 0,this.elementId=void 0,this.elementCfi=void 0,this.firstPage=!1,this.lastPage=!1},this.setFirstPage=function(){this.reset(),this.firstPage=!0},this.setLastPage=function(){this.reset(),this.lastPage=!0},this.setPageIndex=function(e){this.reset(),this.spineItemPageIndex=e},this.setElementId=function(e){this.reset(),this.elementId=e},this.setElementCfi=function(e){this.reset(),this.elementCfi=e}},define("pageOpenRequest",["readiumSDK"],function(e){return function(){var t;return t||e.pageOpenRequest}}(this)),function(e){var t={};t.Parser=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(//g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[ ---￿]/g,escape)+'"'}var t={parse:function(t,n){function i(e){k>O||(O>k&&(k=O,M=[]),M.push(e))}function r(){var e,n,r,s,l;return s=O,l=O,"epubcfi("===t.substr(O,8)?(e="epubcfi(",O+=8):(e=null,0===A&&i('"epubcfi("')),null!==e?(n=o(),null===n&&(n=a()),null!==n?(41===t.charCodeAt(O)?(r=")",O++):(r=null,0===A&&i('")"')),null!==r?e=[e,n,r]:(e=null,O=l)):(e=null,O=l)):(e=null,O=l),null!==e&&(e=function(e,t){return{type:"CFIAST",cfiString:t}}(s,e[1])),null===e&&(O=s),e}function o(){var e,n,r,o,a,u,c,d;return c=O,d=O,e=l(),null!==e?(n=s(),null!==n?(44===t.charCodeAt(O)?(r=",",O++):(r=null,0===A&&i('","')),null!==r?(o=s(),null!==o?(44===t.charCodeAt(O)?(a=",",O++):(a=null,0===A&&i('","')),null!==a?(u=s(),null!==u?e=[e,n,r,o,a,u]:(e=null,O=d)):(e=null,O=d)):(e=null,O=d)):(e=null,O=d)):(e=null,O=d)):(e=null,O=d),null!==e&&(e=function(e,t,n,i,r){return{type:"range",path:t,localPath:n,range1:i,range2:r}}(c,e[0],e[1],e[3],e[5])),null===e&&(O=c),e}function a(){var e,t,n,i;return n=O,i=O,e=l(),null!==e?(t=s(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null!==e&&(e=function(e,t,n){return{type:"path",path:t,localPath:n}}(n,e[0],e[1])),null===e&&(O=n),e}function s(){var e,t,n,i;if(n=O,i=O,t=l(),null===t&&(t=u()),null!==t)for(e=[];null!==t;)e.push(t),t=l(),null===t&&(t=u());else e=null;return null!==e?(t=c(),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null!==e&&(e=function(e,t,n){return{steps:t,termStep:n}}(n,e[0],e[1])),null===e&&(O=n),e}function l(){var e,n,r,o,a,s,l,u;return s=O,l=O,47===t.charCodeAt(O)?(e="/",O++):(e=null,0===A&&i('"/"')),null!==e?(n=S(),null!==n?(u=O,91===t.charCodeAt(O)?(r="[",O++):(r=null,0===A&&i('"["')),null!==r?(o=d(),null!==o?(93===t.charCodeAt(O)?(a="]",O++):(a=null,0===A&&i('"]"')),null!==a?r=[r,o,a]:(r=null,O=u)):(r=null,O=u)):(r=null,O=u),r=null!==r?r:"",null!==r?e=[e,n,r]:(e=null,O=l)):(e=null,O=l)):(e=null,O=l),null!==e&&(e=function(e,t,n){return{type:"indexStep",stepLength:t,idAssertion:n[1]}}(s,e[1],e[2])),null===e&&(O=s),e}function u(){var e,n,r,o,a,s,l,u;return s=O,l=O,"!/"===t.substr(O,2)?(e="!/",O+=2):(e=null,0===A&&i('"!/"')),null!==e?(n=S(),null!==n?(u=O,91===t.charCodeAt(O)?(r="[",O++):(r=null,0===A&&i('"["')),null!==r?(o=d(),null!==o?(93===t.charCodeAt(O)?(a="]",O++):(a=null,0===A&&i('"]"')),null!==a?r=[r,o,a]:(r=null,O=u)):(r=null,O=u)):(r=null,O=u),r=null!==r?r:"",null!==r?e=[e,n,r]:(e=null,O=l)):(e=null,O=l)):(e=null,O=l),null!==e&&(e=function(e,t,n){return{type:"indirectionStep",stepLength:t,idAssertion:n[1]}}(s,e[1],e[2])),null===e&&(O=s),e}function c(){var e,n,r,o,a,s,l,u;return s=O,l=O,58===t.charCodeAt(O)?(e=":",O++):(e=null,0===A&&i('":"')),null!==e?(n=S(),null!==n?(u=O,91===t.charCodeAt(O)?(r="[",O++):(r=null,0===A&&i('"["')),null!==r?(o=f(),null!==o?(93===t.charCodeAt(O)?(a="]",O++):(a=null,0===A&&i('"]"')),null!==a?r=[r,o,a]:(r=null,O=u)):(r=null,O=u)):(r=null,O=u),r=null!==r?r:"",null!==r?e=[e,n,r]:(e=null,O=l)):(e=null,O=l)):(e=null,O=l),null!==e&&(e=function(e,t,n){return{type:"textTerminus",offsetValue:t,textAssertion:n[1]}}(s,e[1],e[2])),null===e&&(O=s),e}function d(){var e,t;return t=O,e=m(),null!==e&&(e=function(e,t){return t}(t,e)),null===e&&(O=t),e}function f(){var e,t,n,i;return n=O,i=O,e=p(),e=null!==e?e:"",null!==e?(t=h(),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null!==e&&(e=function(e,t,n){return{type:"textLocationAssertion",csv:t,parameter:n}}(n,e[0],e[1])),null===e&&(O=n),e}function h(){var e,n,r,o,a,s;return a=O,s=O,59===t.charCodeAt(O)?(e=";",O++):(e=null,0===A&&i('";"')),null!==e?(n=g(),null!==n?(61===t.charCodeAt(O)?(r="=",O++):(r=null,0===A&&i('"="')),null!==r?(o=g(),null!==o?e=[e,n,r,o]:(e=null,O=s)):(e=null,O=s)):(e=null,O=s)):(e=null,O=s),null!==e&&(e=function(e,t,n){return{type:"parameter",LHSValue:t,RHSValue:n}}(a,e[1],e[3])),null===e&&(O=a),e}function p(){var e,n,r,o,a;return o=O,a=O,e=m(),e=null!==e?e:"",null!==e?(44===t.charCodeAt(O)?(n=",",O++):(n=null,0===A&&i('","')),null!==n?(r=m(),r=null!==r?r:"",null!==r?e=[e,n,r]:(e=null,O=a)):(e=null,O=a)):(e=null,O=a),null!==e&&(e=function(e,t,n){return{type:"csv",preAssertion:t,postAssertion:n}}(o,e[0],e[2])),null===e&&(O=o),e}function g(){var e,t,n;if(n=O,t=v(),null===t&&(t=N()),null!==t)for(e=[];null!==t;)e.push(t),t=v(),null===t&&(t=N());else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(O=n),e}function m(){var e,t,n;if(n=O,t=v(),null===t&&(t=N(),null===t&&(t=w())),null!==t)for(e=[];null!==t;)e.push(t),t=v(),null===t&&(t=N(),null===t&&(t=w()));else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(O=n),e}function v(){var e,t,n,i;return n=O,i=O,e=b(),null!==e?(t=b(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null===e&&(i=O,e=b(),null!==e?(t=R(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null===e&&(i=O,e=b(),null!==e?(t=E(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null===e&&(i=O,e=b(),null!==e?(t=x(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null===e&&(i=O,e=b(),null!==e?(t=I(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i),null===e&&(i=O,e=b(),null!==e?(t=T(),null!==t?e=[e,t]:(e=null,O=i)):(e=null,O=i)))))),null!==e&&(e=function(e,t){return t[1]}(n,e)),null===e&&(O=n),e}function y(){var e,n,r,o,a,s,l;if(a=O,s=O,l=O,/^[1-9]/.test(t.charAt(O))?(e=t.charAt(O),O++):(e=null,0===A&&i("[1-9]")),null!==e){if(/^[0-9]/.test(t.charAt(O))?(r=t.charAt(O),O++):(r=null,0===A&&i("[0-9]")),null!==r)for(n=[];null!==r;)n.push(r),/^[0-9]/.test(t.charAt(O))?(r=t.charAt(O),O++):(r=null,0===A&&i("[0-9]"));else n=null;null!==n?e=[e,n]:(e=null,O=l)}else e=null,O=l;if(null!==e)if(46===t.charCodeAt(O)?(n=".",O++):(n=null,0===A&&i('"."')),null!==n){for(l=O,r=[],/^[0-9]/.test(t.charAt(O))?(o=t.charAt(O),O++):(o=null,0===A&&i("[0-9]"));null!==o;)r.push(o),/^[0-9]/.test(t.charAt(O))?(o=t.charAt(O),O++):(o=null,0===A&&i("[0-9]"));null!==r?(/^[1-9]/.test(t.charAt(O))?(o=t.charAt(O),O++):(o=null,0===A&&i("[1-9]")),null!==o?r=[r,o]:(r=null,O=l)):(r=null,O=l),null!==r?e=[e,n,r]:(e=null,O=s)}else e=null,O=s;else e=null,O=s;return null!==e&&(e=function(e,t,n){return t.join("")+"."+n.join("")}(a,e[0],e[2])),null===e&&(O=a),e}function S(){var e,n,r,o,a;if(o=O,48===t.charCodeAt(O)?(e="0",O++):(e=null,0===A&&i('"0"')),null===e)if(a=O,/^[1-9]/.test(t.charAt(O))?(e=t.charAt(O),O++):(e=null,0===A&&i("[1-9]")),null!==e){for(n=[],/^[0-9]/.test(t.charAt(O))?(r=t.charAt(O),O++):(r=null,0===A&&i("[0-9]"));null!==r;)n.push(r),/^[0-9]/.test(t.charAt(O))?(r=t.charAt(O),O++):(r=null,0===A&&i("[0-9]"));null!==n?e=[e,n]:(e=null,O=a)}else e=null,O=a;return null!==e&&(e=function(e,t){return"0"===t?"0":t[0].concat(t[1].join(""))}(o,e)),null===e&&(O=o),e}function w(){var e,n;return n=O,32===t.charCodeAt(O)?(e=" ",O++):(e=null,0===A&&i('" "')),null!==e&&(e=function(){return" "}(n)),null===e&&(O=n),e}function b(){var e,n;return n=O,94===t.charCodeAt(O)?(e="^",O++):(e=null,0===A&&i('"^"')),null!==e&&(e=function(){return"^"}(n)),null===e&&(O=n),e}function C(){var e,n;return n=O,34===t.charCodeAt(O)?(e='"',O++):(e=null,0===A&&i('"\\""')),null!==e&&(e=function(){return'"'}(n)),null===e&&(O=n),e}function R(){var e,n;return n=O,91===t.charCodeAt(O)?(e="[",O++):(e=null,0===A&&i('"["')),null===e&&(93===t.charCodeAt(O)?(e="]",O++):(e=null,0===A&&i('"]"'))),null!==e&&(e=function(e,t){return t}(n,e)),null===e&&(O=n),e}function E(){var e,n;return n=O,40===t.charCodeAt(O)?(e="(",O++):(e=null,0===A&&i('"("')),null===e&&(41===t.charCodeAt(O)?(e=")",O++):(e=null,0===A&&i('")"'))),null!==e&&(e=function(e,t){return t}(n,e)),null===e&&(O=n),e}function x(){var e,n;return n=O,44===t.charCodeAt(O)?(e=",",O++):(e=null,0===A&&i('","')),null!==e&&(e=function(){return","}(n)),null===e&&(O=n),e}function I(){var e,n;return n=O,59===t.charCodeAt(O)?(e=";",O++):(e=null,0===A&&i('";"')),null!==e&&(e=function(){return";"}(n)),null===e&&(O=n),e}function T(){var e,n;return n=O,61===t.charCodeAt(O)?(e="=",O++):(e=null,0===A&&i('"="')),null!==e&&(e=function(){return"="}(n)),null===e&&(O=n),e}function N(){var e,n;return n=O,/^[a-z]/.test(t.charAt(O))?(e=t.charAt(O),O++):(e=null,0===A&&i("[a-z]")),null===e&&(/^[A-Z]/.test(t.charAt(O))?(e=t.charAt(O),O++):(e=null,0===A&&i("[A-Z]")),null===e&&(/^[0-9]/.test(t.charAt(O))?(e=t.charAt(O),O++):(e=null,0===A&&i("[0-9]")),null===e&&(45===t.charCodeAt(O)?(e="-",O++):(e=null,0===A&&i('"-"')),null===e&&(95===t.charCodeAt(O)?(e="_",O++):(e=null,0===A&&i('"_"')),null===e&&(46===t.charCodeAt(O)?(e=".",O++):(e=null,0===A&&i('"."'))))))),null!==e&&(e=function(e,t){return t}(n,e)),null===e&&(O=n),e}function D(e){e.sort();for(var t=null,n=[],i=0;i<e.length;i++)e[i]!==t&&(n.push(e[i]),t=e[i]);return n}function P(){for(var e=1,n=1,i=!1,r=0;r<Math.max(O,k);r++){var o=t.charAt(r);"\n"===o?(i||e++,n=1,i=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e++,n=1,i=!0):(n++,i=!1)}return{line:e,column:n}}var _={fragment:r,range:o,path:a,local_path:s,indexStep:l,indirectionStep:u,terminus:c,idAssertion:d,textLocationAssertion:f,parameter:h,csv:p,valueNoSpace:g,value:m,escapedSpecialChars:v,number:y,integer:S,space:w,circumflex:b,doubleQuote:C,squareBracket:R,parentheses:E,comma:x,semicolon:I,equal:T,character:N};if(void 0!==n){if(void 0===_[n])throw new Error("Invalid rule name: "+e(n)+".")}else n="fragment";var O=0,A=0,k=0,M=[],L=_[n]();if(null===L||O!==t.length){var F=Math.max(O,k),B=F<t.length?t.charAt(F):null,H=P();throw new this.SyntaxError(D(M),B,F,H.line,H.column)}return L},toSource:function(){return this._source}};return t.SyntaxError=function(t,n,i,r,o){function a(t,n){var i,r;switch(t.length){case 0:i="end of input";break;case 1:i=t[0];break;default:i=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return r=n?e(n):"end of input","Expected "+i+" but "+r+" found."}this.name="SyntaxError",this.expected=t,this.found=n,this.message=a(t,n),this.offset=i,this.line=r,this.column=o},t.SyntaxError.prototype=Error.prototype,t}(),t.CFIInstructions={getNextNode:function(e,t,n,i,r){var o;return o=e%2==0?this.elementNodeStep(e,t,n,i,r):this.inferTargetTextNode(e,t,n,i,r)},followIndirectionStep:function(e,n,i,r,o){var a,s,l,u;if(void 0===n||!n.is("iframe"))throw t.NodeTypeError(n,"expected an iframe element");return n.is("iframe")?(a=n.contents(),s=this.applyBlacklist(a.children(),i,r,o),l=$(s[0]),u=this.getNextNode(e,l,i,r,o)):void 0},textTermination:function(e,n,i){var r;if(void 0===e)throw t.NodeTypeError(e,"expected a terminating node, or node list");if(0===e.length)throw t.TerminusError("Text","Text offset:"+n,"no nodes found for termination condition");return r=this.injectCFIMarkerIntoText(e,n,i)},targetIdMatchesIdAssertion:function(e,t){return e.attr("id")===t?!0:!1},elementNodeStep:function(e,n,i,r,o){var a,s,l,u=e/2-1;if(s=this.applyBlacklist(n.children(),i,r,o),l=s.length,this.indexOutOfRange(u,l))throw t.OutOfRangeError(u,l-1,"");return a=$(s[u])},retrieveItemRefHref:function(e,t){return $("#"+e.attr("idref"),t).attr("href")},indexOutOfRange:function(e,t){return e>t-1?!0:!1},injectCFIMarkerIntoText:function(e,n,i){var r,o,a,s,l,u=0;for(r=0;r<=e.length;r++)if(3===e[r].nodeType){if(currNodeMaxIndex=e[r].nodeValue.length+u,o=n-u,currNodeMaxIndex>n)return a=e[r].nodeValue,e[r].nodeValue=a.slice(0,o),s=$(i).insertAfter(e.eq(r)),l=$(document.createTextNode(a.slice(o,a.length))),$(l).insertAfter(s),s;if(currNodeMaxIndex==n)return s=$(i).insertAfter(e.eq(r));u=currNodeMaxIndex}throw t.TerminusError("Text","Text offset:"+n,"The offset exceeded the length of the text")},inferTargetTextNode:function(e,n,i,r,o){var a,s,l,u,c;if(a=this.applyBlacklist(n.contents(),i,r,o),l=(parseInt(e)+1)/2-1,s=0,c=!1,u=a.filter(function(){return s!==l?(this.nodeType===Node.TEXT_NODE?c=!0:c&&this.nodeType!==Node.TEXT_NODE&&this!==a.lastChild&&(s++,c=!1),!1):this.nodeType===Node.TEXT_NODE?(c=!0,!0):c&&this.nodeType!==Node.TEXT_NODE?(s++,c=!1,!1):void 0}),0===u.length)throw t.OutOfRangeError(logicalTargetTextNodeIndex,s,"Index out of range");return u},applyBlacklist:function(e,t,n,i){var r;return r=e.filter(function(){var e=$(this),r=!0;return t&&$.each(t,function(t,n){return e.hasClass(n)?(r=!1,!1):void 0}),n&&$.each(n,function(t,n){return e.is(n)?(r=!1,!1):void 0}),i&&$.each(i,function(t,n){return e.attr("id")===n?(r=!1,!1):void 0}),r})}},t.Interpreter={getContentDocHref:function(e,n,i,r,o){var a=$(n),s=decodeURI(e),l=t.Parser.parse(s);if(!l||"CFIAST"!==l.type)throw t.NodeTypeError(l,"expected CFI AST root node");var u=$($("package",a)[0]),c=this.interpretIndexStepNode(l.cfiString.path,u,i,r,o);return foundHref=this.searchLocalPathForHref(c,a,l.cfiString.localPath,i,r,o),foundHref?foundHref:void 0},injectElement:function(e,n,i,r,o,a){var s,l,u,c=decodeURI(e),d=t.Parser.parse(c);return l=this.getFirstIndirectionStepNum(d),s=d.cfiString.localPath.steps[l],s.type="indexStep",u=this.interpretLocalPath(d.cfiString.localPath,l,$("html",n),r,o,a),u=this.interpretTextTerminusNode(d.cfiString.localPath.termStep,u,i)},injectRangeElements:function(e,n,i,r,o,a,s){var l,u,c,d,f,h=decodeURI(e),p=t.Parser.parse(h);
return u=this.getFirstIndirectionStepNum(p),l=p.cfiString.localPath.steps[u],l.type="indexStep",c=this.interpretLocalPath(p.cfiString.localPath,u,$("html",n),o,a,s),d=this.interpretLocalPath(p.cfiString.range1,0,c,o,a,s),d=this.interpretTextTerminusNode(p.cfiString.range1.termStep,d,i),f=this.interpretLocalPath(p.cfiString.range2,0,c,o,a,s),f=this.interpretTextTerminusNode(p.cfiString.range2.termStep,f,r),{startElement:d[0],endElement:f[0]}},getTargetElement:function(e,n,i,r,o){var a,s,l,u=decodeURI(e),c=t.Parser.parse(u);return s=this.getFirstIndirectionStepNum(c),a=c.cfiString.localPath.steps[s],a.type="indexStep",l=this.interpretLocalPath(c.cfiString.localPath,s,$("html",n),i,r,o)},getRangeTargetElements:function(e,n,i,r,o){var a,s,l,u,c,d=decodeURI(e),f=t.Parser.parse(d);return s=this.getFirstIndirectionStepNum(f),a=f.cfiString.localPath.steps[s],a.type="indexStep",l=this.interpretLocalPath(f.cfiString.localPath,s,$("html",n),i,r,o),u=this.interpretLocalPath(f.cfiString.range1,0,l,i,r,o),c=this.interpretLocalPath(f.cfiString.range2,0,l,i,r,o),{startElement:u[0],endElement:c[0]}},getTargetElementWithPartialCFI:function(e,n,i,r,o){var a=decodeURI(e),s=t.Parser.parse(a),l=this.interpretIndexStepNode(s.cfiString.path,$("html",n),i,r,o);return l=this.interpretLocalPath(s.cfiString.localPath,0,l,i,r,o)},getTextTerminusInfoWithPartialCFI:function(e,n,i,r,o){var a,s=decodeURI(e),l=t.Parser.parse(s),u=this.interpretIndexStepNode(l.cfiString.path,$("html",n),i,r,o);return u=this.interpretLocalPath(l.cfiString.localPath,0,u,i,r,o),a=parseInt(l.cfiString.localPath.termStep.offsetValue),{textNode:u,textOffset:a}},getFirstIndirectionStepNum:function(e){var t=0;for(t;t<=e.cfiString.localPath.steps.length-1;t++)if(nextStepNode=e.cfiString.localPath.steps[t],"indirectionStep"===nextStepNode.type)return t},interpretLocalPath:function(e,t,n,i,r,o){var a,s=t;for(s;s<=e.steps.length-1;s++)a=e.steps[s],"indexStep"===a.type?n=this.interpretIndexStepNode(a,n,i,r,o):"indirectionStep"===a.type&&(n=this.interpretIndirectionStepNode(a,n,i,r,o));return n},interpretIndexStepNode:function(e,n,i,r,o){if(void 0===e||"indexStep"!==e.type)throw t.NodeTypeError(e,"expected index step node");var a=t.CFIInstructions.getNextNode(e.stepLength,n,i,r,o);if(e.idAssertion&&!t.CFIInstructions.targetIdMatchesIdAssertion(a,e.idAssertion))throw t.CFIAssertionError(e.idAssertion,a.attr("id"),"Id assertion failed");return a},interpretIndirectionStepNode:function(e,n,i,r){if(void 0===e||"indirectionStep"!==e.type)throw t.NodeTypeError(e,"expected indirection step node");var o=t.CFIInstructions.followIndirectionStep(e.stepLength,n,i,r);if(e.idAssertion&&!t.CFIInstructions.targetIdMatchesIdAssertion(o,e.idAssertion))throw t.CFIAssertionError(e.idAssertion,o.attr("id"),"Id assertion failed");return o},interpretTextTerminusNode:function(e,n,i){if(void 0===e||"textTerminus"!==e.type)throw t.NodeTypeError(e,"expected text terminus node");var r=t.CFIInstructions.textTermination(n,e.offsetValue,i);return r},searchLocalPathForHref:function(e,n,i,r,o,a){var s,l=0;for(l=0;l<=i.steps.length-1;l++)if(s=i.steps[l],"indexStep"===s.type?e=this.interpretIndexStepNode(s,e,r,o,a):"indirectionStep"===s.type&&(e=this.interpretIndirectionStepNode(s,e,r,o,a)),e.is("itemref"))return t.CFIInstructions.retrieveItemRefHref(e,n);return void 0}},t.NodeTypeError=function(e,t){function n(){this.node=e}return n.prototype=new Error(t),n.constructor=n,new n},t.OutOfRangeError=function(e,t,n){function i(){this.targetIndex=e,this.maxIndex=t}return i.prototype=new Error(n),i.constructor=i(),new i},t.TerminusError=function(e,t,n){function i(){this.terminusType=e,this.terminusCondition=t}return i.prototype=new Error(n),i.constructor=i(),new i},t.CFIAssertionError=function(e,t,n){function i(){this.expectedAssertion=e,this.targetElementAssertion=t}return i.prototype=new Error(n),i.constructor=i(),new i},t.Generator={generateCharOffsetRangeComponent:function(e,t,n,i,r,o,a){var s,l,u,c,d,f,h;return this.validateStartTextNode(e),this.validateStartTextNode(n),$(e).parent()[0]===$(n).parent()[0]?(u=this.createCFITextNodeStep($(e),t,r,o,a),d=this.createCFITextNodeStep($(n),i,r,o,a),h=this.createCFIElementSteps($(e).parent(),"html",r,o,a),h.substring(1,h.length)+","+u+","+d):(s=document.createRange(),s.setStart(e,t),s.setEnd(n,i),l=s.commonAncestorContainer,u=this.createCFITextNodeStep($(e),t,r,o,a),c=this.createCFIElementSteps($(e).parent(),l,r,o,a)+u,d=this.createCFITextNodeStep($(n),i,r,o,a),f=this.createCFIElementSteps($(n).parent(),l,r,o,a)+d,h=this.createCFIElementSteps($(l),"html",r,o,a),h.substring(1,h.length)+","+c+","+f)},generateElementRangeComponent:function(e,t,n,i,r){var o,a,s,l,u;if(this.validateStartElement(e),this.validateStartElement(t),e===t)throw new Error("Start and end element cannot be the same for a CFI range");return o=document.createRange(),o.setStart(e),o.setEnd(t),a=o.commonAncestorContainer,s=this.createCFIElementSteps($(e),a,n,i,r),l=this.createCFIElementSteps($(t),a,n,i,r),u=this.createCFIElementSteps($(a),"html",n,i,r),u.substring(1,u.length)+","+s+","+l},generateCharacterOffsetCFIComponent:function(e,t,n,i,r){var o,a;return this.validateStartTextNode(e,t),o=this.createCFITextNodeStep($(e),t,n,i,r),a=this.createCFIElementSteps($(e).parent(),"html",n,i,r)+o,a.substring(1,a.length)},generateElementCFIComponent:function(e,t,n,i){var r;return this.validateStartElement(e),r=this.createCFIElementSteps($(e),"html",t,n,i),r.substring(1,r.length)},generatePackageDocumentCFIComponent:function(e,t,n,i,r){return this.validateContentDocumentName(e),this.validatePackageDocument(t,e),$itemRefStartNode=$("itemref[idref='"+e+"']",$(t)),packageDocCFIComponent=this.createCFIElementSteps($itemRefStartNode,"package",n,i,r),packageDocCFIComponent+"!"},generatePackageDocumentCFIComponentWithSpineIndex:function(e,t,n,i,r){return $itemRefStartNode=$($("spine",t).children()[e]),packageDocCFIComponent=this.createCFIElementSteps($itemRefStartNode,"package",n,i,r),packageDocCFIComponent+"!"},generateCompleteCFI:function(e,t){return"epubcfi("+e+t+")"},validateStartTextNode:function(e,n){if(!e)throw new t.NodeTypeError(e,"Cannot generate a character offset from a starting point that is not a text node");if(3!=e.nodeType)throw new t.NodeTypeError(e,"Cannot generate a character offset from a starting point that is not a text node");if(0>n)throw new t.OutOfRangeError(n,0,"Character offset cannot be less than 0");if(n>e.nodeValue.length)throw new t.OutOfRangeError(n,e.nodeValue.length-1,"character offset cannot be greater than the length of the text node")},validateStartElement:function(e){if(!e)throw new t.NodeTypeError(e,"CFI target element is undefined");if(!e.nodeType||1!==e.nodeType)throw new t.NodeTypeError(e,"CFI target element is not an HTML element")},validateContentDocumentName:function(e){if(!e)throw new Error("The idref for the content document, as found in the spine, must be supplied")},validatePackageDocument:function(e,t){if(!e)throw new Error("A package document must be supplied to generate a CFI");if(0===$($("itemref[idref='"+t+"']",e)[0]).length)throw new Error("The idref of the content document could not be found in the spine")},createCFITextNodeStep:function(e,n,i,r,o){var a,s,l,u;a=e.parent(),s=t.CFIInstructions.applyBlacklist(a.contents(),i,r,o);var c,d,f=0,h=0,p=0;return $.each(s,function(){if(this.nodeType===Node.TEXT_NODE){if(this===e[0])return c?(u=d,p=h):u=f,!1;c=!0,h+=this.length,void 0===d&&(d=f,f+=1)}else c=!1,d=void 0,h=0}),l=2*u+1,"/"+l+":"+(p+n)},createCFIElementSteps:function(e,n,i,r,o){var a,s,l,u,c;return a=t.CFIInstructions.applyBlacklist(e.parent().children(),i,r,o),$.each(a,function(t){return this===e[0]?(l=t,!1):void 0}),u=2*(l+1),c=e.attr("id")?"/"+u+"["+e.attr("id")+"]":"/"+u,s=e.parent(),s.is(n)||e.is(n)?"html"===n?"!"+c:c:this.createCFIElementSteps(s,n,i,r,o)+c}};var n=t.Interpreter,i=t.Generator,r=t.CFIInstructions;if(e.EPUBcfi)throw new Error("The EPUB cfi library has already been defined");e.EPUBcfi=t;var o=t.CFIInstructions,a=t.Parser,s=t.OutOfRangeError,l=t.Interpreter,u=t.NodeTypeError,c=t.OutOfRangeError,d=t.TerminusError,f=t.CFIAssertionError;e.EPUBcfi=t={getContentDocHref:function(e,t){return n.getContentDocHref(e,t)},injectElement:function(e,t,i,r,o,a){return n.injectElement(e,t,i,r,o,a)},getTargetElement:function(e,t,i,r,o){return n.getTargetElement(e,t,i,r,o)},getTargetElementWithPartialCFI:function(e,t,i,r,o){return n.getTargetElementWithPartialCFI(e,t,i,r,o)},getTextTerminusInfoWithPartialCFI:function(e,t,i,r,o){return n.getTextTerminusInfoWithPartialCFI(e,t,i,r,o)},generateCharacterOffsetCFIComponent:function(e,t,n,r,o){return i.generateCharacterOffsetCFIComponent(e,t,n,r,o)},generateElementCFIComponent:function(e,t,n,r){return i.generateElementCFIComponent(e,t,n,r)},generatePackageDocumentCFIComponent:function(e,t,n,r,o){return i.generatePackageDocumentCFIComponent(e,t,n,r,o)},generatePackageDocumentCFIComponentWithSpineIndex:function(e,t,n,r,o){return i.generatePackageDocumentCFIComponentWithSpineIndex(e,t,n,r,o)},generateCompleteCFI:function(e,t){return i.generateCompleteCFI(e,t)},injectElementAtOffset:function(e,t,n){return r.injectCFIMarkerIntoText(e,t,n)},injectRangeElements:function(e,t,i,r,o,a,s){return n.injectRangeElements(e,t,i,r,o,a,s)},getRangeTargetElements:function(e,t,i,r,o){return n.getRangeTargetElements(e,t,i,r,o)},generateCharOffsetRangeComponent:function(e,t,n,r,o,a,s){return i.generateCharOffsetRangeComponent(e,t,n,r,o,a,s)},generateElementRangeComponent:function(e,t,n,r,o){return i.generateElementRangeComponent(e,t,n,r,o)}},t.CFIInstructions=o,t.Parser=a,t.OutOfRangeError=s,t.Interpreter=l,t.Generator=i,t.NodeTypeError=u,t.OutOfRangeError=c,t.TerminusError=d,t.CFIAssertionError=f}("undefined"==typeof window?this:window),define("epubCfi",function(){}),ReadiumSDK.Views.CfiNavigationLogic=function(e,t,n){function i(){return n.paginationInfo&&!!n.paginationInfo.rightToLeft}function r(){return n.paginationInfo&&!!n.paginationInfo.isVerticalWritingMode}function o(e,t,n){return n?e.top>=0&&e.top<t.height:e.left>=0&&e.left<t.width}function a(){return!n.paginationInfo||r()?t.width():n.paginationInfo.columnWidth+n.paginationInfo.columnGap}function s(){return r()?{top:n.paginationInfo?n.paginationInfo.pageOffset:0}:{left:(n.paginationInfo?n.paginationInfo.pageOffset:0)*(i()?-1:1)}}function l(e,t,n){var i=ReadiumSDK.Helpers.Rect.fromElement(e);_.isNaN(i.left)&&(i=new ReadiumSDK.Helpers.Rect(e.position().top,e.position().left,0,0));var r=t.top||0,o=i.bottom()>r,a=void 0!==t.bottom?i.top<t.bottom:!0,s=0;return o&&a?n?(i.top<=r&&(s=Math.ceil(100*(r-i.top)/i.height)),100-s):100:0}function u(e,n,s){var l=f(e),u=l.clientRectangles;if(0===u.length)return null;var c=i(),h=r(),p=a(),m={width:t.width(),height:t.height()};1===u.length&&g(u[0],m,p,c,h,!0);for(var v=0,y=0,S=u.length;S>y;++y)if(o(u[y],m,h)){v=s?d(u,y):100;break}return v}function c(e,o){var l=s(),u=f(e,l),c=u.clientRectangles;if(0===c.length)return null;var d=i(),h=r(),p=a(),v=t.height(),y=t.width();o&&m(c,o,v,p,d,h);var S=_.first(c);1===c.length&&g(S,{height:v,width:y},p,d,h);var w;if(h){var b=S.top;w=Math.floor(b/v)}else{var C=S.left;d&&(C=p*(n.paginationInfo?n.paginationInfo.visibleColumnCount:1)-C),w=Math.floor(C/p)}return 0>w?w=0:w>=(n.paginationInfo?n.paginationInfo.columnCount:1)&&(w=n.paginationInfo?n.paginationInfo.columnCount-1:0),w}function d(e,t){var n=0,i=0;return e.length>1?_.each(e,function(e,r){n+=e.height,r>=t&&(i+=e.height)}):(n=e[0].height,i=e[0].height-Math.max(0,-e[0].top)),i===n?100:Math.floor(100*i/n)}function f(e,t){t=t||{};for(var n=t.left||0,i=t.top||0,r=h(e[0].getBoundingClientRect(),n,i),o=[],a=e[0].getClientRects(),s=0,l=a.length;l>s;++s)a[s].height>0&&o.push(h(a[s],n,i));return 0===o.length&&(e=e.next(),e.length)?f(e,t):{wrapperRectangle:r,clientRectangles:o}}function h(e,t,n){var i={left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.right-e.left,height:e.bottom-e.top};return p(i,t,n),i}function p(e,t,n){e.left+=t,e.right+=t,e.top+=n,e.bottom+=n}function g(e,t,n,i,r,a){if(!r){for(i&&(n*=-1);e.top<0;)p(e,-n,t.height);if(a)for(;e.bottom>=t.height&&!o(e,t,r);)p(e,n,-t.height)}}function m(e,t,n,i,r,o){if(!o){var a=_.reduce(e,function(e,t){return e+t.height},0),s=a*t/100;if(e.length>1){var l=0;do{if(l+=e[0].height,l>s)break;e.shift()}while(e.length>1)}else{for(r&&(i*=-1);e[0].bottom>=n;)p(e[0],i,-n);e[0].top+=s,e[0].height-=s}}}function v(e,n,i,r){var o=t[0].contentDocument,a="epubcfi("+e+")",s=EPUBcfi.getTargetElementWithPartialCFI(a,o,n,i,r);return s&&0!=s.length?s:void console.log("Can't find element for CFI: "+e)}function y(e){var t={cfi:"",x:0,y:0},n=e.indexOf("@");if(-1!=n){var i=e.substring(n+1),r=i.indexOf(":");-1!=r?(t.x=parseInt(i.substr(0,r)),t.y=parseInt(i.substr(r+1))):console.log("Unexpected terminating step format"),t.cfi=e.substring(0,n)}else t.cfi=e;return t}function S(e){if(e.nodeType===Node.TEXT_NODE){var t=e.nodeValue.replace(/\n/g,"");return t=t.replace(/ /g,""),t.length>0}return!1}n=n||{},this.getRootElement=function(){return t[0].contentDocument.documentElement};var w=n.rectangleBased?u:l;this.findFirstVisibleElement=function(e){"object"!=typeof e&&(e={top:e});var t,n=null,i=0;return t=$("body",this.getRootElement()).find(":not(iframe)").contents().filter(function(){return S(this)||"img"===this.nodeName.toLowerCase()}),$.each(t,function(){var t;t=this.nodeType===Node.TEXT_NODE?$(this).parent():$(this);var r=w(t,e,!0);return r?(n=t,i=100-r,!1):!0}),{$element:n,percentY:i}},this.getFirstVisibleElementCfi=function(e){var t=this.findFirstVisibleElement(e);if(!t.$element)return void console.log("Could not generate CFI no visible element on page");var n=EPUBcfi.Generator.generateElementCFIComponent(t.$element[0]);return"!"==n[0]&&(n=n.substring(1)),n+"@0:"+t.percentY},this.getPageForElementCfi=function(e,t,n,i){var r=y(e),o=v(r.cfi,t,n,i);return o?this.getPageForPointOnElement(o,r.x,r.y):-1},this.getElementByCfi=function(e,t,n,i){var r=y(e);return v(r.cfi,t,n,i)},this.getPageForElement=function(e){return this.getPageForPointOnElement(e,0,0)},this.getPageForPointOnElement=function(t,i,r){var o;if(n.rectangleBased)return o=c(t,r),null===o?(console.warn("Impossible to locate a hidden element: ",t),0):o;var a=this.getVerticalOffsetForPointOnElement(t,i,r);return Math.floor(a/e.height())},this.getVerticalOffsetForElement=function(e){return this.getVerticalOffsetForPointOnElement(e,0,0)},this.getVerticalOffsetForPointOnElement=function(e,t,n){var i=ReadiumSDK.Helpers.Rect.fromElement(e);return Math.ceil(i.top+n*i.height/100)},this.getElementById=function(e){var n=t[0].contentDocument,i=$(n.getElementById(e));return 0==i.length?void 0:i},this.getPageForElementId=function(e){var t=this.getElementById(e);return t?this.getPageForElement(t):-1},this.getFirstVisibleMediaOverlayElement=function(e){function t(n){if(!n||!n.length)return void 0;for(var i=0,a=n.length;a>i;i++){var s=n[i];if(s){var l=$(s);if(l.data("mediaOverlayData")){var u=r.getElementVisibility(l,e);if(u&&(o||(o=s),100==u))return s}else{var c=t(s.children);if(c)return c}}}return void 0}var n=this.getRootElement();if(!n)return void 0;var i=$("body",n);if(!i||!i.length||!i[0])return void 0;var r=this,o=void 0,a=t([i[0]]);return a||(a=o),a},this.getElementVisibility=function(e,t){return w(e,t,!0)},this.isElementVisible=w,this.getAllVisibleElementsWithSelector=function(e,t){var n=$(e,this.getRootElement()).filter(function(){return!0}),i=[];$.each(n,function(){i.push($(this))});var r=this.getVisibleElements(i,t);return r},this.getVisibleElements=function(e,t){var n=[];return $.each(e,function(){var e=this,i=w(e,t,!0);if(i){var r=e;return n.push({element:r[0],percentVisible:i}),!0}return null===i?!0:0===n.length}),n},this.getVisibleTextElements=function(e){var t=this.getTextElements($("body",this.getRootElement()));return this.getVisibleElements(t,e)},this.getMediaOverlayElements=function(e){function t(e){if(void 0!=e)for(var i=0,r=e.length;r>i;i++){var o=$(e[i]);o.data("mediaOverlayData")?n.push(o):t(o[0].children)}}var n=[];return t([e[0]]),n},this.getTextElements=function(e){var t=[];return e.find(":not(iframe)").contents().each(function(){S(this)&&t.push($(this).parent())}),t},this.getElement=function(e){var t=$(e,this.getRootElement());return t.length>0?t:void 0}},define("cfiNavigationLogic",["readiumSDK","epubCfi"],function(e){return function(){var t;return t||e.cfiNavigationLogic}}(this)),ReadiumSDK.Views.OnePageView=function(e,t,n){function i(e){if(e){y=!0;var t=c[0].contentDocument;l=$("html",t),l&&0!=l.length||(l=$("svg",t)),b&&h.applyBookStyles(),a(),w.onIFrameLoad()}}function r(){b&&l&&R&&l.css("font-size",R.fontSize+"%")}function o(){if(!c||!c.length)return 0;if(ReadiumSDK.Helpers.isIframeAlive(c[0])){var e=c[0].contentWindow,t=c[0].contentDocument,n=Math.round(parseFloat(e.getComputedStyle(t.documentElement).height));return n}if(l){console.error("getContentDocHeight ??");var i=l.height();return i}return 0}function a(){C.width=0,C.height=0;var e=void 0,t=c[0].contentDocument,n=$("meta[name=viewport]",t).attr("content");if(n||(n=$("meta[name=viewbox]",t).attr("content")),n&&(e=s(n)),!e){var i=$(t).find("svg");if(i.length>0){var r=void 0,o=void 0,a=i[0].getAttribute("width");if(a)try{r=parseInt(a,10)}catch(l){}var u=i[0].getAttribute("height");if(u)try{o=parseInt(u,10)}catch(l){}r&&o&&(e={width:r,height:o})}}if(!e&&d&&(n=d.getRenditionViewport(),n&&(e=s(n),e&&console.log("Viewport: using rendition:viewport dimensions"))),!e){var f=$(t).find("img");if(f.length>0){e={width:f.width(),height:f.height()};var h=d&&d.media_type&&d.media_type.length&&0==d.media_type.indexOf("image/");h||console.warn("Viewport: using img dimensions!")}else if(f=$(t).find("image"),f.length>0){var r=void 0,o=void 0,a=f[0].getAttribute("width");if(a)try{r=parseInt(a,10)}catch(l){}var u=f[0].getAttribute("height");if(u)try{o=parseInt(u,10)}catch(l){}r&&o&&(e={width:r,height:o},console.warn("Viewport: using image dimensions!"))}}e||(r=v.width(),o=v.height(),e={width:r,height:o},console.warn("Viewport: using browser / e-reader viewport dimensions!")),e&&(C.width=e.width,C.height=e.height)}function s(e){for(var t=e.replace(/\s/g,"").split(","),n={},i=0;i<t.length;i++){var r=t[i].split("=");2==r.length&&(n[r[0]]=r[1])}var o=Number.NaN,a=Number.NaN;return n.width&&(o=parseInt(n.width)),n.height&&(a=parseInt(n.height)),isNaN(o)||isNaN(a)?void 0:{width:o,height:a}}_.extend(this,Backbone.Events);var l,u,c,d,f,h=this,p=e.spine,g=e.iframeLoader,m=e.bookStyles,v=e.$viewport,y=!1,S=function(e){var n=function(e,t){this.begin=e,this.end=t},i=new n(function(e,t,n,i){i.css("opacity","0")},function(e,t,n,i){var r={};_.each(["-webkit-","-moz-","-ms-",""],function(e){r[e+"transition"]="opacity 150ms ease-out"}),i.css(r),i.css("opacity","1")}),r=new n(function(e,t,n,i,r,o,a){i.css("opacity","0");var s=Math.ceil(r*e),l=.8*s*(2===a?1:-1),u=ReadiumSDK.Helpers.CSSTransformString({left:Math.round(l),origin:"50% 50%"});i.css(u)},function(e,t,n,i){var r={};_.each(["","-webkit-","-moz-","-ms-"],function(e){r[e+"transition"]=e+"transform 150ms ease-out"}),i.css(r),i.css("opacity","1"),r={},_.each(["-webkit-","-moz-","-ms-",""],function(e){r[e+"transform"]="none"}),i.css(r)}),o=new n(function(e,t,n,i,r,o,a){i.css("opacity","0");var s=Math.ceil(r*e),l=1.7*s*(2===a?1:-1),u=ReadiumSDK.Helpers.CSSTransformString({left:Math.round(l),angle:30*(2===a?-1:1),origin:"50% 50%"});i.css(u)},function(e,t,n,i){var r={};_.each(["","-webkit-","-moz-","-ms-"],function(e){r[e+"transition"]=e+"transform 300ms ease-in-out"}),i.css(r),i.css("opacity","1"),r={},_.each(["-webkit-","-moz-","-ms-",""],function(e){r[e+"transform"]="none"}),i.css(r)}),a=new n(function(e,n,i,r,o,a,s){r.css("opacity","0");for(var l=!1,u=!1,c=!1,d=0;d<t.length;d++){var f=t[d].toLowerCase();if(f.indexOf("left")>=0){l=!0;break}if(f.indexOf("right")>=0){c=!0;break}if(f.indexOf("center")>=0){u=!0;break}}var h=Math.ceil(o*e),p=.5*h*(l||u&&1===s?1:-1),g=ReadiumSDK.Helpers.CSSTransformString({scale:.2,left:Math.round(p),angle:30*(l||u&&1===s?1:-1),origin:"50% 50%"});r.css(g)},function(e,t,n,i){var r={};_.each(["","-webkit-","-moz-","-ms-"],function(e){r[e+"transition"]=e+"transform 400ms ease-out"}),i.css(r),i.css("opacity","1"),r={},_.each(["-webkit-","-moz-","-ms-",""],function(e){r[e+"transform"]="none"}),i.css(r)}),s=[];s.push(i),s.push(r),s.push(o),s.push(a);var l=e.disablePageTransitions||!1,u=-1;this.updateOptions=function(e){null!==e.pageTransition&&"undefined"!=typeof e.pageTransition&&(u=e.pageTransition)},this.updateOptions(e);var c=0,d=!1,f=!1;this.updatePageSwitchDir=function(e,t){f||(c=e,d=t)},this.onIFrameLoad=function(){f=!0},this.transformContentImmediate_BEGIN=function(e,t,n,i){var r=d||f;if(f=!1,!l&&-1!==u){var o={};if(_.each(["-webkit-","-moz-","-ms-",""],function(e){o[e+"transition"]="all 0 ease 0"}),e.css(o),r){var a=u>=0&&u<s.length?s[u]:void 0;0!==c&&a?a.begin(t,n,i,e,h.meta_width(),h.meta_height(),c):e.css("opacity","0")}}},this.transformContentImmediate_END=function(e,t,n,i){l||-1===u||setTimeout(function(){var r=u>=0&&u<s.length?s[u]:void 0;if(0!==c&&r)r.end(t,n,i,e,h.meta_width(),h.meta_height(),c);else{var o={};_.each(["-webkit-","-moz-","-ms-",""],function(e){o[e+"transition"]="opacity 250ms linear"}),e.css(o),e.css("opacity","1")}},10)}},w=new S(e),b=n||!1,C={width:0,height:0};this.element=function(){return u},this.meta_height=function(){return C.height},this.meta_width=function(){return C.width},this.isDisplaying=function(){return y},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("single_page_frame",{});u=$(e),f=$("#scaler",u),_.each(["-webkit-","-moz-","-ms-",""],function(e){u.css(e+"transition","all 0 ease 0")}),u.css("height","100%"),u.css("width","100%");var n=R;n||(n=new ReadiumSDK.Models.ViewerSettings({})),n.enableGPUHardwareAccelerationCSS3D&&u.css("transform","translateZ(0)");for(var i=0,r=t.length;r>i;i++)u.addClass(t[i]);return c=$("iframe",u),this},this.decorateIframe=function(){c&&c.length&&(c.css("border-bottom","1px dashed silver"),c.css("border-top","1px dashed silver"))},this.remove=function(){y=!1,d=void 0,u.remove()},this.clear=function(){y=!1,c[0].src=""},this.currentSpineItem=function(){return d};var R=void 0;this.setViewSettings=function(e){R=e,b&&h.applyBookStyles(),a(),w.updateOptions(e)},this.applyBookStyles=function(){b&&l&&(ReadiumSDK.Helpers.setStyles(m.getStyles(),l),r())},this.scaleToWidth=function(e){if(!(C.width<=0)){var t=e/C.width;h.transformContentImmediate(t,0,0)}},this.resizeIFrameToContent=function(){var e=o();h.setHeight(e),h.showIFrame()},this.setHeight=function(e){f.css("height",e+"px"),u.css("height",e+"px")},this.showIFrame=function(){c.css("visibility","visible"),c.css("transform","none")},this.hideIFrame=function(){c.css("visibility","hidden"),c.css("transform","translate(10000px, 10000px)")},this.updatePageSwitchDir=function(e,t){w.updatePageSwitchDir(e,t)},this.transformContentImmediate=function(e,t,n){var i=Math.ceil(C.width*e),r=Math.floor(C.height*e);if(w.transformContentImmediate_BEGIN(u,e,t,n),u.css("left",t+"px"),u.css("top",n+"px"),u.css("width",i+"px"),u.css("height",r+"px"),l){var o=ReadiumSDK.Helpers.CSSTransformString({scale:e});o.width=C.width,o.height=C.height,f.css(o),l.css("opacity","0.999"),h.showIFrame(),setTimeout(function(){l.css("opacity","1")},0),w.transformContentImmediate_END(u,e,t,n)}},this.getCalculatedPageHeight=function(){return u.height()},this.transformContent=_.bind(_.debounce(this.transformContentImmediate,50),h),this.loadSpineItem=function(e,t,n){if(d!=e){d=e;var r=p.package.resolveRelativeUrl(e.href);h.hideIFrame(),h.trigger(ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START,c,d),g.loadIframe(c[0],r,function(r){if(r&&t){var o=function(){t(r,c,d,!0,n)};ReadiumSDK.Helpers.isIframeAlive(c[0])?(i(r),o()):(console.error("onIFrameLoad !! doc && win + TIMEOUT"),console.debug(e.href),i(r),setTimeout(o,500))}else i(r)},h,{spineItem:d})}else t&&t(!0,c,d,!1,n)},this.getFirstVisibleElementCfi=function(){var e=new ReadiumSDK.Views.CfiNavigationLogic(u,c);return e.getFirstVisibleElementCfi(0)},this.getNavigator=function(){return new ReadiumSDK.Views.CfiNavigationLogic(u,c)},this.getElementByCfi=function(e,t,n,i,r){if(e!=d)return void console.error("spine item is not loaded");var o=new ReadiumSDK.Views.CfiNavigationLogic(u,c);return o.getElementByCfi(t,n,i,r)},this.getElementById=function(e,t){if(e!=d)return void console.error("spine item is not loaded");var n=new ReadiumSDK.Views.CfiNavigationLogic(u,c);return n.getElementById(t)},this.getElement=function(e,t){if(e!=d)return void console.error("spine item is not loaded");var n=new ReadiumSDK.Views.CfiNavigationLogic(u,c);return n.getElement(t)},this.getFirstVisibleMediaOverlayElement=function(){var e=new ReadiumSDK.Views.CfiNavigationLogic(u,c);return e.getFirstVisibleMediaOverlayElement({top:0,bottom:c.height()})},this.offset=function(){return c?c.offset():void 0}},ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START="SpineItemOpenStart",define("onePageView",["readiumSDK","cfiNavigationLogic"],function(e){return function(){var t;return t||e.onePageView}}(this)),ReadiumSDK.Models.CurrentPagesInfo=function(e,t){this.isRightToLeft=e.isRightToLeft(),this.isFixedLayout=t,this.spineItemCount=e.items.length,this.openPages=[],this.addOpenPage=function(e,t,n,i){this.openPages.push({spineItemPageIndex:e,spineItemPageCount:t,idref:n,spineItemIndex:i}),this.sort()},this.canGoLeft=function(){return this.isRightToLeft?this.canGoNext():this.canGoPrev()},this.canGoRight=function(){return this.isRightToLeft?this.canGoPrev():this.canGoNext()},this.canGoNext=function(){if(0==this.openPages.length)return!1;var t=this.openPages[this.openPages.length-1];return t.spineItemIndex<e.last().index||t.spineItemPageIndex<t.spineItemPageCount-1},this.canGoPrev=function(){if(0==this.openPages.length)return!1;var t=this.openPages[0];return e.first().index<t.spineItemIndex||0<t.spineItemPageIndex},this.sort=function(){this.openPages.sort(function(e,t){return e.spineItemIndex!=t.spineItemIndex?e.spineItemIndex-t.spineItemIndex:e.pageIndex-t.pageIndex})}},define("currentPagesInfo",["readiumSDK"],function(e){return function(){var t;return t||e.currentPagesInfo}}(this)),ReadiumSDK.Models.Spread=function(e,t){function n(){a.leftItem=void 0,a.rightItem=void 0,a.centerItem=void 0}function i(e,t){t==ReadiumSDK.Models.Spread.POSITION_LEFT?a.leftItem=e:t==ReadiumSDK.Models.Spread.POSITION_RIGHT?a.rightItem=e:(t!=ReadiumSDK.Models.Spread.POSITION_CENTER&&console.error("Unrecognized position value"),a.centerItem=e)}function r(e){return s?e.isLeftPage()?ReadiumSDK.Models.Spread.POSITION_LEFT:e.isRightPage()?ReadiumSDK.Models.Spread.POSITION_RIGHT:ReadiumSDK.Models.Spread.POSITION_CENTER:ReadiumSDK.Models.Spread.POSITION_CENTER}function o(e){return e.isLeftPage()?a.spine.isRightToLeft()?a.spine.prevItem(e):a.spine.nextItem(e):e.isRightPage()?a.spine.isRightToLeft()?a.spine.nextItem(e):a.spine.prevItem(e):void 0}var a=this;this.spine=e,this.leftItem=void 0,this.rightItem=void 0,this.centerItem=void 0;var s=t;this.setSyntheticSpread=function(e){s=e},this.isSyntheticSpread=function(){return s},this.openFirst=function(){0==this.spine.items.length?n():this.openItem(this.spine.first())},this.openLast=function(){0==this.spine.items.length?n():this.openItem(this.spine.last())},this.openItem=function(e){n();var t=r(e);if(i(e,t),t!=ReadiumSDK.Models.Spread.POSITION_CENTER){var a=o(e);if(a){var s=r(a);s!=t&&s!=ReadiumSDK.Models.Spread.POSITION_CENTER&&i(a,s)}}},this.openNext=function(){var e=this.validItems();if(0==e.length)this.openFirst();else{var t=this.spine.nextItem(e[e.length-1]);t&&this.openItem(t)}},this.openPrev=function(){var e=this.validItems();if(0==e.length)this.openLast();else{var t=this.spine.prevItem(e[0]);t&&this.openItem(t)}},this.validItems=function(){var e=[];return this.leftItem&&e.push(this.leftItem),this.rightItem&&e.push(this.rightItem),this.centerItem&&e.push(this.centerItem),e.sort(function(e,t){return e.index-t.index}),e}},ReadiumSDK.Models.Spread.POSITION_LEFT="left",ReadiumSDK.Models.Spread.POSITION_RIGHT="right",ReadiumSDK.Models.Spread.POSITION_CENTER="center",define("fixedPageSpread",["readiumSDK"],function(e){return function(){var t;return t||e.fixedPageSpread}}(this)),ReadiumSDK.Models.BookmarkData=function(e,t){this.idref=e,this.contentCFI=t},define("bookmarkData",["readiumSDK"],function(e){return function(){var t;return t||e.bookmarkData}}(this)),ReadiumSDK.Views.FixedView=function(e){function t(t){var n=new ReadiumSDK.Views.OnePageView(e,[t],!1);return n.on(ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START,function(e,t){m.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,e,t)}),n}function n(){var e=N.validItems();return e[0]}function i(e,t){if(D)return void(P={initiator:e,paginationRequest:t});D=!0;var n={isElementAdded:!1},a=r([{pageView:C,spineItem:N.leftItem,context:n},{pageView:R,spineItem:N.rightItem,context:n},{pageView:E,spineItem:N.centerItem,context:n}]);$.when.apply($,a).done(function(){if(D=!1,P){var r=P.initiator,a=P.paginationRequest;P=void 0,i(r,a)}else n.isElementAdded&&m.applyStyles(),t?o(e,t.spineItem,t.elementId):o(e)})}function r(e){for(var t=[],n=0;n<e.length;n++){var i=f(e[n].pageView,e[n].spineItem,e[n].context);t.push(i)}return t}function o(e,t,n){c(),l(),m.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:m.getPaginationInfo(),initiator:e,spineItem:t,elementId:n})}function a(e,t){var n=new ReadiumSDK.Models.Spread(y,t);return n.openItem(e),N.leftItem!=n.leftItem||N.rightItem!=n.rightItem||N.centerItem!=n.centerItem}function s(){if(!T||!I)return!1;var e=v.width(),t=v.height();return e&&t}function l(e){if(O(0,!1),s()){var t=v.width(),n=v.height(),i=C.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(C.element()):ReadiumSDK.Helpers.Margins.empty(),r=R.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(R.element()):ReadiumSDK.Helpers.Margins.empty(),o=E.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(E.element()):ReadiumSDK.Helpers.Margins.empty(),a=u(i,r,o),l={width:t-I.width(),height:n-I.height()},c={width:l.width-a.width(),height:l.height-a.height()};if(!(l.width<=0||l.height<=0)){var d,f=c.width/T.width,h=c.height/T.height;d="fit-width"==w.style?f:"fit-height"==w.style?h:"user"==w.style?w.scale:Math.min(f,h),g=d;var y={width:T.width*d,height:T.height*d},S={width:y.width+a.width(),height:y.height+a.height()},b={width:S.width+I.width(),height:S.height+I.height()},x=Math.floor((t-b.width)/2),N=Math.floor((n-b.height)/2);0>x&&(x=0),0>N&&(N=0),p.css("left",x+"px"),p.css("top",N+"px"),p.css("width",S.width+"px"),p.css("height",S.height+"px");var D=I.padding.left,P=I.padding.top,_=e?"transformContentImmediate":"transformContent";C.isDisplaying()&&C[_](d,D,P),R.isDisplaying()&&(D+=T.separatorPosition*d,C.isDisplaying()&&(D+=i.left),R[_](d,D,P)),E.isDisplaying()&&E[_](d,D,P),m.trigger(ReadiumSDK.Events.FXL_VIEW_RESIZED)}}}function u(e,t,n){var i={left:Math.max(e.margin.left,t.margin.left,n.margin.left),right:Math.max(e.margin.right,t.margin.right,n.margin.right),top:Math.max(e.margin.top,t.margin.top,n.margin.top),bottom:Math.max(e.margin.bottom,t.margin.bottom,n.margin.bottom)},r={left:Math.max(e.border.left,t.border.left,n.border.left),right:Math.max(e.border.right,t.border.right,n.border.right),top:Math.max(e.border.top,t.border.top,n.border.top),bottom:Math.max(e.border.bottom,t.border.bottom,n.border.bottom)},o={left:Math.max(e.padding.left,t.padding.left,n.padding.left),right:Math.max(e.padding.right,t.padding.right,n.padding.right),top:Math.max(e.padding.top,t.padding.top,n.padding.top),bottom:Math.max(e.padding.bottom,t.padding.bottom,n.padding.bottom)};return new ReadiumSDK.Helpers.Margins(i,r,o)}function c(){T={},E.isDisplaying()?(T.width=E.meta_width(),T.height=E.meta_height(),T.separatorPosition=0):C.isDisplaying()&&R.isDisplaying()?C.meta_height()==R.meta_height()?(T.width=C.meta_width()+R.meta_width(),T.height=C.meta_height(),T.separatorPosition=C.meta_width()):(T.width=C.meta_width()+R.meta_width()*(C.meta_height()/R.meta_height()),T.height=C.meta_height(),T.separatorPosition=C.meta_width()):C.isDisplaying()?(T.width=2*C.meta_width(),T.height=C.meta_height(),T.separatorPosition=C.meta_width()):R.isDisplaying()?(T.width=2*R.meta_width(),T.height=R.meta_height(),T.separatorPosition=R.meta_width()):T=void 0
}function d(){I=ReadiumSDK.Helpers.Margins.fromElement(p)}function f(e,t,n){var i=$.Deferred();return t?(e.isDisplaying()||(p.append(e.render().element()),n.isElementAdded=!0),e.loadSpineItem(t,function(t,n,r,o){t&&o&&(e.meta_height()&&e.meta_width()||console.error("Invalid document "+r.href+": viewport is not specified!"),m.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,n,r)),i.resolve()},n)):(e.isDisplaying()&&e.remove(),i.resolve()),i.promise()}function h(){var e=[];e=y.isLeftToRight()?[C,E,R]:[R,E,C];for(var t=[],n=0,i=e.length;i>n;n++)e[n].isDisplaying()&&t.push(e[n]);return t}_.extend(this,Backbone.Events);var p,g,m=this,v=e.$viewport,y=e.spine,S=e.userStyles,w=(e.bookStyles,e.zoom||{style:"default"}),b=(e.iframeLoader,void 0),C=t("fixed-page-frame-left"),R=t("fixed-page-frame-right"),E=t("fixed-page-frame-center"),x=[];x.push(C),x.push(R),x.push(E);var I,T,N=new ReadiumSDK.Models.Spread(y,!1),D=!1,P=!1;this.isReflowable=function(){return!1},this.setZoom=function(e){w=e,l(!1)},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("fixed_book_frame",{});return p=$(e),_.each(["-webkit-","-moz-","-ms-",""],function(e){p.css(e+"transition","all 0 ease 0")}),p.css("overflow","hidden"),v.append(p),m.applyStyles(),this},this.remove=function(){p.remove()},this.setViewSettings=function(e){b=e,N.setSyntheticSpread(1==ReadiumSDK.Helpers.deduceSyntheticSpread(v,n(),b));for(var t=h(),i=0,r=t.length;r>i;i++)t[i].setViewSettings(e)};var O=function(e,t){C&&C.updatePageSwitchDir(e,t),R&&R.updatePageSwitchDir(e,t),E&&E.updatePageSwitchDir(e,t)};this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(S.getStyles(),p.parent()),d(),c(),l()},this.applyBookStyles=function(){for(var e=h(),t=0,n=e.length;n>t;t++)e[t].applyBookStyles()},this.onViewportResize=function(){var e=n();if(e){var t=1==ReadiumSDK.Helpers.deduceSyntheticSpread(v,e,b);if(a(e,t)){N.setSyntheticSpread(t);var i=new ReadiumSDK.Models.PageOpenRequest(e,m);m.openPage(i)}else l(!0)}},this.getViewScale=function(){return g},this.openPage=function(e,t){if(e.spineItem){var n=N.leftItem,r=N.rightItem,o=N.centerItem,a=1==ReadiumSDK.Helpers.deduceSyntheticSpread(v,e.spineItem,b);N.setSyntheticSpread(a),N.openItem(e.spineItem);var s=n!==N.leftItem||r!==N.rightItem||o!==N.centerItem;(null===t||"undefined"==typeof t)&&(t=0),O(0===t?0:N.spine.isRightToLeft()?1===t?2:1:t,s),i(e.initiator,e)}},this.openPagePrev=function(e){N.openPrev(),O(N.spine.isRightToLeft()?2:1,!0),i(e,void 0)},this.openPageNext=function(e){N.openNext(),O(N.spine.isRightToLeft()?1:2,!0),i(e,void 0)},this.getPaginationInfo=function(){for(var e=new ReadiumSDK.Models.CurrentPagesInfo(y,!0),t=[N.leftItem,N.rightItem,N.centerItem],n=0;n<t.length;n++){var i=t[n];i&&e.addOpenPage(0,1,i.idref,i.index)}return e},this.bookmarkCurrentPage=function(){var e=h();if(e.length>0){var t=e[0].currentSpineItem().idref,n=e[0].getFirstVisibleElementCfi();return void 0==n&&(n=""),new ReadiumSDK.Models.BookmarkData(t,n)}return new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){return N.validItems()},this.getElement=function(e,t){for(var n=h(),i=0,r=n.length;r>i;i++){var o=n[i];if(o.currentSpineItem()==e)return o.getElement(e,t)}return void console.error("spine item is not loaded")},this.getElementById=function(e,t){for(var n=h(),i=0,r=n.length;r>i;i++){var o=n[i];if(o.currentSpineItem()==e)return o.getElementById(e,t)}return void console.error("spine item is not loaded")},this.getElementByCfi=function(e,t,n,i,r){for(var o=h(),a=0,s=o.length;s>a;a++){var l=o[a];if(l.currentSpineItem()==e)return l.getElementByCfi(e,t,n,i,r)}return void console.error("spine item is not loaded")},this.getFirstVisibleMediaOverlayElement=function(){for(var e=h(),t=0,n=e.length;n>t;t++){var i=e[t].getFirstVisibleMediaOverlayElement();if(i)return i}return void 0},this.insureElementVisibility=function(){}},define("fixedView",["readiumSDK","onePageView","currentPagesInfo","fixedPageSpread","bookmarkData"],function(e){return function(){var t;return t||e.fixedView}}(this)),ReadiumSDK.Views.ReflowableView=function(e){function t(e){S.css("left",e.left+"px"),S.css("top",e.top+"px"),S.css("right",e.right+"px"),S.css("bottom",e.bottom+"px")}function n(){S&&S.remove();var e=ReadiumSDK.Helpers.loadTemplate("reflowable_book_page_frame",{}),t=$(e);t=b.append(t),S=$("#reflowable-content-frame",t),C=$("#epubContentIframe",t),C.css("left",""),C.css("right",""),C.css("position","relative"),C.css("overflow","hidden"),w=new ReadiumSDK.Views.CfiNavigationLogic(S,C,{rectangleBased:!0,paginationInfo:H})}function i(e){if(v!=e){n(),H.pageOffset=0,H.currentSpreadIndex=0,v=e,M=!0;var t=P.package.resolveRelativeUrl(e.href);N.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,C,e),C.css("opacity","0.01"),k.loadIframe(C[0],t,a,N,{spineItem:e})}}function r(){R&&R.css("font-size",L+"%")}function o(){R&&_.each(["-webkit-","-moz-","-ms-",""],function(e){R.css(e+"column-gap",H.columnGap+"px")})}function a(e){if(M=!1,y&&y.spineItem!=v)return void i(y.spineItem);if(!e)return C.css("opacity","1"),void(y=void 0);N.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,C,v);var t=C[0].contentDocument;R=$("html",t),E=$("body",R),x=!1,I=!0,T=void 0;var n=C[0].contentDocument.defaultView||C[0].contentWindow,a=n.getComputedStyle(E[0],null);if(a){I="ltr"===a.direction;var s=void 0;s=a.getPropertyValue?a.getPropertyValue("-webkit-writing-mode")||a.getPropertyValue("-moz-writing-mode")||a.getPropertyValue("-ms-writing-mode")||a.getPropertyValue("-o-writing-mode")||a.getPropertyValue("-epub-writing-mode")||a.getPropertyValue("writing-mode"):a.webkitWritingMode||a.mozWritingMode||a.msWritingMode||a.oWritingMode||a.epubWritingMode||a.writingMode,s&&(T=s.indexOf("-lr")>=0,(s.indexOf("vertical")>=0||s.indexOf("tb-")>=0||s.indexOf("bt-")>=0)&&(x=!0))}I&&("rtl"===E[0].getAttribute("dir")||"rtl"===R[0].getAttribute("dir"))&&(I=!1),P.isLeftToRight()||!I||x||(E[0].setAttribute("dir","rtl"),I=!1,T=!1),H.isVerticalWritingMode=x,f(),C.css("opacity","1"),u(),R.css("height",B.height+"px"),R.css("position","relative"),R.css("margin","0"),R.css("padding","0"),_.each(["-webkit-","-moz-","-ms-",""],function(e){R.css(e+"column-axis",x?"vertical":"horizontal")}),N.applyBookStyles(),g(),r(),o(),N.applyStyles()}function s(){if(y){var e=y;y=void 0,N.openPage(e)}}function l(){var e=-H.pageOffset+"px";if(x)R.css("top",e);else{var t=I||T;R.css("left",t?e:""),R.css("right",t?"":e)}h()}function u(){var e=S.width(),t=S.height();return B.width!==e||B.height!==t?(B.width=e,B.height=t,!0):!1}function c(e,t,n){H.pageOffset=(H.columnWidth+H.columnGap)*H.visibleColumnCount*H.currentSpreadIndex,l(),N.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:N.getPaginationInfo(),initiator:e,spineItem:t,elementId:n})}function d(){var e=550,t=400,n=ReadiumSDK.Helpers.deduceSyntheticSpread(D,v,V),i=n===!1||n===!0;if(0===n&&(n=1),H.visibleColumnCount=n?2:1,x&&(e*=2,n=!1,i=!0,H.visibleColumnCount=1),R){f();var r=parseInt(D.css("border-left-width")),o=parseInt(D.css("border-right-width")),a=H.columnGap/2;a=Math.max(0,a-r);var l=H.columnGap/2;l=Math.max(0,l-o);var d=0;if(V.fontSize){var h=.8*V.fontSize/100;e=Math.floor(e*h),t=Math.floor(t*h)}var p=D.width(),g=p-r-o-a-l;n&&(g=.5*(g-H.columnGap)),g>e?d=Math.floor((g-e)*(n?1:.5)):!i&&t>g&&n&&(n=!1,H.visibleColumnCount=1,g=p-r-o-a-l,g>e&&(d=Math.floor(.5*(g-e)))),b.css({left:d+a+"px",right:d+l+"px"}),u(),C.css("width",B.width+"px"),C.css("height",B.height+"px"),R.css("height",B.height+"px"),R.css("min-height",B.height+"px"),R.css("max-height",B.height+"px"),R.css("margin",0),R.css("padding",0),R.css("border",0),E.css("margin",0),E.css("padding",0);var m=0;try{m=parseInt(E.css("padding-top"))+parseInt(E.css("border-top-width"))+parseInt(E.css("border-bottom-width"))}catch(S){}E.css("min-height","50%"),E.css("max-height",B.height-m+"px"),H.rightToLeft=P.isRightToLeft(),H.columnWidth=Math.round(((x?B.height:B.width)-H.columnGap*(H.visibleColumnCount-1))/H.visibleColumnCount),R.css("width",(x?B.width:H.columnWidth)+"px"),_.each(["-webkit-","-moz-","-ms-",""],function(e){R.css(e+"column-width",H.columnWidth+"px")}),R.css({left:"0",right:"0",top:"0"}),ReadiumSDK.Helpers.triggerLayout(C),H.columnCount=((x?R[0].scrollHeight:R[0].scrollWidth)+H.columnGap)/(H.columnWidth+H.columnGap),H.columnCount=Math.round(H.columnCount);var w=(H.columnCount-1)*H.columnGap,I=((x?R[0].scrollHeight:R[0].scrollWidth)-w)/H.columnCount;I=Math.round(I),I>H.columnWidth&&(console.debug("ADJUST COLUMN"),console.log(H.columnWidth),console.log(I),H.columnWidth=I),H.spreadCount=Math.ceil(H.columnCount/H.visibleColumnCount),H.currentSpreadIndex>=H.spreadCount&&(H.currentSpreadIndex=H.spreadCount-1),y?s():c(N)}}function f(){-1==F&&(F=R.css("opacity"),R.css("opacity","0"))}function h(){-1!=F&&R.css("opacity",F),F=-1}function p(){for(var e=[],t=H.currentSpreadIndex*H.visibleColumnCount,n=0;n<H.visibleColumnCount&&t+n<H.columnCount;n++)e.push(t+n);return e}function g(){if(R){var e;$("img, svg",R).each(function(){e=$(this),e.css("max-width","98%"),e.css("max-height","98%"),e.css("height")||e.css("height","auto"),e.css("width")||e.css("width","auto")})}}function m(){var e=Math.round(H.pageOffset/(H.columnWidth+H.columnGap)),t=e*S.height(),n=t+H.visibleColumnCount*S.height();return{top:t,bottom:n}}_.extend(this,Backbone.Events);var v,y,S,w,b,C,R,E,x,I,T,N=this,D=e.$viewport,P=e.spine,O=e.userStyles,A=e.bookStyles,k=e.iframeLoader,M=!1,L=100,F=-1,B={width:void 0,height:void 0},H={visibleColumnCount:2,columnGap:20,spreadCount:0,currentSpreadIndex:0,columnWidth:void 0,pageOffset:0,columnCount:0};this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("reflowable_book_frame",{});b=$(e),D.append(b);var t=V;return t||(t=new ReadiumSDK.Models.ViewerSettings({})),t.enableGPUHardwareAccelerationCSS3D&&b.css("transform","translateZ(0)"),n(),N},this.remove=function(){b.remove()},this.isReflowable=function(){return!0},this.onViewportResize=function(){u()&&d()};var V=void 0;this.setViewSettings=function(e){V=e,H.columnGap=e.columnGap,L=e.fontSize,r(),o(),u(),d()},this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(O.getStyles(),b.parent());var e=ReadiumSDK.Helpers.Margins.fromElement(b);t(e.padding),u(),d()},this.applyBookStyles=function(){R&&ReadiumSDK.Helpers.setStyles(A.getStyles(),R)},this.openPage=function(e){if(M)return void(y=e);if(e.spineItem&&e.spineItem!=v)return y=e,void i(e.spineItem);var t=void 0;if(void 0!==e.spineItemPageIndex)t=e.spineItemPageIndex;else if(e.elementId)t=w.getPageForElementId(e.elementId);else if(e.elementCfi)try{t=w.getPageForElementCfi(e.elementCfi,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])}catch(n){t=0,console.error(n)}else e.firstPage?t=0:e.lastPage?t=H.columnCount-1:(console.debug("No criteria in pageRequest"),t=0);t>=0&&t<H.columnCount?(H.currentSpreadIndex=Math.floor(t/H.visibleColumnCount),c(e.initiator,e.spineItem,e.elementId)):console.log("Illegal pageIndex value: ",t,"column count is ",H.columnCount)},this.openPagePrev=function(e){if(v)if(H.currentSpreadIndex>0)H.currentSpreadIndex--,c(e);else{var t=P.prevItem(v,!0);if(t){var n=new ReadiumSDK.Models.PageOpenRequest(t,e);n.setLastPage(),N.openPage(n)}}},this.openPageNext=function(e){if(v)if(H.currentSpreadIndex<H.spreadCount-1)H.currentSpreadIndex++,c(e);else{var t=P.nextItem(v,!0);if(t){var n=new ReadiumSDK.Models.PageOpenRequest(t,e);n.setFirstPage(),N.openPage(n)}}},this.getFirstVisibleElementCfi=function(){var e=m();return w.getFirstVisibleElementCfi(e)},this.getPaginationInfo=function(){var e=new ReadiumSDK.Models.CurrentPagesInfo(P,!1);if(!v)return e;for(var t=p(),n=0,i=t.length;i>n;n++)e.addOpenPage(t[n],H.columnCount,v.idref,v.index);return e},this.bookmarkCurrentPage=function(){return v?new ReadiumSDK.Models.BookmarkData(v.idref,N.getFirstVisibleElementCfi()):new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){return[v]},this.getElementByCfi=function(e,t,n,i,r){return e!=v?void console.error("spine item is not loaded"):w.getElementByCfi(t,n,i,r)},this.getElementById=function(e,t){return e!=v?void console.error("spine item is not loaded"):w.getElementById(t)},this.getElement=function(e,t){return e!=v?void console.error("spine item is not loaded"):w.getElement(t)},this.getFirstVisibleMediaOverlayElement=function(){var e=m();return w.getFirstVisibleMediaOverlayElement(e)},this.insureElementVisibility=function(e,t,n){var i=$(t);if(!w.isElementVisible(i,m())){var r=w.getPageForElement(i);if(-1!=r){var o=new ReadiumSDK.Models.PageOpenRequest(v,n);o.setPageIndex(r);var a=t.id;a||(a=t.getAttribute("id")),a&&o.setElementId(a),N.openPage(o)}}}},define("reflowableView",["readiumSDK","cfiNavigationLogic","bookmarkData"],function(e){return function(){var t;return t||e.reflowableView}}(this)),ReadiumSDK.Models.SmilIterator=function(e){function t(e,n,i){for(var r=e,o=n.children.length;r>=0&&o>r;r+=i?-1:1){var a=n.children[r];if("par"==a.nodeType)return a;if(a=t(i?a.children.length-1:0,a,i))return a}return n.parent?t(n.index+(i?-1:1),n.parent,i):void 0}this.smil=e,this.currentPar=void 0,this.reset=function(){this.currentPar=t(0,this.smil,!1)},this.findTextId=function(e){if(!this.currentPar)return void console.debug("Par iterator is out of range");if(!e)return!1;for(;this.currentPar;){if(this.currentPar.element){if(e===this.currentPar.text.srcFragmentId)return!0;for(var t=this.currentPar.element.parentNode;t;){if(t.id&&t.id==e)return!0;t=t.parentNode}var n=$("#"+ReadiumSDK.Helpers.escapeJQuerySelector(e),this.currentPar.element);if(n&&n.length&&n[0])return!0}this.next()}return!1},this.next=function(){return this.currentPar?void(this.currentPar=t(this.currentPar.index+1,this.currentPar.parent,!1)):void console.debug("Par iterator is out of range")},this.previous=function(){return this.currentPar?void(this.currentPar=t(this.currentPar.index-1,this.currentPar.parent,!0)):void console.debug("Par iterator is out of range")},this.isLast=function(){return this.currentPar?t(this.currentPar.index+1,this.currentPar.parent,!1)?!1:!0:void console.debug("Par iterator is out of range")},this.goToPar=function(e){for(;this.currentPar&&this.currentPar!=e;)this.next()},this.reset()},define("smilIterator",["readiumSDK"],function(e){return function(){var t;return t||e.smilIterator}}(this)),ReadiumSDK.Views.MediaOverlayDataInjector=function(e,t){this.attachMediaOverlayData=function(n,i,r){var o=n[0].contentDocument.documentElement;if(i.media_overlay_id||0!==e.smil_models.length){var a=$("body",o);if(0==a.length)console.error("! BODY ???");else{var s=a.data("mediaOverlayClick");if(s)console.error("[WARN] already mediaOverlayClick");else{a.data("mediaOverlayClick",{ping:"pong"});var l="ontouchstart"in document.documentElement?"touchstart":"click";a.bind(l,function(e){var n=$(this)[0];if(n=e.target,!n)return t.touchInit(),!0;var i=void 0,o=n,a=!1;for("a"===o.nodeName.toLowerCase()&&(a=!0);!(i=$(o).data("mediaOverlayData"))&&("a"===o.nodeName.toLowerCase()&&(a=!0),o=o.parentNode););if(i&&(i.par||i.pars)){if(!r.mediaOverlaysEnableClick)return console.log("MO CLICK DISABLED"),t.touchInit(),!0;if(a)return console.log("MO CLICKED LINK"),t.touchInit(),!0;var s=i.par?i.par:i.pars[0];if(i.pars&&"undefined"!=typeof rangy){var l=!1;t.isPlayingCfi()&&(l=!0,t.pause());try{var u=rangy.positionFromPoint(e.pageX,e.pageY,n.ownerDocument);s=void 0;for(var c=0;c<i.pars.length;c++){var d=i.pars[c],f="epubcfi("+d.cfi.partialStartCfi+")",h=EPUBcfi.getTextTerminusInfoWithPartialCFI(f,n.ownerDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),p="epubcfi("+d.cfi.partialEndCfi+")",g=EPUBcfi.getTextTerminusInfoWithPartialCFI(p,n.ownerDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),m=rangy.createRange(n.ownerDocument);if(m.setStartAndEnd(h.textNode[0],h.textOffset,g.textNode[0],g.textOffset),m.isPointInRange(u.node,u.offset)){s=d;break}}}catch(v){console.error(v)}if(!s)return l&&t.toggleMediaOverlay(),!0}return o&&o!=n&&"body"===o.nodeName.toLowerCase()&&s&&!s.getSmil().id?(t.touchInit(),!0):(t.playUserPar(s),!0)}var y=$(n).attr("ibooks:readaloud");if(y||(y=$(n).attr("epub:readaloud")),y){console.debug("MO readaloud attr: "+y);var S=t.isPlaying();if("start"===y&&!S||"stop"===y&&S||"startstop"===y)return t.toggleMediaOverlay(),!0}return t.touchInit(),!0})}}var u=e.getSmilBySpineItem(i);if(!u)return void console.error("NO SMIL?? "+i.idref+" /// "+i.media_overlay_id);var c=function(e){if(e){if(e.nodeType&&"seq"===e.nodeType&&e.textref){var t=e.textref.split("#"),r=t[0],o=2===t.length?t[1]:"";if(r&&o){var a=ReadiumSDK.Helpers.ResolveContentRef(r,u.href),s=a===i.href;s&&(e.element=n[0].contentDocument.getElementById(o),e.element||console.error("seq.textref !element? "+e.textref))}}if(e.children&&e.children.length)for(var l=0;l<e.children.length;l++){var d=e.children[l];c(d)}}};c(u);for(var d=new ReadiumSDK.Models.SmilIterator(u),f="/99!",h="epubcfi";d.currentPar;){d.currentPar.element=void 0,d.currentPar.cfi=void 0;var p=ReadiumSDK.Helpers.ResolveContentRef(d.currentPar.text.srcFile,d.smil.href),g=p===i.href;if(g){var m=!d.currentPar.text.srcFragmentId||0==d.currentPar.text.srcFragmentId.length,v=0==d.currentPar.text.srcFragmentId.indexOf(h)?void 0:d.currentPar.text.srcFragmentId,y=void 0,S=!1;if(m||v)y=m?a:$(n[0].contentDocument.getElementById(v));else if(0===d.currentPar.text.srcFragmentId.indexOf(h)){var w=d.currentPar.text.srcFragmentId.substr(h.length+1,d.currentPar.text.srcFragmentId.length-h.length-2);0===w.indexOf(f)&&(w=w.substr(f.length,w.length-f.length));var b=w.split(",");if(b&&3===b.length)try{var C=b[0]+b[1],R="epubcfi("+C+")",E=EPUBcfi.getTextTerminusInfoWithPartialCFI(R,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),x=b[0]+b[2],I="epubcfi("+x+")",T=(EPUBcfi.getTextTerminusInfoWithPartialCFI(I,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),E.textNode[0].parentNode);d.currentPar.cfi={smilTextSrcCfi:d.currentPar.text.srcFragmentId,partialRangeCfi:w,partialStartCfi:C,partialEndCfi:x,cfiTextParent:T},S=!0,y=$(T);var N=y.data("mediaOverlayData");if(N){N.par&&(console.error("[WARN] non-CFI MO DATA already exists!"),N.par=void 0);var D=!1;if(N.pars)for(var P=0;P<N.pars.length;P++){var _=N.pars[P];_===d.currentPar&&(D=!0,console.error("[WARN] mediaOverlayData CFI PAR already registered!"))}else N.pars=[];D||N.pars.push(d.currentPar)}else N={pars:[d.currentPar]},y.data("mediaOverlayData",N)}catch(O){console.error(O)}else try{var A="epubcfi("+w+")";y=EPUBcfi.getTargetElementWithPartialCFI(A,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])}catch(O){console.error(O)}}else console.error("SMIL text@src CFI fragment identifier scheme not supported: "+d.currentPar.text.srcFragmentId);if(y&&y.length>0){if(!S){d.currentPar.element&&d.currentPar.element!==y[0]&&console.error("DIFFERENT ELEMENTS??! "+d.currentPar.text.srcFragmentId+" /// "+d.currentPar.element.id);var k=y[0].nodeName?y[0].nodeName.toLowerCase():void 0;("audio"===k||"video"===k)&&y.attr("preload","auto"),d.currentPar.element=y[0];var N=y.data("mediaOverlayData");N&&(console.error("[WARN] MO DATA already exists."),N.par&&N.par!==d.currentPar&&console.error("DIFFERENT PARS??!")),y.data("mediaOverlayData",{par:d.currentPar})}}else console.error("!! CANNOT FIND ELEMENT: "+d.currentPar.text.srcFragmentId+" == "+d.currentPar.text.srcFile+" /// "+i.href)}d.next()}}}},define("mediaOvelayDataInjector",["readiumSDK","mediaOverlay","mediaOverlayPlayer","smilModel","spineItem","smilIterator","rangy"],function(e){return function(){var t;return t||e.mediaOvelayDataInjector}}(this)),ReadiumSDK.Views.InternalLinksSupport=function(e){function t(e){var t=e.indexOf("("),n=e.indexOf("!"),i=e.indexOf(")");return-1==n?void 0:(-1==i&&(i=e.length),{spineItemCfi:e.substring(t+1,n),elementCfi:e.substring(n+1,i)})}function n(t,n){var i=e.package().resolveRelativeUrl(n.href),r=t.absoluteTo(i);return r}function i(i,o){var a=n(i,o);if(!a)return void console.error("Unable to resolve "+i.href());var l=i.fragment(),u=a.toString();u=ReadiumSDK.Helpers.RemoveFromString(u,"#"+l),r(u,function(n){if(n){var i=new window.DOMParser,r=i.parseFromString(n,"text/xml"),o=t(l);if(!o)return void console.warn("Unable to split cfi:"+l);var a=EPUBcfi.Interpreter.getContentDocHref("epubcfi("+o.spineItemCfi+")",r);if(a){var u=e.spine().getItemByHref(a);u?e.openSpineItemElementCfi(u.idref,o.elementCfi,s):console.warn("Unable to find spineItem with href="+a)}else console.warn("Unable to find document ref from "+l+" cfi")}})}function r(e,t){$.ajax({isLocal:0===e.indexOf("http")?!1:!0,url:e,dataType:"text",async:!0,success:function(e){t(e)},error:function(n,i,r){console.error("Error when AJAX fetching "+e),console.error(i),console.error(r),t()}})}function o(e){var t=e.filename();return t&&ReadiumSDK.Helpers.EndsWith(t,".opf")}function a(t,n){var i,r=t.filename();if(r){var o=new URI(t,n.href),a=decodeURIComponent(o.pathname()),l=e.spine().getItemByHref(a);if(!l)return void console.error("spine item with href="+a+" not found");i=l.idref}else i=n.idref;var u=t.fragment();e.openSpineItemElementId(i,u,s)}var s=this;this.processLinkElements=function(e,t){var n=e[0].contentDocument;$("a",n).click(function(e){var n;n=e.currentTarget.attributes["xlink:href"]?e.currentTarget.attributes["xlink:href"].value:e.currentTarget.attributes.href.value;var r=!1,s=new URI(n),l=s.is("relative");l?o(s)?(i(s,t),r=!0):(a(s,t),r=!0):(window.open(n,"_blank"),r=!0),r&&(e.preventDefault(),e.stopPropagation())})}},define("internalLinksSupport",["readiumSDK","URIjs"],function(e){return function(){var t;return t||e.internalLinksSupport}}(this)),ReadiumSDK.Views.IFrameLoader=function(){var e=this,t={};this.addIFrameEventListener=function(e,n,i){void 0==t[e]&&(t[e]=[]),t[e].push({callback:n,context:i})},this.updateIframeEvents=function(e){_.each(t,function(t,n){for(var i=0,r=t.length;r>i;i++)$(e.contentWindow).off(n),$(e.contentWindow).on(n,t[i].callback,t[i].context)})},this.loadIframe=function(t,n,i,r,o){t.setAttribute("data-baseUri",t.baseURI),t.setAttribute("data-src",n);var a=new URI(n).absoluteTo(t.baseURI).toString();e._loadIframeWithUri(t,o,a,function(){var e=t.contentDocument||t.contentWindow.document;$("svg",e).load(function(){console.log("loaded")}),i.call(r,!0,o)})},this._loadIframeWithUri=function(t,n,i,r){t.onload=function(){e.updateIframeEvents(t);var n=t.contentWindow.MathJax;if(n){var i=_.once(r);n.Hub.Queue(i)}else r()},t.setAttribute("src",i)}},define("iframeLoader",["readiumSDK"],function(e){return function(){var t;return t||e.iframeLoader}}(this));var EpubAnnotationsModule=function(e,t,n){var i={};i.TextLineInferrer=Backbone.Model.extend({initialize:function(){},inferLines:function(e){for(var t,n,i,r=[],o=e.length,a=0,s=0;o-1>=s;s++){n=e[s],i=!1;for(var l=0;a-1>=l;l++)if(t=r[l],this.includeRectInLine(t,n.top,n.left,n.width,n.height)){this.expandLine(t,n.left,n.top,n.width,n.height),i=!0;break}i||(r.push(this.createNewLine(n.left,n.top,n.width,n.height)),a+=1)}return r},includeRectInLine:function(e,t,n,i,r){return this.rectIsWithinLineVertically(t,r,e.maxTop,e.maxBottom)&&this.rectIsWithinLineHorizontally(n,i,e.left,e.width,e.avgHeight)?!0:!1},rectIsWithinLineVertically:function(e,t,n,i){var r=e+t,o=i-n,a=.75*o/2,s=.75*t/2;return e+=s,r-=s,n+=a,i-=a,e===n&&r===i?!0:n>e&&i>r&&r>n?!0:e>n&&r>i&&i>e?!0:e>n&&i>r?!0:n>e&&r>i?!0:!1},rectIsWithinLineHorizontally:function(e,t,n,i,r){var o=2*r,a=e+t,s=e+i;return n-a>o?!1:e-s>o?!1:!0},createNewLine:function(e,t,n,i){var r=t+i;return{left:e,startTop:t,width:n,avgHeight:i,maxTop:t,maxBottom:r,numRects:1}},expandLine:function(e,t,n,i,r){var o=(e.left+e.width,t+i),a=n+r,s=e.numRects+1,l=e.avgHeight*e.numRects,u=(l+r)/s;return e.avgHeight=u,e.numRects=s,e=this.expandLineVertically(e,n,a),e=this.expandLineHorizontally(e,t,o)},expandLineVertically:function(e,t,n){return t<e.maxTop&&(e.maxTop=t),n>e.maxBottom&&(e.maxBottom=n),e},expandLineHorizontally:function(e,t,n){var i=e.left<=t?e.left:t,r=e.left+e.width,o=r>=n?r:n,a=o-i;return e.left=i,e.width=a,e}}),i.Highlight=Backbone.Model.extend({defaults:{isVisible:!1},initialize:function(){}}),i.HighlightGroup=Backbone.Model.extend({defaults:function(){return{selectedNodes:[],highlightViews:[]}},initialize:function(e){this.set("scale",e.scale),this.constructHighlightViews()},highlightGroupCallback:function(e){var t=this;return"click"===e.type?void t.get("bbPageSetView").trigger("annotationClicked","highlight",t.get("CFI"),t.get("id"),e):"contextmenu"===e.type?void t.get("bbPageSetView").trigger("annotationRightClicked","highlight",t.get("CFI"),t.get("id"),e):void _.each(this.get("highlightViews"),function(t){"mouseenter"===e.type?t.setHoverHighlight():"mouseleave"===e.type&&t.setBaseHighlight()})},constructHighlightViews:function(){var e,t,n=this,r=[];_.each(this.get("selectedNodes"),function(e){var t,n=document.createRange();n.selectNodeContents(e),t=n.getClientRects(),_.each(t,function(e){r.push(e)})}),e=new i.TextLineInferrer,t=e.inferLines(r);var o=this.get("scale");_.each(t,function(e){var t=e.startTop/o,r=e.left/o,a=e.avgHeight/o,s=e.width/o,l=new i.HighlightView({CFI:n.get("CFI"),top:t+n.get("offsetTopAddition"),left:r+n.get("offsetLeftAddition"),height:a,width:s,styles:n.get("styles"),highlightGroupCallback:n.highlightGroupCallback,callbackContext:n});n.get("highlightViews").push(l)})},resetHighlights:function(e,t,n){t&&this.set({offsetTopAddition:t}),n&&this.set({offsetLeftAddition:n}),this.destroyCurrentHighlights(),this.constructHighlightViews(),this.renderHighlights(e)},destroyCurrentHighlights:function(){_.each(this.get("highlightViews"),function(e){e.remove(),e.off()}),this.get("highlightViews").length=0},renderHighlights:function(e){_.each(this.get("highlightViews"),function(t){$(e).append(t.render())})},toInfo:function(){return{id:this.get("id"),type:"highlight",CFI:this.get("CFI")}},setStyles:function(e){var t=this.get("highlightViews");this.set({styles:e}),_.each(t,function(t){t.setStyles(e)})}}),i.Underline=Backbone.Model.extend({defaults:{isVisible:!1},initialize:function(){}}),i.UnderlineGroup=Backbone.Model.extend({defaults:function(){return{selectedNodes:[],underlineViews:[]}},initialize:function(){this.constructUnderlineViews()},underlineGroupCallback:function(e){var t=this;return"click"===e.type?void t.get("bbPageSetView").trigger("annotationClicked","underline",t.get("CFI"),t.get("id"),e):void _.each(this.get("underlineViews"),function(t){"mouseenter"===e.type?t.setHoverUnderline():"mouseleave"===e.type&&t.setBaseUnderline()})},constructUnderlineViews:function(){var e,t,n=this,r=[];_.each(this.get("selectedNodes"),function(e){var t,n=document.createRange();n.selectNodeContents(e),t=n.getClientRects(),_.each(t,function(e){r.push(e)})}),e=new i.TextLineInferrer,t=e.inferLines(r),_.each(t,function(e){var t=e.startTop,r=e.left,o=e.avgHeight,a=e.width,s=new i.UnderlineView({CFI:n.get("CFI"),top:t+n.get("offsetTopAddition"),left:r+n.get("offsetLeftAddition"),height:o,width:a,styles:n.get("styles"),underlineGroupCallback:n.underlineGroupCallback,callbackContext:n});n.get("underlineViews").push(s)})},resetUnderlines:function(e,t,n){t&&this.set({offsetTopAddition:t}),n&&this.set({offsetLeftAddition:n}),this.destroyCurrentUnderlines(),this.constructUnderlineViews(),this.renderUnderlines(e)},destroyCurrentUnderlines:function(){_.each(this.get("underlineViews"),function(e){e.remove(),e.off()}),this.get("underlineViews").length=0},renderUnderlines:function(e){_.each(this.get("underlineViews"),function(t){$(e).append(t.render())})},toInfo:function(){return{id:this.get("id"),type:"underline",CFI:this.get("CFI")}},setStyles:function(e){var t=this.get("underlineViews");this.set({styles:e}),_.each(t,function(t){t.setStyles(e)})}}),i.Bookmark=Backbone.Model.extend({defaults:{isVisible:!1,bookmarkCenteringAdjustment:15,bookmarkTopAdjustment:45},initialize:function(){},getAbsoluteTop:function(){var e=$(this.get("targetElement")).offset().top,t=this.get("offsetTopAddition")+e-this.get("bookmarkTopAdjustment");return t},getAbsoluteLeft:function(){var e=$(this.get("targetElement")).offset().left,t=this.get("offsetLeftAddition")+e-this.get("bookmarkCenteringAdjustment");return t},toInfo:function(){return{id:this.get("id"),type:"bookmark",CFI:this.get("CFI")}}}),i.ReflowableAnnotations=Backbone.Model.extend({initialize:function(){this.epubCFI=EPUBcfi,this.annotations=new i.Annotations({offsetTopAddition:0,offsetLeftAddition:0,readerBoundElement:$("html",this.get("contentDocumentDOM"))[0],scale:0,bbPageSetView:this.get("bbPageSetView")});var e=this.get("annotationCSSUrl");e&&this.injectAnnotationCSS(e);var t=$(this.get("contentDocumentDOM")),n=this;t.on("mouseup",function(e){var t=n.getCurrentSelectionRange();void 0!==t&&t.startOffset-t.endOffset&&n.annotations.get("bbPageSetView").trigger("textSelectionEvent",e)})},redraw:function(){var e=-this.getPaginationLeftOffset();this.annotations.redrawAnnotations(0,e)},removeHighlight:function(e){return this.annotations.removeHighlight(e)},addHighlight:function(e,t,n,i){var r,o,a,s,l,u=this.getRangeStartMarker(e,t),c=this.getRangeEndMarker(e,t),d=$(this.get("contentDocumentDOM")),f=$("html",d).css("-webkit-transform"),h=new WebKitCSSMatrix(f).a;this.set("scale",h);try{return r=this.epubCFI.injectRangeElements(e,this.get("contentDocumentDOM"),u,c,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),a=r.startElement.nextSibling?r.startElement.nextSibling:r.startElement,s=r.endElement.previousSibling?r.endElement.previousSibling:r.endElement,o=document.createRange(),o.setStart(a,0),o.setEnd(s,s.length),selectionInfo=this.getSelectionInfo(o),l=-this.getPaginationLeftOffset(),"highlight"===n?(this.annotations.set("scale",this.get("scale")),this.annotations.addHighlight(e,selectionInfo.selectedElements,t,0,l,r.startElement,r.endElement,i)):"underline"===n&&this.annotations.addUnderline(e,selectionInfo.selectedElements,t,0,l,i),{CFI:e,selectedElements:selectionInfo.selectedElements}}catch(p){console.log(p.message)}},addBookmark:function(e,t,n){var i,r,o=this.getBookmarkMarker(e,t);try{return i=this.epubCFI.injectElement(e,this.get("contentDocumentDOM"),o,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),r=-this.getPaginationLeftOffset(),this.annotations.addBookmark(e,i[0],t,0,r,n),{CFI:e,selectedElements:i[0]}}catch(a){console.log(a.message)}},addImageAnnotation:function(e,t){{var n;this.getBookmarkMarker(e,t)}try{return n=this.epubCFI.getTargetElement(e,this.get("contentDocumentDOM"),["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),this.annotations.addImageAnnotation(e,n[0],t),{CFI:e,selectedElements:n[0]}}catch(i){console.log(i.message)}},getCurrentSelectionCFI:function(){var e,t=this.getCurrentSelectionRange();return t&&(selectionInfo=this.getSelectionInfo(t),e=selectionInfo.CFI),e},getCurrentSelectionOffsetCFI:function(){var e,t=this.getCurrentSelectionRange();return t&&(e=this.generateCharOffsetCFI(t)),e},addSelectionHighlight:function(e,t,n){var i,r,o,a,s="/99!",l=this.getCurrentSelectionRange();if(l)return o=this.getSelectionInfo(l),i=o.CFI,r="epubcfi("+s+i+")","highlight"===t?a=this.addHighlight(r,e,t,n):"underline"===t&&(a=this.addHighlight(r,e,t,n)),a.CFI=i,a;throw new Error("Nothing selected")},addSelectionBookmark:function(e,t){var n,i,r,o="/99!",a=this.getCurrentSelectionRange();if(a)return n=this.generateCharOffsetCFI(a),i="epubcfi("+o+n+")",r=this.addBookmark(i,e,t),r.CFI=n,r;throw new Error("Nothing selected")},addSelectionImageAnnotation:function(e){var t,n,i,r,o,a="/99!",s=this.getCurrentSelectionRange();if(s)return i=this.getSelectionInfo(s,["img"]),o=i.selectedElements[0],t=this.epubCFI.generateElementCFIComponent(o,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),n="epubcfi("+a+t+")",r=this.addImageAnnotation(n,e),r.CFI=t,r;throw new Error("Nothing selected")},updateAnnotationView:function(e,t){var n=this.annotations.updateAnnotationView(e,t);return n},getSelectionInfo:function(e,t){var n=this.generateRangeCFI(e),i={startElementFound:!1,endElementFound:!1},r=[];
if(!t)var t=["text"];return this.findSelectedElements(e.commonAncestorContainer,e.startContainer,e.endContainer,i,r,t),{CFI:n,selectedElements:r}},generateRangeCFI:function(e){var t,n,i,r=e.startContainer,o=e.endContainer;if(r.nodeType===Node.TEXT_NODE&&o.nodeType===Node.TEXT_NODE)return t=e.startOffset,n=e.endOffset,i=this.epubCFI.generateCharOffsetRangeComponent(r,t,o,n,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);throw new Error("Selection start and end must be text nodes")},generateCharOffsetCFI:function(e){var t,n=e.startContainer,i=e.startOffset;return n.nodeType===Node.TEXT_NODE&&(t=this.epubCFI.generateCharacterOffsetCFIComponent(n,i,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])),t},findSelectedElements:function(e,t,n,i,r,o){return e===t&&(i.startElementFound=!0),i.startElementFound===!0&&this.addElement(e,r,o),e===n?void(i.endElementFound=!0):void(e.firstChild&&(this.findSelectedElements(e.firstChild,t,n,i,r,o),i.endElementFound)||e.nextSibling&&(this.findSelectedElements(e.nextSibling,t,n,i,r,o),i.endElementFound))},addElement:function(e,t,n){_.each(n,function(n){"text"===n?e.nodeType===Node.TEXT_NODE&&t.push(e):$(e).is(n)&&t.push(e)})},getCurrentSelectionRange:function(){var e,t=this.get("contentDocumentDOM");return t.getSelection?(e=t.getSelection(),e&&e.rangeCount&&e.anchorOffset!==e.focusOffset?e.getRangeAt(0):void 0):t.selection?t.selection.createRange():void 0},getPaginationLeftOffset:function(){var e=$("html",this.get("contentDocumentDOM")),t=e.css("left"),n=parseInt(t.replace("px",""));return n},getBookmarkMarker:function(e,t){return"<span class='bookmark-marker cfi-marker' id='"+t+"' data-cfi='"+e+"'></span>"},getRangeStartMarker:function(e,t){return"<span class='range-start-marker cfi-marker' id='start-"+t+"' data-cfi='"+e+"'></span>"},getRangeEndMarker:function(e,t){return"<span class='range-end-marker cfi-marker' id='end-"+t+"' data-cfi='"+e+"'></span>"},injectAnnotationCSS:function(e){var t=$("head",this.get("contentDocumentDOM"));t.append($("<link/>",{rel:"stylesheet",href:e,type:"text/css"}))}}),i.Annotations=Backbone.Model.extend({defaults:function(){return{bookmarkViews:[],highlights:[],markers:{},underlines:[],imageAnnotations:[],annotationHash:{},offsetTopAddition:0,offsetLeftAddition:0,readerBoundElement:void 0}},initialize:function(){},remove:function(){_.each(this.get("highlights"),function(e){e.remove()})},redrawAnnotations:function(e,t){var n=this;_.each(this.get("highlights"),function(i){i.resetHighlights(n.get("readerBoundElement"),e,t)}),_.each(this.get("bookmarkViews"),function(n){n.resetBookmark(e,t)}),_.each(this.get("underlines"),function(i){i.resetUnderlines(n.get("readerBoundElement"),e,t)})},getBookmark:function(e){var t=this.get("annotationHash")[e];return t?t.bookmark.toInfo():void 0},getHighlight:function(e){var t=this.get("annotationHash")[e];return t?t.toInfo():void 0},getUnderline:function(e){var t=this.get("annotationHash")[e];return t?t.toInfo():void 0},getBookmarks:function(){var e=[];return _.each(this.get("bookmarkViews"),function(t){e.push(t.bookmark.toInfo())}),e},getHighlights:function(){var e=[];return _.each(this.get("highlights"),function(t){e.push(t.toInfo())}),e},getUnderlines:function(){var e=[];return _.each(this.get("underlines"),function(t){e.push(t.toInfo())}),e},getImageAnnotations:function(){var e=[];return _.each(this.get("imageAnnotations"),function(t){e.push(t.toInfo())}),e},addBookmark:function(e,t,n,r,o,a){r||(r=this.get("offsetTopAddition")),o||(o=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var s=new i.BookmarkView({CFI:e,targetElement:t,offsetTopAddition:r,offsetLeftAddition:o,id:n.toString(),bbPageSetView:this.get("bbPageSetView"),type:a});this.get("annotationHash")[n]=s,this.get("bookmarkViews").push(s),$(this.get("readerBoundElement")).append(s.render())},removeHighlight:function(e){var t=this.get("annotationHash"),n=this.get("highlights"),i=this.get("markers");if(i[e]){var r=i[e].startMarker,o=i[e].endMarker;r.parentNode.removeChild(r),o.parentNode.removeChild(o),delete i[e],delete t[e],n=_.reject(n,function(t){return t.id==e?(t.destroyCurrentHighlights(),!0):!1}),this.set("highlights",n)}},addHighlight:function(e,t,n,r,o,a,s,l){r||(r=this.get("offsetTopAddition")),o||(o=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var u=new i.HighlightGroup({CFI:e,selectedNodes:t,offsetTopAddition:r,offsetLeftAddition:o,styles:l,id:n,bbPageSetView:this.get("bbPageSetView"),scale:this.get("scale")});this.get("annotationHash")[n]=u,this.get("highlights").push(u),this.get("markers")[n]={startMarker:a,endMarker:s},u.renderHighlights(this.get("readerBoundElement"))},addUnderline:function(e,t,n,r,o,a){r||(r=this.get("offsetTopAddition")),o||(o=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var s=new i.UnderlineGroup({CFI:e,selectedNodes:t,offsetTopAddition:r,offsetLeftAddition:o,styles:a,id:n,bbPageSetView:this.get("bbPageSetView")});this.get("annotationHash")[n]=s,this.get("underlines").push(s),s.renderUnderlines(this.get("readerBoundElement"))},addImageAnnotation:function(e,t,n){n=n.toString(),this.validateAnnotationId(n);var r=new i.ImageAnnotation({CFI:e,imageNode:t,id:n,bbPageSetView:this.get("bbPageSetView")});this.get("annotationHash")[n]=r,this.get("imageAnnotations").push(r),r.render()},updateAnnotationView:function(e,t){var n=this.get("annotationHash")[e];return n.setStyles(t),n},validateAnnotationId:function(e){if(this.get("annotationHash")[e])throw new Error("That annotation id already exists; annotation not added")}}),i.BookmarkView=Backbone.View.extend({el:"<div></div>",events:{mouseenter:"setHoverBookmark",mouseleave:"setBaseBookmark",click:"clickHandler"},initialize:function(e){this.bookmark=new i.Bookmark({CFI:e.CFI,targetElement:e.targetElement,offsetTopAddition:e.offsetTopAddition,offsetLeftAddition:e.offsetLeftAddition,id:e.id,bbPageSetView:e.bbPageSetView,type:e.type})},resetBookmark:function(e,t){e&&this.bookmark.set({offsetTopAddition:e}),t&&this.bookmark.set({offsetLeftAddition:t}),this.setCSS()},render:function(){return this.setCSS(),this.el},setCSS:function(){var e,t;"comment"===this.bookmark.get("type")?(e=this.bookmark.getAbsoluteTop(),t=this.bookmark.getAbsoluteLeft(),this.$el.css({top:e+"px",left:t+"px",width:"50px",height:"50px",position:"absolute"}),this.$el.addClass("comment")):this.$el.addClass("bookmark")},setHoverBookmark:function(e){e.stopPropagation(),this.$el.hasClass("comment")&&(this.$el.removeClass("comment"),this.$el.addClass("hover-comment"))},setBaseBookmark:function(e){e.stopPropagation(),this.$el.hasClass("hover-comment")&&(this.$el.removeClass("hover-comment"),this.$el.addClass("comment"))},clickHandler:function(e){e.stopPropagation();var t;t="comment"===this.bookmark.get("type")?"comment":"bookmark",this.bookmark.get("bbPageSetView").trigger("annotationClicked",t,this.bookmark.get("CFI"),this.bookmark.get("id"),this.$el.css("top"),this.$el.css("left"),e)}}),i.HighlightView=Backbone.View.extend({el:"<div class='highlight'></div>",events:{mouseenter:"highlightEvent",mouseleave:"highlightEvent",click:"highlightEvent",contextmenu:"highlightEvent"},initialize:function(e){this.highlight=new i.Highlight({CFI:e.CFI,top:e.top,left:e.left,height:e.height,width:e.width,styles:e.styles,highlightGroupCallback:e.highlightGroupCallback,callbackContext:e.callbackContext})},render:function(){return this.setCSS(),this.el},resetPosition:function(e,t,n,i){this.highlight.set({top:e,left:t,height:n,width:i}),this.setCSS()},setStyles:function(e){this.highlight.set({styles:e}),this.render()},setCSS:function(){var e=this.highlight.get("styles")||{};this.$el.css({top:this.highlight.get("top")+"px",left:this.highlight.get("left")+"px",height:this.highlight.get("height")+"px",width:this.highlight.get("width")+"px","background-color":e.fill_color||"normal"})},setBaseHighlight:function(){this.$el.addClass("highlight"),this.$el.removeClass("hover-highlight")},setHoverHighlight:function(){this.$el.addClass("hover-highlight"),this.$el.removeClass("highlight")},highlightEvent:function(e){e.stopPropagation();var t=(this.highlight.get("highlightGroupCallback"),this.highlight.get("callbackContext"));t.highlightGroupCallback(e)}}),i.UnderlineView=Backbone.View.extend({el:"<div class='underline-range'>              <div class='transparent-part'></div>              <div class='underline-part'></div>           </div>",events:{mouseenter:"underlineEvent",mouseleave:"underlineEvent",click:"underlineEvent"},initialize:function(e){this.underline=new i.Underline({CFI:e.CFI,top:e.top,left:e.left,height:e.height,width:e.width,styles:e.styles,underlineGroupCallback:e.underlineGroupCallback,callbackContext:e.callbackContext}),this.$transparentElement=$(".transparent-part",this.$el),this.$underlineElement=$(".underline-part",this.$el)},render:function(){return this.setCSS(),this.el},resetPosition:function(e,t,n,i){this.underline.set({top:e,left:t,height:n,width:i}),this.setCSS()},setStyles:function(e){this.underline.set({styles:e}),this.render()},setCSS:function(){var e=this.underline.get("styles")||{};this.$el.css({top:this.underline.get("top")+"px",left:this.underline.get("left")+"px",height:this.underline.get("height")+"px",width:this.underline.get("width")+"px"}),this.$underlineElement.css({"background-color":e.fill_color||"normal"}),this.$underlineElement.addClass("underline")},underlineEvent:function(e){e.stopPropagation();var t=(this.underline.get("underlineGroupCallback"),this.underline.get("callbackContext"));t.underlineGroupCallback(e)},setBaseUnderline:function(){this.$underlineElement.addClass("underline"),this.$underlineElement.removeClass("hover-underline")},setHoverUnderline:function(){this.$underlineElement.addClass("hover-underline"),this.$underlineElement.removeClass("underline")}}),i.ImageAnnotation=Backbone.Model.extend({initialize:function(){var e=this,t=$(this.get("imageNode"));t.on("mouseenter",function(){e.setMouseenterBorder()}),t.on("mouseleave",function(){e.setMouseleaveBorder()}),t.on("click",function(){e.get("bbPageSetView").trigger("annotationClicked","image",e.get("CFI"),e.get("id"),event)})},render:function(){this.setCSS()},setCSS:function(){$(this.get("imageNode")).css({border:"5px solid rgb(255, 0, 0)",border:"5px solid rgba(255, 0, 0, 0.2)","-webkit-background-clip":"padding-box","background-clip":"padding-box"})},setMouseenterBorder:function(){$(this.get("imageNode")).css({border:"5px solid rgba(255, 0, 0, 0.4)"})},setMouseleaveBorder:function(){$(this.get("imageNode")).css({border:"5px solid rgba(255, 0, 0, 0.2)"})}});var r=new i.ReflowableAnnotations({contentDocumentDOM:e,bbPageSetView:t,annotationCSSUrl:n});return{addSelectionHighlight:function(e,t,n){return r.addSelectionHighlight(e,t,n)},addSelectionBookmark:function(e,t){return r.addSelectionBookmark(e,t)},addSelectionImageAnnotation:function(e){return r.addSelectionImageAnnotation(e)},addHighlight:function(e,t,n,i){return r.addHighlight(e,t,n,i)},addBookmark:function(e,t,n){return r.addBookmark(e,t,n)},addImageAnnotation:function(e,t){return r.addImageAnnotation(e,t)},updateAnnotationView:function(e,t){return r.updateAnnotationView(e,t)},redraw:function(){return r.redraw()},getBookmark:function(e){return r.annotations.getBookmark(e)},getBookmarks:function(){return r.annotations.getBookmarks()},getHighlight:function(e){return r.annotations.getHighlight(e)},getHighlights:function(){return r.annotations.getHighlights()},getUnderline:function(e){return r.annotations.getUnderline(e)},getUnderlines:function(){return r.annotations.getUnderlines()},getImageAnnotation:function(){},getImageAnnotations:function(){},removeAnnotation:function(e){return r.remove(e)},getCurrentSelectionCFI:function(){return r.getCurrentSelectionCFI()},getCurrentSelectionOffsetCFI:function(){return r.getCurrentSelectionOffsetCFI()},removeHighlight:function(e){return r.removeHighlight(e)}}};define("annotations_module",["epubCfi"],function(e){return function(){var t;return t||e.annotations_module}}(this)),ReadiumSDK.Views.AnnotationsManager=function(e,t){function n(e){var t=new RegExp("^.*!"),n=e.replace(t,""),i=n.substring(0,n.length-1);return i}var i=this,r={},o={},a=e,s=t.annotationCSSUrl;s||console.warn("WARNING! Annotations CSS not supplied. Highlighting is not going to work."),_.extend(i,Backbone.Events),this.on("all",function(){var e=Array.prototype.slice.call(arguments),t="annotationClicked";if(e.length&&e[0]===t)for(var s in r){var l=e[4],u=e[3],c=e[2],d=e[1];if(r[s].getHighlight(u)){var f=o[s].idref,h=n(c);e=[t,d,f,h,u,l]}}i.trigger.apply(a,e)}),this.attachAnnotations=function(e,t){var n=e[0].contentDocument;r[t.index]=new EpubAnnotationsModule(n,i,s),o[t.index]=t;for(var a in r)Math.abs(a-a.index)>3&&delete r[a]},this.getCurrentSelectionCfi=function(){for(var e in r){var t=r[e],n=t.getCurrentSelectionCFI();if(n)return{idref:o[e].idref,cfi:n}}return void 0},this.addSelectionHighlight=function(e,t){for(spine in r){var n=r[spine];if(n.getCurrentSelectionCFI()){var i=n.addSelectionHighlight(e,t);return i.idref=o[spine].idref,i}}return void 0},this.addHighlight=function(e,t,i,a,s){for(var l in r)if(o[l].idref===e){var u="epubcfi(/99!"+t+")",c=r[l],d=c.addHighlight(u,i,a,s);return d.idref=e,d.CFI=n(d.CFI),d}return void 0},this.removeHighlight=function(e){var t=void 0;for(var n in r){var i=r[n];t=i.removeHighlight(e)}return t}},define("annotationsManager",["epubCfi","annotations_module"],function(e){return function(){var t;return t||e.annotationsManager}}(this)),ReadiumSDK.Models.Trigger=function(e){var t=$(e);this.action=t.attr("action"),this.ref=t.attr("ref"),this.event=t.attr("ev:event"),this.observer=t.attr("ev:observer"),this.ref=t.attr("ref")},ReadiumSDK.Models.Trigger.register=function(e){$("trigger",e).each(function(){var t=new ReadiumSDK.Models.Trigger(this);t.subscribe(e)})},ReadiumSDK.Models.Trigger.prototype.subscribe=function(e){var t="#"+this.observer,n=this;$(t,e).on(this.event,function(){n.execute(e)})},ReadiumSDK.Models.Trigger.prototype.execute=function(e){var t=$("#"+ReadiumSDK.Helpers.escapeJQuerySelector(this.ref),e);switch(this.action){case"show":t.css("visibility","visible");break;case"hide":t.css("visibility","hidden");break;case"play":t[0].currentTime=0,t[0].play();break;case"pause":t[0].pause();break;case"resume":t[0].play();break;case"mute":t[0].muted=!0;break;case"unmute":t[0].muted=!1;break;default:console.log("do not no how to handle trigger "+this.action)}},define("triggers",["readiumSDK"],function(e){return function(){var t;return t||e.triggers}}(this)),ReadiumSDK.Views.ScrollView=function(e,t,n){function i(e,t){if(et)return void e();var n=w();if(!n)return void e();var r=L(0),o=M(n);if(r.top-o.bottom>z){var a=T();g(n),l(a-(o.bottom-o.top),void 0),t("updateLoadedViewsTop 1"),i(e,t)}else r.top-o.top<z?d(n,function(n){n?(t("updateLoadedViewsTop 2"),i(e,t)):e()}):e()}function r(e,t){if(et)return void e();var n=b();if(!n)return void e();var i=L(0),o=M(n);o.top-i.bottom>z?(g(n),t("updateLoadedViewsBottom 1"),r(e,t)):o.bottom-i.bottom<z?h(n,function(n){t("updateLoadedViewsBottom 2"),n?r(e,t):e()}):e()}function o(e){if(t){var n=void 0;if(U&&e){var o=e.offset();o&&(n=o.top)}var a=function(t){if(U){if(!n)return;var i=void 0,r=e.offset();if(r&&(i=r.top),!i)return;var o=i-n;Math.abs(o)>1&&console.debug("@@@@@@@@@@@@@@@ SCROLL ADJUST ("+t+") "+o+" -- "+e.currentSpineItem().href)}};tt=!0,r(function(){i(function(){setTimeout(function(){tt=!1},X+100)},a)},a)}}function a(){var e=n.viewerSettings();e.mediaOverlaysPreservePlaybackWhenScroll||!rt&&n.isMediaOverlayAvailable()&&(rt=n.isPlayingMediaOverlay(),rt&&n.pauseMediaOverlay())}function s(){if(!tt&&!nt&&!it){o(),I(J);var e=n.viewerSettings();e.mediaOverlaysPreservePlaybackWhenScroll||rt&&setTimeout(function(){n.playMediaOverlay(),rt=!1},100)}}function l(e,t){W[0].scrollTop=e,t&&I(t.initiator,t.spineItem,t.elementId)}function u(e){var t=T(),n=M(e);f(e);var i=M(e),r=i.bottom-i.top,o=n.bottom-n.top,a=r-o;Math.abs(a)>0&&(U&&console.debug("IMMEDIATE SCROLL ADJUST: "+e.currentSpineItem().href+" == "+a),l(t+a))}function c(e,t,n,i,r,o,a,s){if(!ReadiumSDK.Helpers.isIframeAlive(n))return U&&console.log("reachStableContentHeight ! win && doc (iFrame disposed?)"),void(s&&s(!1));var l=10,c=300,d=n.contentWindow,h=n.contentDocument,p=parseInt(Math.round(parseFloat(d.getComputedStyle(h.documentElement).height))),g=p;0===e?u(t):f(t);var m=function(r){return U&&r!==l&&console.log("tryAgainFunc - "+r+": "+i+"  <"+g+" -- "+p+">"),r--,0>r?(U&&console.error("tryAgainFunc abort: "+i),void(s&&s(!0))):void setTimeout(function(){try{if(!ReadiumSDK.Helpers.isIframeAlive(n))return U&&console.log("tryAgainFunc ! win && doc (iFrame disposed?)"),void(s&&s(!1));var o=n.contentWindow,l=n.contentDocument,c=parseInt(Math.round(parseFloat(window.getComputedStyle(n).height))),d=parseInt(Math.round(parseFloat(o.getComputedStyle(l.documentElement).height)));if(p!==d)return p=d,void m(r);var h=c-d;if(Math.abs(h)>4){if(U&&(console.log("$$$ IFRAME HEIGHT ADJUST: "+i+"  ["+h+"]<"+g+" -- "+p+">"),console.log(a)),0===e?u(t):f(t),!ReadiumSDK.Helpers.isIframeAlive(n))return U&&console.log("tryAgainFunc ! win && doc (iFrame disposed?)"),void(s&&s(!1));var o=n.contentWindow,l=n.contentDocument,v=parseInt(Math.round(parseFloat(o.getComputedStyle(l.documentElement).height))),y=parseInt(Math.round(parseFloat(window.getComputedStyle(n).height))),S=y-v;if(Math.abs(S)>4)return U&&(console.error("## IFRAME HEIGHT ADJUST: "+i+"  ["+S+"]<"+g+" -- "+p+">"),console.log(a)),void m(r);U&&console.log(">> IFRAME HEIGHT ADJUSTED OKAY: "+i+"  ["+h+"]<"+g+" -- "+p+">")}}catch(w){return console.error(w),void(s&&s(!1))}s&&s(!0)},c)};m(l)}function d(e,t){var n=Z.prevItem(e.currentSpineItem(),!0);if(!n)return void t(!1);var i=v(!0),r=b();i.element().insertAfter(r.element()),i.loadSpineItem(n,function(r){if(r){f(i);var o=M(i);g(i);var a=T(),s=v(),u=o.bottom-o.top;s.setHeight(u),s.element().insertBefore(e.element()),a+=u,l(a,void 0),s.loadSpineItem(n,function(e,i,r,o,a){if(e){var l=function(n){C(s,e,i,r,o,a),t(n)};c(0,s,i[0],r.href,r.isFixedLayout(),r.isFixedLayout()?s.meta_width():0,"addToTopOf",l)}else console.error("Unable to open 2 "+n.href),g(s),t(!1)})}else console.error("Unable to open 1 "+n.href),g(i),t(!1)})}function f(e){e.currentSpineItem().isFixedLayout()?e.scaleToWidth(W.width()):e.resizeIFrameToContent()}function h(e,t){var n=Z.nextItem(e.currentSpineItem(),!0);if(!n)return void t(!1);var i=(T(),v());i.element().insertAfter(e.element()),i.loadSpineItem(n,function(e,r,o,a,s){if(e){var l=function(n){C(i,e,r,o,a,s),t(n)};c(2,i,r[0],o.href,o.isFixedLayout(),o.isFixedLayout()?i.meta_width():0,"addToBottomOf",l)}else console.error("Unable to load "+n.href),t(!1)})}function p(){var e=[];S(function(t){e.push(t)},!1);for(var t=0,n=e.length;n>t;t++)g(e[t])}function g(e){e.element().remove()}function m(e){W.css("left",e.left),W.css("top",e.top),W.css("right",e.right),W.css("bottom",e.bottom)}function v(n){e.disablePageTransitions=!0;var i=new ReadiumSDK.Views.OnePageView(e,["content-doc-frame"],!0);return i.render(),ot&&i.setViewSettings(ot),n||i.element().data("pageView",i),t&&i.decorateIframe(),i}function y(e,t){var n=void 0;return S(function(t){return t.currentSpineItem()==e?(n=t,!1):!0},t),n}function S(e,t){for(var n=W.children(),i=n.length,r=t?function(e){return e-1}:function(e){return e+1},o=t?function(e){return e>=0}:function(e){return i>e},a=t?i-1:0,s=a;o(s);s=r(s)){var l=n.eq(s),u=l.data("pageView");if(u&&e(u)===!1)return}}function w(){var e=void 0;return S(function(t){return e=t,!1},!1),e}function b(){var e=void 0;return S(function(t){return e=t,!1},!0),e}function C(e,t,n,i,r){t&&r&&J.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,n,i)}function R(e,t){p();var n=(T(),v());W.append(n.element()),n.loadSpineItem(e,function(e,i,r,o,a){if(e){var s=function(){C(n,e,i,r,o,a),t(n)};c(1,n,i[0],r.href,r.isFixedLayout(),r.isFixedLayout()?n.meta_width():0,"openPage",s)}else console.error("Unable to load "+r.href),g(n),n=void 0;t(n)})}function E(e,t){var n,i,r,o,a=0;if(void 0!==t.scrollTop)a=t.scrollTop;else if(void 0!==t.spineItemPageIndex){var s;n=x(),s=t.spineItemPageIndex<0?0:t.spineItemPageIndex>=n?n-1:t.spineItemPageIndex,a=s*D()}else if(e&&t.elementId){if(o=M(e),r=e.getNavigator(),i=r.getElementById(t.elementId),!i||!i.length)return void console.warn("Element id="+t.elementId+" not found!");if(H(e,i,60))return void I(t.initiator,t.spineItem,t.elementId);a=r.getVerticalOffsetForElement(i)+o.top}else if(e&&t.elementCfi){if(o=M(e),r=e.getNavigator(),i=r.getElementByCfi(t.elementCfi),!i||!i.length)return void console.warn("Element cfi="+t.elementCfi+" not found!");if(H(e,i,60))return void I(t.initiator,t.spineItem,t.elementId);a=r.getVerticalOffsetForElement(i)+o.top}else if(t.firstPage)a=0;else if(t.lastPage){if(n=x(),0===n)return;a=P()-D()-5}else e?(o=M(e),a=o.top):a=0;T()!=a?(nt=!0,l(a,t),setTimeout(function(){nt=!1},X+100)):I(t.initiator,t.spineItem,t.elementId)}function x(){return Math.ceil(P()/D())}function I(e,t,n){J.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:J.getPaginationInfo(),initiator:e,spineItem:t,elementId:n})}function T(){return W[0].scrollTop}function N(){return P()-(T()+D())}function D(){return W.height()}function P(){return W[0].scrollHeight}function O(){var e=[],t=L(-G);return S(function(n){if(k(n,t))e.push(n);else if(e.length>0)return!1;return!0},!1),e}function A(){var e=O();return e[0]}function k(e,t){var n=M(e);return B(F(n,t))>0}function M(e){var t={top:0,bottom:0};return t.top=e.element().position().top+T(),t.bottom=t.top+e.getCalculatedPageHeight(),t}function L(e){0===e||e||(e=0);var t={top:T()-e,bottom:T()+D()+e};return t.top<0&&(t.top=0),t.bottom>P()&&(t.bottom=P()),t}function F(e,t){return{top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)}}function B(e){return e.bottom<e.top?0:e.bottom-e.top}function H(e,t,n){var i=K(e,t);return V(i,n)}function V(e,t){var n=L(),i=Math.min(B(n),B(e));0===i&&(i=5);var r=F(n,e),o=B(r)/i*100;return o>=t}function K(e,t){var n=M(e),i={top:0,bottom:0};return i.top=t.offset().top+n.top,i.bottom=i.top+t.height(),i}var U=!1;_.extend(this,Backbone.Events);var j,W,q,G=5,z=2e3,X=300,J=this,Y=e.$viewport,Z=e.spine,Q=e.userStyles,et=!1,tt=!1,nt=!1,it=!1;this.isContinuousScroll=function(){return t},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("scrolled_book_frame",{});q=$(e),Y.append(q),W=$("#scrolled-content-frame",q),W.css("overflow",""),W.css("overflow-y","auto"),W.css("overflow-x","hidden"),W.css("-webkit-overflow-scrolling","touch"),W.css("width","100%"),W.css("height","100%"),W.css("position","relative");var t=ot;t||(t=new ReadiumSDK.Models.ViewerSettings({})),t.enableGPUHardwareAccelerationCSS3D&&W.css("transform","translateZ(0)"),J.applyStyles();var n=_.debounce(s,X);return W.on("scroll",function(e){n(e),a()}),J};var rt=!1;this.remove=function(){q.remove()},this.onViewportResize=function(){W&&(S(function(e){f(e)},!1),I(J),o())};var ot=void 0;this.setViewSettings=function(e){ot=e,S(function(t){t.setViewSettings(e)},!1)},this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(Q.getStyles(),q.parent());var e=ReadiumSDK.Helpers.Margins.fromElement(q);m(e.padding)},this.applyBookStyles=function(){S(function(e){e.applyBookStyles()},!1)},this.openPage=function(e){et=!0;var t=function(e,t){j=void 0,E(e,t),et=!1,o(e)};if(e.spineItem){var n=y(e.spineItem);n?t(n,e):(j=e,it=!0,R(e.spineItem,function(n){setTimeout(function(){it=!1},X+100),n&&j?n.currentSpineItem()===j.spineItem?t(n,j):J.openPage(j):I(e.initiator,e.spineItem,e.elementId)}))}else t(void 0,e)},this.openPageNext=function(e){var t;N()>0&&(t=new ReadiumSDK.Models.PageOpenRequest(void 0,e),t.scrollTop=T()+Math.min(N(),D()-G),E(void 0,t))},this.openPagePrev=function(e){var t;T()>0&&(t=new ReadiumSDK.Models.PageOpenRequest(void 0,e),t.scrollTop=T()-(D()-G),t.scrollTop<0&&(t.scrollTop=0),E(void 0,t))},this.getFirstVisibleElementCfi=function(){var e=A();return e?e.getNavigator().getFirstVisibleElementCfi(T()):void 0},this.getPaginationInfo=function(){for(var e,t,n,i,r,o,a,s,l=L(),u=l.bottom-l.top,c=new ReadiumSDK.Models.CurrentPagesInfo(Z,!1),d=O(),f=0,h=d.length;h>f;f++)n=d[f],e=n.currentSpineItem(),i=M(n),r=Math.max(l.top-i.top,0),o=Math.max(i.bottom-l.bottom,0),a=Math.ceil(r/u),s=Math.ceil(o/u),t=a+s+1,c.addOpenPage(a,t,e.idref,e.index);return c},this.bookmarkCurrentPage=function(){var e=A();return e?new ReadiumSDK.Models.BookmarkData(e.currentSpineItem().idref,J.getFirstVisibleElementCfi()):new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){var e=[];return S(function(t){e.push(t.currentSpineItem())},!1),e},this.getElement=function(e,t){var n=void 0;return S(function(i){return i.currentSpineItem()==e?(n=i.getNavigator().getElement(t),!1):!0},!1),n},this.getElementByCfi=function(e,t,n,i,r){var o=void 0;return S(function(a){return a.currentSpineItem()==e?(o=a.getElementByCfi(e,t,n,i,r),!1):!0},!1),o?o:void console.error("spine item is not loaded")},this.getElementById=function(e,t){var n=void 0;return S(function(i){return i.currentSpineItem()==e?(n=i.getNavigator().getElementById(t),!1):!0},!1),n?n:void console.error("spine item is not loaded")},this.getFirstVisibleMediaOverlayElement=function(){var e,t=L(),n=void 0,i={top:0,bottom:0},r=!1;return S(function(o){if(e=M(o),i.top=Math.max(e.top,t.top)-e.top,i.bottom=Math.min(e.bottom,t.bottom)-e.top,B(i)>0){if(r=!0,n=o.getNavigator().getFirstVisibleMediaOverlayElement(i))return!1}else if(r)return!1;return!0},!1),n},this.insureElementVisibility=function(e,t,n){var i=void 0;if(S(function(t){return t.currentSpineItem().idref===e?(i=t,!1):!0},!1),!i)return void console.warn("Page for element "+t+" not found");var r=$(t),o=K(i,r);if(!V(o,60)){var a=Z.getItemById(e),s=new ReadiumSDK.Models.PageOpenRequest(a,n);s.scrollTop=o.top,J.openPage(s)}}},define("scrollView",["readiumSDK","cfiNavigationLogic","bookmarkData","triggers","onePageView"],function(e){return function(){var t;return t||e.scrollView}}(this)),ReadiumSDK.Models.Switches=function(){},ReadiumSDK.Models.Switches.apply=function(e){function t(e){var t=e.attributes["required-namespace"];if(!t)return console.log("Encountered a case statement with no required-namespace"),!1;var n=["http://www.w3.org/1998/Math/MathML"];return _.include(n,t)}$("switch",e).each(function(){var e=!1;$("case",this).each(function(){!e&&t(this)?e=!0:$(this).remove()}),e&&$("default",this).remove()})},define("switches",["readiumSDK"],function(e){return function(){var t;return t||e.switches}}(this)),ReadiumSDK.Views.ReaderView=function(e){function t(e){return"scroll-doc"==m.scroll?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:"scroll-continuous"==m.scroll?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:e.isFixedLayout()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:e.isFlowScrolledDoc()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:e.isFlowScrolledContinuous()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED}function n(e,n){var r=t(e);if(h){if(f.getCurrentViewType()==r)return void n(!1);i()}var o={$viewport:d,spine:g,userStyles:v,bookStyles:y,iframeLoader:c};h=f.createViewForType(r,o),f.trigger(ReadiumSDK.Events.READER_VIEW_CREATED,r),h.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(e,t){if(ReadiumSDK.Helpers.isIframeAlive(e[0])){u.attachMediaOverlayData(e,t,m),S.processLinkElements(e,t),w.attachAnnotations(e,t);var n=e[0].contentDocument;ReadiumSDK.Models.Trigger.register(n),ReadiumSDK.Models.Switches.apply(n),f.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,e,t)}}),h.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,function(e,t){f.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,e,t)}),h.on(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,function(e){l.onPageChanged(e),f.trigger(ReadiumSDK.Events.PAGINATION_CHANGED,e)}),h.on(ReadiumSDK.Events.FXL_VIEW_RESIZED,function(){f.trigger(ReadiumSDK.Events.FXL_VIEW_RESIZED)}),h.render(),h.setViewSettings(m),setTimeout(function(){n(!0)},50)}function i(){h&&(f.trigger(ReadiumSDK.Events.READER_VIEW_DESTROYED),h.off(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED),h.remove(),h=void 0)}function r(e){f.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_STATUS_CHANGED,e)}function o(e){if(!e)return void console.log("idref parameter value missing!");var t=g.getItemById(e);return t?t:void console.log("Spine item with id "+e+" not found!")}function a(e,t){n(e.spineItem,function(n){n||h.setViewSettings(m),h.openPage(e,t)})}function s(e){ReadiumSDK.Helpers.setStyles(v.getStyles(),d),l&&l.applyStyles(),e||h&&h.applyStyles()}_.extend(this,Backbone.Events);var l,u,c,d,f=this,h=void 0,p=void 0,g=void 0,m=new ReadiumSDK.Models.ViewerSettings({}),v=new ReadiumSDK.Collections.StyleCollection,y=new ReadiumSDK.Collections.StyleCollection,S=new ReadiumSDK.Views.InternalLinksSupport(this),w=new ReadiumSDK.Views.AnnotationsManager(f,e),b=_.debounce(function(){f.handleViewportResize()},200,!1);$(window).on("resize.ReadiumSDK.readerView",_.bind(b,f)),e.el instanceof $?(d=e.el,console.log("** EL is a jQuery selector:"+e.el.attr("id"))):(d=$(e.el),console.log("** EL is a string:"+d.attr("id"))),c=e.iframeLoader?e.iframeLoader:new ReadiumSDK.Views.IFrameLoader({mathJaxUrl:e.mathJaxUrl}),this.createViewForType=function(e,t){var n;switch(e){case ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:n=new ReadiumSDK.Views.FixedView(t,f);break;case ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:n=new ReadiumSDK.Views.ScrollView(t,!1,f);break;case ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:n=new ReadiumSDK.Views.ScrollView(t,!0,f);break;default:n=new ReadiumSDK.Views.ReflowableView(t,f)}return n},this.getCurrentViewType=function(){return h?h instanceof ReadiumSDK.Views.ReflowableView?ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED:h instanceof ReadiumSDK.Views.FixedView?ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:h instanceof ReadiumSDK.Views.ScrollView?h.isContinuousScroll()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:void console.error("Unrecognized view type"):void 0},this.getLoadedSpineItems=function(){return h?h.getLoadedSpineItems():[]},this.viewerSettings=function(){return m},this.package=function(){return p},this.spine=function(){return g},this.userStyles=function(){return v},this.openBook=function(e){var t=e.package?e.package:e;p=new ReadiumSDK.Models.Package(t),g=p.spine,g.handleLinear(!0),l&&l.reset(),l=new ReadiumSDK.Views.MediaOverlayPlayer(f,$.proxy(r,f)),l.setAutomaticNextSmil(m.mediaOverlaysAutomaticPageTurn?!0:!1),u=new ReadiumSDK.Views.MediaOverlayDataInjector(p.media_overlay,l),i(),e.settings&&f.updateSettings(e.settings),e.styles&&f.setStyles(e.styles);var n=void 0;e.openPageRequest&&(e.openPageRequest.idref||e.openPageRequest.contentRefUrl&&e.openPageRequest.sourceFileHref?n=e.openPageRequest:console.log("Invalid page request data: idref required!"));var o=!1;if(n){n=e.openPageRequest;try{o=n.idref?n.spineItemPageIndex?!f.openSpineItemPage(n.idref,n.spineItemPageIndex,f):n.elementCfi?!f.openSpineItemElementCfi(n.idref,n.elementCfi,f):!f.openSpineItemPage(n.idref,0,f):!f.openContentUrl(n.contentRefUrl,n.sourceFileHref,f)}catch(s){console.error("openPageRequest fail: fallback to first page!"),console.log(s),o=!0}}else o=!0;if(o){var c=g.first();if(c){var d=new ReadiumSDK.Models.PageOpenRequest(c,f);d.setFirstPage(),a(d,0)}}},this.openPageLeft=function(){p.spine.isLeftToRight()?f.openPagePrev():f.openPageNext()},this.openPageRight=function(){p.spine.isLeftToRight()?f.openPageNext():f.openPagePrev()},this.isCurrentViewFixedLayout=function(){return h instanceof ReadiumSDK.Views.FixedView},this.setZoom=function(e){f.isCurrentViewFixedLayout()&&h.setZoom(e)},this.getViewScale=function(){return f.isCurrentViewFixedLayout()?100*h.getViewScale():100},this.updateSettings=function(e){if(m.update(e),l&&l.setAutomaticNextSmil(m.mediaOverlaysAutomaticPageTurn?!0:!1),h&&!e.doNotUpdateView){var t=h.bookmarkCurrentPage();
if(t&&t.idref){var i=!1;h.isReflowable&&h.isReflowable()&&(i=f.isPlayingMediaOverlay(),i&&f.pauseMediaOverlay());var r=g.getItemById(t.idref);n(r,function(e){e||h.setViewSettings(m),f.openSpineItemElementCfi(t.idref,t.contentCFI,f),i&&f.playMediaOverlay(),f.trigger(ReadiumSDK.Events.SETTINGS_APPLIED)})}}f.trigger(ReadiumSDK.Events.SETTINGS_APPLIED)},this.openPageNext=function(){if(f.getCurrentViewType()===ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS)return void h.openPageNext(f);var e=h.getPaginationInfo();if(0!=e.openPages.length){var t=e.openPages[e.openPages.length-1];if(t.spineItemPageIndex<t.spineItemPageCount-1)return void h.openPageNext(f);var n=g.getItemById(t.idref),i=g.nextItem(n);if(i){var r=new ReadiumSDK.Models.PageOpenRequest(i,f);r.setFirstPage(),a(r,2)}}},this.openPagePrev=function(){if(f.getCurrentViewType()===ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS)return void h.openPagePrev(f);var e=h.getPaginationInfo();if(0!=e.openPages.length){var t=e.openPages[0];if(t.spineItemPageIndex>0)return void h.openPagePrev(f);var n=g.getItemById(t.idref),i=g.prevItem(n);if(i){var r=new ReadiumSDK.Models.PageOpenRequest(i,f);r.setLastPage(),a(r,1)}}},this.openSpineItemElementCfi=function(e,t,n){var i=o(e);if(!i)return!1;var r=new ReadiumSDK.Models.PageOpenRequest(i,n);return t&&r.setElementCfi(t),a(r,0),!0},this.openPageIndex=function(e,t){if(!h)return!1;var n,i=g.items[e];if(!i)return!1;if(p.isFixedLayout()){var i=g.items[e];if(!i)return!1;n=new ReadiumSDK.Models.PageOpenRequest(i,t),n.setPageIndex(0)}else{var r=this.getLoadedSpineItems();r.length>0&&(n=new ReadiumSDK.Models.PageOpenRequest(r[0],t),n.setPageIndex(e))}return a(n,0),!0},this.openSpineItemPage=function(e,t,n){var i=o(e);if(!i)return!1;var r=new ReadiumSDK.Models.PageOpenRequest(i,n);return t&&r.setPageIndex(t),a(r,0),!0},this.setStyles=function(e,t){for(var n=e.length,i=0;n>i;i++)e[i].declarations?v.addStyle(e[i].selector,e[i].declarations):v.removeStyle(e[i].selector);s(t)},this.setBookStyles=function(e){for(var t=e.length,n=0;t>n;n++)y.addStyle(e[n].selector,e[n].declarations);h&&h.applyBookStyles()},this.getElement=function(e,t){return h?h.getElement(e,t):void 0},this.getElementById=function(e,t){return h?h.getElementById(e,t):void 0},this.getElementByCfi=function(e,t,n,i,r){return h?h.getElementByCfi(e,t,n,i,r):void 0},this.mediaOverlaysOpenContentUrl=function(e,t,n){l.mediaOverlaysOpenContentUrl(e,t,n)},this.openContentUrl=function(e,t,n){var i,r,o=ReadiumSDK.Helpers.ResolveContentRef(e,t),a=o.indexOf("#");a>=0?(i=o.substr(0,a),r=o.substr(a+1)):(i=o,r=void 0);var s=g.getItemByHref(i);if(!s){console.warn("spineItem "+i+" not found");var l=decodeURIComponent(i);if(s=g.getItemByHref(l),!s)return console.warn("decoded spineItem "+l+" missing as well"),!1}return f.openSpineItemElementId(s.idref,r,n)},this.openSpineItemElementId=function(e,t,n){var i=g.getItemById(e);if(!i)return!1;var r=new ReadiumSDK.Models.PageOpenRequest(i,n);return t&&r.setElementId(t),a(r,0),!0},this.bookmarkCurrentPage=function(){return JSON.stringify(h.bookmarkCurrentPage())},this.clearStyles=function(){v.resetStyleValues(),s(),v.clear()},this.clearBookStyles=function(){h&&(y.resetStyleValues(),h.applyBookStyles()),y.clear()},this.isMediaOverlayAvailable=function(){return l?l.isMediaOverlayAvailable():!1},this.toggleMediaOverlay=function(){l.toggleMediaOverlay()},this.nextMediaOverlay=function(){l.nextMediaOverlay()},this.previousMediaOverlay=function(){l.previousMediaOverlay()},this.escapeMediaOverlay=function(){l.escape()},this.ttsEndedMediaOverlay=function(){l.onTTSEnd()},this.pauseMediaOverlay=function(){l.pause()},this.playMediaOverlay=function(){l.play()},this.isPlayingMediaOverlay=function(){return l.isPlaying()},this.getFirstVisibleMediaOverlayElement=function(){return h?h.getFirstVisibleMediaOverlayElement():void 0},this.insureElementVisibility=function(e,t,n){h&&h.insureElementVisibility(e,t,n)},this.handleViewportResize=function(){if(h){var e=h.bookmarkCurrentPage();if(h.isReflowable&&h.isReflowable()&&e&&e.idref){var t=f.isPlayingMediaOverlay();t&&f.pauseMediaOverlay();var i=g.getItemById(e.idref);n(i,function(){f.openSpineItemElementCfi(e.idref,e.contentCFI,f),t&&f.playMediaOverlay()})}else{console.debug("RESIZE NO RESTORE BOOKMARK");var t=!1;h.isReflowable&&h.isReflowable()&&(t=f.isPlayingMediaOverlay(),t&&f.pauseMediaOverlay()),h.onViewportResize(),t&&setTimeout(function(){f.playMediaOverlay()},150)}}},this.getCurrentSelectionCfi=function(){return w.getCurrentSelectionCfi()},this.addHighlight=function(e,t,n,i,r){return w.addHighlight(e,t,n,i,r)},this.addSelectionHighlight=function(e,t){return w.addSelectionHighlight(e,t)},this.removeHighlight=function(e){return w.removeHighlight(e)},this.addIFrameEventListener=function(e,t,n){c.addIFrameEventListener(e,t,n)};var C=function(){var e={},t=!1,n=void 0;this.setCallback_PlayPause=function(e){n=e};var i=void 0;this.setCallback_IsAvailable=function(e){i=e},this.playPause=function(e){r(e)};var r=function(t){n&&n(t);try{var i=void 0;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];if(o&&o.active&&(i&&console.error("More than one active iframe?? (pagination)"),i=o.$iframe)){var a=$("audio",i[0].contentDocument);$.each(a,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(t&&this.play?this.play():this.pause&&this.pause(),!0):!0})}}}catch(s){console.error(s)}};this.setPlayState=function(e){t=e},f.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(t,n){try{n&&n.idref&&t&&t[0]&&(e[n.idref]={$iframe:t,href:n.href})}catch(i){console.error(i)}}),f.on(ReadiumSDK.Events.PAGINATION_CHANGED,function(n){var o=!1;try{for(var a in e)if(e.hasOwnProperty(a)){var s=n.spineItem&&n.spineItem.idref===a,l=!1;if(n.paginationInfo&&n.paginationInfo.openPages.length){for(var u=!0,c=0;c<n.paginationInfo.openPages.length;c++)n.paginationInfo.openPages[c].idref===a?l=!0:u=!1;!s&&u&&(s=!0)}if(s||l){var d=e[a];if(!d)continue;e[a].active=s;var f=d.$iframe,h=(d.href,$("audio",f[0].contentDocument));$.each(h,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(this.setAttribute("loop","loop"),this.removeAttribute("autoplay"),s||this.pause&&this.pause(),o=!0,!0):!0})}else e[a]&&(e[a].$iframe=void 0),e[a]=void 0}}catch(p){console.error(p)}i&&i(o),r(o?t?!0:!1:!1)}),f.on(ReadiumSDK.Events.MEDIA_OVERLAY_STATUS_CHANGED,function(n){if(n.smilIndex){var i=f.package(),o=i.media_overlay.smilAt(n.smilIndex);if(o&&o.spineItemId){var a=!1;for(var s in e)if(e.hasOwnProperty(s)){var l=e[s];l&&l.active&&s!==o.spineItemId&&(r(!1),l.active=!1,a=!0)}if(a){for(var s in e)if(e.hasOwnProperty(s)){var l=e[s];l&&(l.active||s===o.spineItemId&&(l.active=!0))}t&&r(!0)}}}})};this.backgroundAudioTrackManager=new C},ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED=1,ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED=2,ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC=3,ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS=4,define("readerView",["backbone","readiumSDK","helpers","viewerSettings","styleCollection","package","mediaOverlayPlayer","pageOpenRequest","fixedView","reflowableView","mediaOvelayDataInjector","internalLinksSupport","iframeLoader","annotationsManager","scrollView","URIjs","triggers","switches"],function(e){return function(){var t;return t||e.readerView}}(this)),define("epub-fetch/markup_parser",[],function(){var e=function(){var e=this;this.parseXml=function(t){return e.parseMarkup(t,"text/xml")},this.parseMarkup=function(e,t){var n=new window.DOMParser;return n.parseFromString(e,t)}};return e}),define("epub-fetch/discover_content_type",["require","module","jquery","backbone","URIjs"],function(e,t,n,i,r){var o=void 0,a=function(){var e=this;a.suffixContentTypeMap={css:"text/css",epub:"application/epub+zip",gif:"image/gif",html:"text/html",jpg:"image/jpeg",jpeg:"image/jpeg",ncx:"application/x-dtbncx+xml",opf:"application/oebps-package+xml",png:"image/png",svg:"image/svg+xml",xhtml:"application/xhtml+xml"},this.identifyContentTypeFromFileName=function(e){var t=r(e).suffix(),n="application/octet-stream";return"undefined"!=typeof a.suffixContentTypeMap[t]&&(n=a.suffixContentTypeMap[t]),n},this.identifyContentType=function(t){var i=n.ajax({type:"HEAD",url:t,async:!1}).getResponseHeader("Content-Type");return null===i&&(i=e.identifyContentTypeFromFileName(t),console.log("guessed contentType ["+i+"] from URI ["+t+"]. Configuring the web server to provide the content type is recommended.")),i}};return o||(o=new a),o}),define("epub-fetch/plain_resource_fetcher",["require","module","jquery","URIjs","./discover_content_type"],function(e,t,n,i,r){var o=function(e,t){function i(e,t,n){var i=s.resolveURI(e);if("undefined"==typeof e)throw"Fetched file relative path is undefined!";var r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType="arraybuffer",r.onerror=n,r.onload=function(){t(r.response)},r.send()}var o,a,s=this;this.initialize=function(n){e.getXmlFileDom("META-INF/container.xml",function(t){a=e.getRootFile(t),o=s.resolveURI(a),n()},function(e){console.error("unable to find package document: "+e),o=t,n()})},this.resolveURI=function(e){return t+"/"+e},this.getPackageUrl=function(){return o},this.fetchFileContentsText=function(e,t,i){var r=s.resolveURI(e);if("undefined"==typeof r)throw"Fetched file URL is undefined!";n.ajax({isLocal:0===r.indexOf("http")?!1:!0,url:r,dataType:"text",async:!0,success:function(e){t(e)},error:function(e,t,n){console.error("Error when AJAX fetching "+r),console.error(t),console.error(n),i(n)}})},this.fetchFileContentsBlob=function(t,n,o){var a=e.getDecryptionFunctionForRelativePath(t);if(a){var s=n;n=function(e){a(e,function(e){s(e)})}}i(t,function(e){var i=new Blob([e],{type:r.identifyContentTypeFromFileName(t)});n(i)},o)},this.getPackageDom=function(t,n){s.fetchFileContentsText(a,function(n){var i=e.markupParser.parseXml(n);t(i)},n)}};return o}),define("epub-fetch/zip_resource_fetcher",["require","module","jquery","URIjs","./discover_content_type"],function(e,t,n,i,r){var o=function(e,t,n){function i(e,i){a?e(a,i):(zip.workerScriptsPath=n,a=new zip.fs.FS,a.importHttpContent(t,!0,function(){e(a,i)},i))}function o(e,n,r){if("undefined"==typeof e)throw"Fetched file relative path is undefined!";i(function(i,r){var o=i.find(e);"undefined"==typeof o||null===o?r(new Error("Entry "+e+" not found in zip "+t)):o.directory?r(new Error("Entry "+e+" is a directory while a file has been expected")):n(o)},r)}var a,s=!1;this.getPackageUrl=function(){return t},this.fetchFileContentsText=function(e,t,n){o(e,function(e){e.getText(t,void 0,s)},n)},this.fetchFileContentsData64Uri=function(e,t,n){o(e,function(n){n.getData64URI(r.identifyContentTypeFromFileName(e),t,void 0,s)},n)},this.fetchFileContentsBlob=function(t,n,i){var a=e.getDecryptionFunctionForRelativePath(t);if(a){var l=n;n=function(e){a(e,function(e){l(e)})}}o(t,function(e){e.getBlob(r.identifyContentTypeFromFileName(t),n,void 0,s)},i)}};return o}),define("epub-fetch/content_document_fetcher",["require","module","jquery","underscore","URIjs","./discover_content_type"],function(e,t,n,i,r,o){var a=function(e,t,a,s){function l(e,t){var n=e.getElementsByTagName("base")[0];if(!n){n=e.createElement("base");var i=e.getElementsByTagName("head")[0];i.insertBefore(n,i.childNodes[0])}n.setAttribute("href",t)}function u(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function c(e,t,i,a,s,l,u){function c(r){n(e).data("epubZipOrigHref",t),n(e).attr(i,r)}var d=new r(t).absoluteTo(E).toString(),f=T.getResourceURL(d);if(f)c(f);else{var h=n.Deferred();s.push(h),x.relativeToPackageFetchFileContents(d,a,function(t){var i=function(t){if("text"===a){var i=o.identifyContentTypeFromFileName(d),r=n(e).attr("type");r&&(i=r),t=new Blob([t],{type:i})}var s=window.URL.createObjectURL(t);T.putResourceURL(d,s),c(s),h.resolve()};u?u(t,d,i):i(t)},l)}}function d(e,t,o,a,s){var l=e[0],c=e.slice(2),d=i.find(c,function(e){return"undefined"!=typeof e}),h=new r(d),p=""===h.scheme();if(p){var g=new r(d).absoluteTo(o).toString(),m=T.getResourceURL(g);if(m)a[l]={isStyleSheetResource:s,resourceObjectURL:m};else{var v=n.Deferred();t.push(v);var y,S,w=function(e){var t=window.URL.createObjectURL(e);a[l]={isStyleSheetResource:s,resourceObjectURL:t},T.putResourceURL(g,t),v.resolve()},b=function(e){u(e),v.resolve()};s?(y="text",S=function(e){f(e,g,function(e){var t=new Blob([e],{type:"text/css"});w(t)})}):(y="blob",S=w),x.relativeToPackageFetchFileContents(g,y,S,b)}}}function f(e,t,i){var r=/[Uu][Rr][Ll]\(\s*([']([^']+)[']|["]([^"]+)["]|([^)]+))\s*\)/g,o=/@[Ii][Mm][Pp][Oo][Rr][Tt]\s*('([^']+)'|"([^"]+)")/g,a={},s=[];[o,r].forEach(function(n){for(var i=n.exec(e);null!=i;){var r=!1;n==o&&(r=!0),d(i,s,t,a,r),i=n.exec(e)}}),s.length>0?n.when.apply(n,s).done(function(){for(var t in a){var n,r=a[t];n=r.isStyleSheetResource?'@import "'+r.resourceObjectURL+'"':"url('"+r.resourceObjectURL+"')";var o=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=new RegExp(o,"g");e=e.replace(s,n,"g")}i(e)}):i(e)}function h(e,t,i,o,a,s){var l=n(e+"["+t+"]",C);l.each(function(e,l){var u=n(l).attr(t),d=new r(u);""===d.scheme()&&c(l,u,t,i,o,a,s)})}function p(e,t){h("img","src","blob",e,t)}function g(e,t){h("audio","src","blob",e,t)}function m(e,t){h("video","src","blob",e,t),h("video","poster","blob",e,t)}function v(e,t){h("script","src","blob",e,t)}function y(e,t){h("iframe","src","blob",e,t)}function S(e,t){h("link","href","text",e,t,f)}function w(e){var t=n("style",C);t.each(function(t,i){var r=n.Deferred();e.push(r);var o=n(i).text();f(o,E,function(e){n(i).text(e),r.resolve()})})}var b,C,R=this,E=t.href,x=e,I=t.media_type,T=s;this.fetchContentDocumentAndResolveDom=function(e,t){x.relativeToPackageFetchFileContents(E,"text",function(n){b=n,R.resolveInternalPackageResources(e,t)},t)},this.resolveInternalPackageResources=function(e,t){C=x.markupParser.parseMarkup(b,I),l(C,a);var i=[];x.shouldFetchMediaAssetsProgrammatically()&&(p(i,t),g(i,t),m(i,t)),y(i,t),v(i,t),S(i,t),w(i,t),n.when.apply(n,i).done(function(){e(C)})}};return a}),define("epub-fetch/resource_cache",[],function(){var e=function(){var e={};this.getResourceURL=function(t){var n=e[t];return n},this.putResourceURL=function(t,n){e[t]=n}};return e}),define("epub-fetch/encryption_handler",["require","module"],function(){var e=function(e){function t(e,t){var n=new FileReader;n.onload=function(){var e=this.result;t(new Uint8Array(e))},n.readAsArrayBuffer(e)}function n(e,n,i,r){var o=e.slice(0,n);t(o,function(t){for(var o=i.length,a=0;n>a;a++)t[a]=t[a]^i[a%o];var s=new Blob([t],{type:e.type}),l=e.slice(n),u=new Blob([s,l],{type:e.type});r(u)})}function i(t,i){var r=1040;n(t,r,e.uidHash,i)}function r(e){var t=/(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i,n=t.exec(e),i=n[2]+n[3]+n[4]+n[5]+n[6];i&&32==i.length||console.error("Bad UUID format for ID :"+e);for(var r=[],o=0;16>o;o++){var a=i.substr(2*o,2),s=parseInt(a,16);r.push(s)}return r}function o(t,i){var o=r(e.uid),a=1024;n(t,a,o,i)}var a=this,s={"http://www.idpf.org/2008/embedding":i,"http://ns.adobe.com/pdf/enc#RC":o};this.isEncryptionSpecified=function(){return e&&e.encryptions},this.getEncryptionMethodForRelativePath=function(t){return a.isEncryptionSpecified()?e.encryptions[t]:void 0},this.getDecryptionFunctionForRelativePath=function(e){var t=a.getEncryptionMethodForRelativePath(e);return t&&s[t]?s[t]:void 0}};return e.CreateEncryptionData=function(e,t){var n={uid:e,uidHash:window.Crypto.SHA1(unescape(encodeURIComponent(e.trim())),{asBytes:!0}),encryptions:void 0},i=$("EncryptedData",t);return i.each(function(e,t){var i=$("EncryptionMethod",t).first().attr("Algorithm"),r=$("CipherReference",t);r.each(function(e,t){var r=$(t).attr("URI");console.log("Encryption/obfuscation algorithm "+i+" specified for "+r),n.encryptions||(n.encryptions={}),n.encryptions[r]=i})}),n},e}),define("epub-fetch/publication_fetcher",["require","module","jquery","URIjs","./markup_parser","./plain_resource_fetcher","./zip_resource_fetcher","./content_document_fetcher","./resource_cache","./encryption_handler"],function(e,t,n,i,r,o,a,s,l,u){var c=function(e,t){function c(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function d(){var t=".epub";return-1===e.indexOf(t,e.length-t.length)}function f(n,i){return n?(console.log("using new PlainResourceFetcher"),g=new o(h,e),void g.initialize(function(){i(g)})):(console.log("using new ZipResourceFetcher"),g=new a(h,e,t),i(g),void 0)}var h=this;h.contentTypePackageReadStrategyMap={"application/oebps-package+xml":"exploded","application/epub+zip":"zipped","application/zip":"zipped"};var p,g,m,v,y,S,w=new l;this.markupParser=new r,this.initialize=function(e){var t=d();p=!t,f(t,e)},this.shouldConstructDomProgrammatically=function(){return p},this.shouldFetchMediaAssetsProgrammatically=function(){return p&&!d()},this.getBookRoot=function(){return e},this.getJsLibRoot=function(){return t},this.getPackageUrl=function(){return g.getPackageUrl()},this.fetchContentDocument=function(e,t,n,i){var r=new s(h,e.spineItem,t,w);r.fetchContentDocumentAndResolveDom(n,function(e){c(e),i(e)})},this.getFileContentsFromPackage=function(e,t,n){g.fetchFileContentsText(e,function(e){t(e)},n)},this.getXmlFileDom=function(e,t,n){h.getFileContentsFromPackage(e,function(e){var n=h.markupParser.parseXml(e);t(n)},n)},this.getPackageFullPath=function(e,t){h.getXmlFileDom("META-INF/container.xml",function(t){var n=h.getRootFile(t);e(n)},t)},this.getRootFile=function(e){var t=n("rootfile",e),i=t.attr("full-path");return i},this.getPackageDom=function(e,t){y?e(y):S?S.done(e):(S=n.Deferred(),S.done(e),h.getPackageFullPath(function(e){v=e,h.getXmlFileDom(e,function(e){y=e,S.resolve(e),S=void 0})},t))},this.convertPathRelativeToPackageToRelativeToBase=function(e){return new i(e).absoluteTo(v).toString()},this.relativeToPackageFetchFileContents=function(e,t,n,i){i||(i=c);var r=decodeURIComponent(h.convertPathRelativeToPackageToRelativeToBase(e));"/"===r.charAt(0)&&(r=r.substr(1));var o=g.fetchFileContentsText;"blob"===t?o=g.fetchFileContentsBlob:"data64uri"===t&&(o=g.fetchFileContentsData64Uri),o.call(g,r,n,i)},this.getRelativeXmlFileDom=function(e,t,n){h.getXmlFileDom(h.convertPathRelativeToPackageToRelativeToBase(e),t,n)},this.setPackageMetadata=function(e,t){h.getXmlFileDom("META-INF/encryption.xml",function(n){var i=u.CreateEncryptionData(e.id,n);m=new u(i),m.isEncryptionSpecified()&&(p=!0),t()},function(){console.log("Document doesn't make use of encryption."),m=new u(void 0),t()})},this.getDecryptionFunctionForRelativePath=function(e){return m.getDecryptionFunctionForRelativePath(e)}};return c}),define("epub-fetch",["epub-fetch/publication_fetcher"],function(e){return e}),define("epub-model/package_document",["require","module","jquery","underscore","backbone","URIjs"],function(e,t,n,i,r,o){var a=function(e,t,i,r,a){function s(){var e=c(),t=e.href,n=t.substr(t.lastIndexOf(".")+1);return"ncx"===n.trim().toLowerCase()}function l(e){var t=n("<ol></ol>");return n.each(e.children("navPoint"),function(e,i){u(n(i),t)}),t}function u(e,t){var i=e.children("navLabel").text().trim(),r=e.children("content").attr("src"),o=n('<li class="nav-elem"></li>').append(n("<a></a>",{href:r,text:i}));if(t.append(o),e.children("navPoint").length>0){var a=n("<li></li>"),s=n("<ol></ol>");n.each(e.children("navPoint"),function(e,t){s.append(u(n(t),s))}),a.append(s),t.append(a)}}function c(){var e=a.getNavItem();if(e)return e;var t=i.ncx;return t&&t.length>0?a.getManifestItemByIdref(t):null}var d;this.manifest=a,this.getSharedJsPackageData=function(){var t=e.substr(0,e.lastIndexOf("/"));return{rootUrl:t,rendition_viewport:i.rendition_viewport,rendition_layout:i.rendition_layout,rendition_orientation:i.rendition_orientation,rendition_flow:i.rendition_flow,rendition_spread:i.rendition_spread,media_overlay:i.media_overlay,spine:{direction:this.getPageProgressionDirection(),items:r}}},this.getSpineItem=function(e){var t=r[e];return t},this.setPageProgressionDirection=function(e){d=e},this.getPageProgressionDirection=function(){return"rtl"===d?"rtl":"default"===d?"default":"ltr"},this.spineLength=function(){return r.length},this.getMetadata=function(){return i},this.getToc=function(){var e=c();return e?e.href:null},this.getTocText=function(e){var n=this.getToc();t.relativeToPackageFetchFileContents(n,"text",function(t){e(t)},function(t){console.error("ERROR fetching TOC from ["+n+"]:"),console.error(t),e(void 0)})},this.getTocDom=function(e){this.getTocText(function(t){if("string"==typeof t){var n=(new DOMParser).parseFromString(t,"text/xml");e(n)}else e(void 0)})},this.generateTocListDOM=function(t){var i=this;this.getTocDom(function(r){if(r)if(s()){var a;a=l(n("navMap",r)),t(a[0])}else{var u=new o(e).absoluteTo(document.URL),c=new o(i.getToc()).absoluteTo(u),d=(n(r).remove("base"),n("<base></base>"));n(d).attr("href",c),n(r).find("head").append(d),t(r)}else t(void 0)})}};return a}),define("epub-model/smil_document_parser",["require","module","jquery","underscore"],function(e,t,n){var i=function(e,t){function r(e){return{id:"",href:"",spineItemId:e.idref,children:[{nodeType:"seq",textref:e.href,children:[{nodeType:"par",children:[{nodeType:"text",src:e.href,srcFile:e.href,srcFragmentId:""}]}]}]}}this.parse=function(i,r,o,a,s,l){var u=this;t.getRelativeXmlFileDom(r.href,function(t){var l=n("smil",t)[0];o.smilVersion=l.getAttribute("version"),o.children=u.getChildren(l),o.href=r.href,o.id=r.id,o.spineItemId=i.idref;var c=e.getMetadata().getMediaItemByRefinesId(r.id);c&&(o.duration=c.duration),s(a,o)},function(e){l(a,e)})};var o=function(e,t,n,i,r){var o=e.split(":"),a=o[o.length-1];"type"===a&&(a="epubtype"),void 0!=t.getAttribute(e)?n[a]=t.getAttribute(e):i&&(void 0!==r?n[a]=r:console.log("Required property "+e+" not found in smil node "+t.nodeName))};this.getChildren=function(e){var t=this,i=[];return n.each(e.childNodes,function(e,n){if(1===n.nodeType){var r=t.createItemFromElement(n);r&&i.push(r)}}),i},this.createItemFromElement=function(e){var t=this,n={};n.nodeType=e.nodeName;var r=!1;if("body"===n.nodeType&&(r=!0,n.nodeType="seq"),"seq"===n.nodeType)o("epub:textref",e,n,!r),o("id",e,n),o("epub:type",e,n),n.children=t.getChildren(e);else if("par"===n.nodeType)o("id",e,n),o("epub:type",e,n),n.children=t.getChildren(e);else if("text"===n.nodeType){o("src",e,n,!0);var a=n.src.split("#");n.srcFile=a[0],n.srcFragmentId=2===a.length?a[1]:"",o("id",e,n)}else{if("audio"!==n.nodeType)return void 0;o("src",e,n,!0),o("id",e,n),n.clipBegin=i.resolveClockValue(e.getAttribute("clipBegin")),n.clipEnd=i.resolveClockValue(e.getAttribute("clipEnd"))}return n},this.fillSmilData=function(t){var i=this;if(e.spineLength()<=0)return void t();for(var o=!0,a=[],s=[],l=0;l<e.spineLength();l++){var u=e.getSpineItem(l);if(u.media_overlay_id){var c=e.manifest.getManifestItemByIdref(u.media_overlay_id);if(!c){console.error("Cannot find SMIL manifest item for spine/manifest item?! "+u.media_overlay_id);continue}var d=n.Deferred();d.media_overlay_id=u.media_overlay_id,s.push(d);var f={};a.push(f),i.parse(u,c,f,d,function(e){o=!1,e.resolve()},function(e,t){console.log("Error when parsing SMIL manifest item "+c.href+":"),console.log(t),e.resolve()})}else a.push(r(u))}n.when.apply(n,s).done(function(){e.getMetadata().setMoMap(a),o&&(console.log("No Media Overlays"),e.getMetadata().setMoMap([])),t()})}};return i.resolveClockValue=function(e){if(!e)return 0;var t=0,n=0,i=0;if(-1!=e.indexOf("min"))n=parseFloat(e.substr(0,e.indexOf("min")));else if(-1!=e.indexOf("ms")){var r=parseFloat(e.substr(0,e.indexOf("ms")));i=r/1e3}else if(-1!=e.indexOf("s"))i=parseFloat(e.substr(0,e.indexOf("s")));else if(-1!=e.indexOf("h"))t=parseFloat(e.substr(0,e.indexOf("h")));else{var o=e.split(":");i=parseFloat(o.pop()),o.length>0&&(n=parseFloat(o.pop()),o.length>0&&(t=parseFloat(o.pop())))}var a=3600*t+60*n+i;return a},i}),define("epub-model/metadata",["require","module","underscore"],function(e,t,n){var i=function(){var e=this,t={};this.eachMediaItem=function(t){return e.mediaItems&&n.each(e.mediaItems,t),this},this.getMediaItemByRefinesId=function(e){return t[e]},this.setMoMap=function(t){e.media_overlay.smil_models=t},this.eachMediaItem(function(e){var n=e.refines,i=n.indexOf("#");if(i>=0){var r=i+1,o=n.length-1;n=n.substr(r,o)}n=n.trim(),t[n]=e})};return i}),define("epub-model/manifest",["require","module","underscore"],function(e,t,n){var i=function(e){var t,i={};this.manifestLength=function(){return e.length},this.getManifestItemByIdref=function(e){return i[e]},this.each=function(t){return n.each(e,t),this},this.getNavItem=function(){return t},this.each(function(e){i[e.id]=e,e.properties&&-1!==e.properties.indexOf("nav")&&(t=e)})};return i}),define("epub-model/package_document_parser",["require","module","jquery","underscore","backbone","epub-fetch/markup_parser","URIjs","./package_document","./smil_document_parser","./metadata","./manifest"],function(e,t,n,i,r,o,a,s,l,u,c){var d=function(e,t){function r(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack))}function a(e,n){var i=new l(e,t);i.fillSmilData(function(){n(e)})}function d(e){var i=n.Deferred();if(e.rendition_layout)i.resolve();else{var r="/META-INF/com.apple.ibooks.display-options.xml";t.relativeToPackageFetchFileContents(r,"text",function(t){if(t){var r=new o,a=r.parseXml(t),s=n("option[name=fixed-layout]",a)[0];if(s){var l=n(s).text();"true"===l&&(e.rendition_layout="pre-paginated",console.log("using com.apple.ibooks.display-options.xml fixed-layout property"))}}i.resolve()},function(){console.log("com.apple.ibooks.display-options.xml not found"),i.resolve()})}return i.promise()}function f(e,t,r){var o,a=[];return o=n(h(e,"spine")).children(),n.each(o,function(e,o){var s=n(o),l=s.attr("idref")?s.attr("idref"):"",u=t.getManifestItemByIdref(l),c=s.attr("id"),d=void 0;i.each(r.rendition_viewports,function(e){return e.refines==c?(d=e.viewport,!0):void 0});var f={rendition_viewport:d,idref:l,href:u.href,manifest_id:u.id,media_type:u.media_type,media_overlay_id:u.media_overlay_id,linear:s.attr("linear")?s.attr("linear"):"",properties:s.attr("properties")?s.attr("properties"):""},h=C(f.properties);i.extend(f,h),a.push(f)}),a}function h(e,t,n){var r=e.getElementsByTagNameNS("*",t);return n?i.find(r,n):r[0]}function p(e,t,n){var r=e.getElementsByTagNameNS("*",t);return i.filter(r,n)}function g(e,t,n){var i=h(e,t,n);return i?i.textContent:""}function m(e,t,n,i){var r=h(e,t,i);return r?r.getAttribute(n):""}function v(e,t){var n=h(e,"meta",function(e){return e.getAttribute("property")===t});return n?n.textContent:""}function y(e){var t=new u,n=h(e,"metadata"),r=h(e,"package"),o=h(e,"spine");t.author=g(n,"creator"),t.description=g(n,"description"),t.epub_version=r.getAttribute("version")?r.getAttribute("version"):"",t.id=g(n,"identifier"),t.language=g(n,"language"),t.modified_date=v(n,"dcterms:modified"),t.ncx=o.getAttribute("toc")?o.getAttribute("toc"):"",t.pubdate=g(n,"date"),t.publisher=g(n,"publisher"),t.rights=g(n,"rights"),t.title=g(n,"title"),t.rendition_orientation=v(n,"rendition:orientation"),t.rendition_layout=v(n,"rendition:layout"),t.rendition_spread=v(n,"rendition:spread"),t.rendition_flow=v(n,"rendition:flow"),t.rendition_viewport=g(n,"meta",function(e){return"rendition:viewport"===e.getAttribute("property")&&!e.hasAttribute("refines")});var a=[],s=p(n,"meta",function(e){return"rendition:viewport"===e.getAttribute("property")&&e.hasAttribute("refines")});i.each(s,function(e){var t=e.getAttribute("refines");if(t){var n=t.indexOf("#");if(n>=0){var i=n+1,r=t.length-1;t=t.substr(i,r)}t=t.trim()}var o={refines:t,viewport:e.textContent};a.push(o)}),t.rendition_viewports=a,t.mediaItems=[];var c=p(n,"meta",function(e){return"media:duration"===e.getAttribute("property")&&e.hasAttribute("refines")});return i.each(c,function(e){t.mediaItems.push({refines:e.getAttribute("refines"),duration:l.resolveClockValue(e.textContent)})}),t.media_overlay={duration:l.resolveClockValue(g(n,"meta",function(e){return"media:duration"===e.getAttribute("property")&&!e.hasAttribute("refines")})),narrator:v(n,"media:narrator"),activeClass:v(n,"media:active-class"),playbackActiveClass:v(n,"media:playback-active-class"),smil_models:[],skippables:["sidebar","practice","marginalia","annotation","help","note","footnote","rearnote","table","table-row","table-cell","list","list-item","pagebreak"],escapables:["sidebar","bibliography","toc","loi","appendix","landmarks","lot","index","colophon","epigraph","conclusion","afterword","warning","epilogue","foreword","introduction","prologue","preface","preamble","notice","errata","copyright-page","acknowledgments","other-credits","titlepage","imprimatur","contributors","halftitlepage","dedication","help","annotation","marginalia","practice","note","footnote","rearnote","footnotes","rearnotes","bridgehead","page-list","table","table-row","table-cell","list","list-item","glossary"]},t}function S(e){var t=n(h(e,"manifest")).children(),i=[];return n.each(t,function(e,t){var r=n(t),o=r.attr("href")?r.attr("href"):"",a={href:o,id:r.attr("id")?r.attr("id"):"",media_overlay_id:r.attr("media-overlay")?r.attr("media-overlay"):"",media_type:r.attr("media-type")?r.attr("media-type"):"",properties:r.attr("properties")?r.attr("properties"):""};i.push(a)}),i}function w(e){var t=n(h(e,"bindings")).children(),i=[];return n.each(t,function(e,t){var r=n(t),o={handler:r.attr("handler")?r.attr("handler"):"",media_type:r.attr("media-type")?r.attr("media-type"):""};i.push(o)}),i}function b(e){var t,r;if(t=h(e,"manifest"),r=n(h(t,"item",function(e){var t=e.getAttribute("properties");return t&&i.contains(t.split(" "),"cover-image")})),1===r.length&&r.attr("href"))return r.attr("href");var o=n(h(e,"meta",function(e){return"cover"===e.getAttribute("name")})),a=o.attr("content");return 1===o.length&&a&&(r=n(h(t,"item",function(e){return e.getAttribute("id")===a})),1===r.length&&r.attr("href"))?r.attr("href"):(r=n(h(t,"item",function(e){return"cover"===e.getAttribute("id")})),1===r.length&&r.attr("href")?r.attr("href"):null)}function C(e){for(var t={},n=e.split(" "),i=0;i<n.length;i++)"rendition:orientation-landscape"===n[i]&&(t.rendition_orientation="landscape"),"rendition:orientation-portrait"===n[i]&&(t.rendition_orientation="portrait"),"rendition:orientation-auto"===n[i]&&(t.rendition_orientation="auto"),"rendition:spread-none"===n[i]&&(t.rendition_spread="none"),"rendition:spread-landscape"===n[i]&&(t.rendition_spread="landscape"),"rendition:spread-portrait"===n[i]&&(t.rendition_spread="portrait"),"rendition:spread-both"===n[i]&&(t.rendition_spread="both"),"rendition:spread-auto"===n[i]&&(t.rendition_spread="auto"),"rendition:flow-paginated"===n[i]&&(t.rendition_flow="paginated"),"rendition:flow-scrolled-continuous"===n[i]&&(t.rendition_flow="scrolled-continuous"),"rendition:flow-scrolled-doc"===n[i]&&(t.rendition_flow="scrolled-doc"),"rendition:flow-auto"===n[i]&&(t.rendition_flow="auto"),"rendition:page-spread-center"===n[i]&&(t.page_spread="page-spread-center"),"page-spread-left"===n[i]&&(t.page_spread="page-spread-left"),"page-spread-right"===n[i]&&(t.page_spread="page-spread-right"),"rendition:layout-reflowable"===n[i]&&(t.fixed_flow=!1,t.rendition_layout="reflowable"),"rendition:layout-pre-paginated"===n[i]&&(t.fixed_flow=!0,t.rendition_layout="pre-paginated");return t}var R,E=t,x=n.Deferred();t.getPackageDom(function(e){R=e,x.resolve(e)},r),this.parse=function(e){x.done(function(i){var r=y(i),o=(i.getElementsByTagNameNS("*","spine")[0],m(i,"spine","page-progression-direction")),l=(w(i),new c(S(i))),u=f(i,l,r),h=b(i);h&&(r.cover_href=h),n.when(d(r)).then(function(){E.setPackageMetadata(r,function(){var n=new s(t.getPackageUrl(),t,r,u,l);
n.setPageProgressionDirection(o),a(n,e)})})})}};return d}),define("epub-fetch/iframe_zip_loader",["URIjs"],function(e){var t=function(t,n,i){function r(e,t){$.ajax({url:e,dataType:"html",async:!0,success:function(e){t(e)},error:function(n,i,r){console.error("Error when AJAX fetching "+e),console.error(i),console.error(r),t()}})}function o(e,t){r(e,function(n){if(!n)return void t();var r=e.split("/");r.pop();var o='<base href="'+r.join("/")+'/"/>',s='<script type="text/javascript">('+a.toString()+")()</script>";i&&i.mathJaxUrl&&n.indexOf("<math")>=0&&(s+='<script type="text/javascript" src="'+i.mathJaxUrl+'"></script>');var l=n.replace(/(<head.*?>)/,"$1"+o+s);t(l)})}function a(){navigator.epubReadingSystem=window.parent.navigator.epubReadingSystem,window.parent=window.self,window.top=window.self}var s=new t.Views.IFrameLoader,l=this;this.addIFrameEventListener=function(e,t,n){s.addIFrameEventListener(e,t,n)},this.updateIframeEvents=function(e){s.updateIframeEvents(e)},this.loadIframe=function(t,i,r,a,s){var u=new e(i).absoluteTo(t.baseURI).search("").hash("").toString(),c=n().shouldConstructDomProgrammatically();c?n().fetchContentDocument(s,u,function(e){l._loadIframeWithDocument(t,s,e.documentElement.outerHTML,function(){r.call(a,!0,s)})},function(){r.call(a,!1,s)}):o(u,function(e){e?l._loadIframeWithDocument(t,s,e,function(){r.call(a,!0,s)}):r.call(a,!1,s)})},this._loadIframeWithDocument=function(e,t,n,i){var r=window.navigator.userAgent.indexOf("Trident")>0;if(r)e.contentWindow.document.open(),e.contentWindow.document.write(n);else{var o="text/html";t.spineItem.media_type&&t.spineItem.media_type.length&&(o=t.spineItem.media_type);var a=window.URL.createObjectURL(new Blob([n],{type:o}))}e.onload=function(){l.updateIframeEvents(e);var t=e.contentWindow.MathJax;if(t){var n=_.once(i);t.Hub.Queue(n)}else i();r||window.URL.revokeObjectURL(a)},r?e.contentWindow.document.close():e.setAttribute("src",a)}};return t}),define("Readium",["require","console_shim","jquery","underscore","readerView","epub-fetch","epub-model/package_document_parser","epub-fetch/iframe_zip_loader","URIjs"],function(e,t,n,i,r,o,a,s,l){if(window.URI=l,"URL"in window==!1){if("webkitURL"in window==!1)throw Error("Browser does not support window.URL");window.URL=window.webkitURL}var u=function(e,t){var i,r=this,l=e.jsLibRoot;t.iframeLoader=e.useSimpleLoader?new ReadiumSDK.Views.IFrameLoader:new s(ReadiumSDK,function(){return i},{mathJaxUrl:t.mathJaxUrl}),this.reader=new ReadiumSDK.Views.ReaderView(t),this.openPackageDocument=function(t,s,u){i=new o(t,l),i.initialize(function(){var o=new a(t,i);o.parse(function(t){var o=e.openBookOptions||{},a=n.extend(t.getSharedJsPackageData(),o);u&&(a.openPageRequest=u),r.reader.openBook(a);var l={packageDocumentUrl:i.getPackageUrl(),metadata:t.getMetadata()};s&&s(t,l)})})},ReadiumSDK.reader=this.reader,ReadiumSDK.trigger(ReadiumSDK.Events.READER_INITIALIZED,this.reader)};return u.version={readiumJs:{sha:"428b2956dce052598a73f8558b8a686600eabbd2",clean:!1},readiumSharedJs:{sha:"e3d096dabe6d6ea188c9af97fc28fc7c410982b2",clean:!0}},u}),define("readium",function(){});
//# sourceMappingURL=dist/readium.min.js.map